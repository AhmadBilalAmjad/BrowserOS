(()=>{"use strict";var t="get_page_content",n="ping_content_script";const e={OPENAI_API_KEY:"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",DEV_MODE:!1};const r={debug:function(t,n,r){if(e.DEV_MODE){var o=(new Date).toISOString();"[".concat(o,"] [").concat(t,"] DEBUG: ").concat(n)}},info:function(t,n,r){if(e.DEV_MODE){var o=(new Date).toISOString();"[".concat(o,"] [").concat(t,"] INFO: ").concat(n)}},warn:function(t,n,e){var r=(new Date).toISOString();"[".concat(r,"] [").concat(t,"] WARN: ").concat(n)},error:function(t,n,e){var r=(new Date).toISOString();"[".concat(r,"] [").concat(t,"] ERROR: ").concat(n)}};function o(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=i(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,l=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return c=t.done,t},e:function(t){l=!0,a=t},f:function(){try{c||null==e.return||e.return()}finally{if(l)throw a}}}}function a(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=e){var r,o,a,i,c=[],l=!0,u=!1;try{if(a=(e=e.call(t)).next,0===n){if(Object(e)!==e)return;l=!1}else for(;!(l=(r=a.call(e)).done)&&(c.push(r.value),c.length!==n);l=!0);}catch(t){u=!0,o=t}finally{try{if(!l&&null!=e.return&&(i=e.return(),Object(i)!==i))return}finally{if(u)throw o}}return c}}(t,n)||i(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,n){if(t){if("string"==typeof t)return c(t,n);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?c(t,n):void 0}}function c(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=Array(n);e<n;e++)r[e]=t[e];return r}function l(){var t,n;r.debug("CONTENT","getPageContent called");var e=document.title,i=window.location.href,c=(null===(t=document.querySelector('link[rel="icon"]'))||void 0===t?void 0:t.getAttribute("href"))||"";r.debug("CONTENT","Favicon URL found: ".concat(c||"none"));var l="",u=document.querySelector('meta[name="description"]');u?(l=u.getAttribute("content")||"",r.debug("CONTENT","Meta description found: ".concat(l.substring(0,50)).concat(l.length>50?"...":""))):r.debug("CONTENT","No meta description found");var d=Array.from(document.querySelectorAll("h1, h2, h3")).slice(0,50).map((function(t){var n;return(null===(n=t.textContent)||void 0===n?void 0:n.trim())||""})).filter((function(t){return t.length>0}));r.debug("CONTENT","Found ".concat(d.length," headings on the page"));var s="",f=15e3;r.debug("CONTENT","Starting content extraction with selectors");for(var g={},h=0,v=["main","article","#content",".content","#main",".main",'[role="main"]',"#siteTable",".Post",".richTextContainer",".post-content",".entry-content",".page-content",".post-body",".article-content",".article-body",".story-body",".story-content",".comment",".md",".blog-content",".blog-post",".news-article",'[class*="content"]','[class*="article"]','[class*="post"]','[class*="main"]','[data-testid*="content"]',".wikipedia-content","#readme",".entry",".thread",".tweet",".ytd-video-primary-info-renderer",".video-details",".item-page",".answer",".question"];h<v.length;h++){var m=v[h],b=document.querySelectorAll(m);if(r.debug("CONTENT","Trying selector ".concat(m,", found ").concat(b.length," elements")),0!==b.length){for(var p=[],N=0,T=0;T<Math.min(b.length,5);T++){var y,E=b[T];if(!(E.textContent&&E.textContent.length<50)){var O=(null===(y=E.textContent)||void 0===y?void 0:y.trim().replace(/\s+/g," ").replace(/\n+/g," "))||"";if(O.length>0&&(p.push(O),(N+=O.length)>=f))break}}if(g[m]=N,N>1e3){s=p.join("\n").substring(0,f),r.debug("CONTENT","Found content with selector ".concat(m,", length: ").concat(s.length));break}}}if(Object.entries(g).filter((function(t){var n=a(t,2);n[0];return n[1]>0})).sort((function(t,n){return n[1]-t[1]})).forEach((function(t){var n=a(t,2);n[0],n[1]})),s.length<200){r.debug("CONTENT","No substantial content found with selectors, trying paragraph extraction");var C=function(){var t=document.querySelectorAll('p, .paragraph, div[class*="paragraph"], div[class*="text"], div[class*="body"], span[class*="text"]');r.debug("CONTENT","Found ".concat(t.length," potential text containers for paragraph extraction"));var n=[],e=40,a=200;return t.forEach((function(t){var r;if(!function(t){var n=["nav","header","footer","aside",'[role="navigation"]','[role="banner"]','[role="contentinfo"]',".navigation",".menu",".sidebar",".comment",".widget",".ad",".advertisement",".banner",".header",".footer",".nav","#header","#footer","#sidebar","#navigation","#menu",'[class*="cookie"]','[class*="popup"]','[id*="cookie"]','[id*="popup"]','[class*="modal"]','[id*="modal"]'],e=t;for(;e&&e!==document.body;){var r,a=o(n);try{for(a.s();!(r=a.n()).done;){var i=r.value;try{if(e.matches(i))return!0}catch(t){continue}}}catch(t){a.e(t)}finally{a.f()}e=e.parentElement}return!1}(t)){var i=(null===(r=t.textContent)||void 0===r?void 0:r.trim())||"";if(i.length>=e&&!n.includes(i)){var c=i.replace(/\s+/g," ");if(n.push(c),n.length>=a)return}}})),r.debug("CONTENT","Extracted ".concat(n.length," significant paragraphs")),n}();C.length>0&&(s=C.join("\n").substring(0,f),r.debug("CONTENT","Found ".concat(C.length," paragraphs, total length: ").concat(s.length)))}s.length<200&&(r.debug("CONTENT","Still no substantial content, using body extraction fallback"),s=function(){var t=document.createElement("div");t.innerHTML=document.body.innerHTML,["script","style","noscript","svg","iframe","form","button","nav","header","footer","aside",'[role="navigation"]','[role="banner"]',".navigation",".menu",".nav",".sidebar",".comments",".widget",".ad",".advertisement",".banner",".promo",".recommended","#header","#footer","#sidebar","#navigation","#comments",'[class*="cookie"]','[class*="popup"]','[class*="modal"]',"img","picture","figure","video","audio","canvas"].forEach((function(n){t.querySelectorAll(n).forEach((function(t){return t.remove()}))}));var n=t.textContent||"";return n=n.trim().replace(/\s+/g," ").replace(/\n+/g,"\n").substring(0,15e3)}(),r.debug("CONTENT","Extracted from body, length: ".concat(s.length))),s.length<200&&(s=function(){var t=[];function n(e){if(e.nodeType===Node.TEXT_NODE){var r,o=null===(r=e.textContent)||void 0===r?void 0:r.trim();o&&o.length>10&&t.push(e)}else{if(e.nodeType===Node.ELEMENT_NODE){var a=e;if(null===a.offsetParent||"SCRIPT"===a.tagName||"STYLE"===a.tagName||"NOSCRIPT"===a.tagName||"DIV"===a.tagName&&(a.classList.contains("hidden")||"none"===a.style.display||"hidden"===a.style.visibility))return}for(var i=0;i<e.childNodes.length;i++)n(e.childNodes[i])}}n(document.body);var e=window.innerHeight,r=t.filter((function(t){var n=t.parentElement;if(!n)return!1;var r=n.getBoundingClientRect();return r.top>=0&&r.left>=0&&r.bottom<=e&&r.right<=window.innerWidth})),o="";r.length>0&&(o=r.map((function(t){var n;return null===(n=t.textContent)||void 0===n?void 0:n.trim()})).filter((function(t){return t&&t.length>0})).join("\n"));o.length<200&&t.length>r.length&&(o=t.map((function(t){var n;return null===(n=t.textContent)||void 0===n?void 0:n.trim()})).filter((function(t){return t&&t.length>0})).join("\n"));return o.substring(0,15e3)}());var w={title:e,url:i,description:l,headings:d,content:s,faviconUrl:c,text:s};return r.info("CONTENT",'Page content extracted: Title="'.concat(w.title,'", URL=').concat(w.url,", Content length=").concat((null===(n=w.content)||void 0===n?void 0:n.length)||0,")")),w}window.__CHAT_LOADED=!0,chrome.runtime.onMessage.addListener((function(e,o,a){if(e.action===t){r.info("CONTENT","Received GET_PAGE_CONTENT message from ".concat(o.tab?"tab "+o.tab.id:"extension"));try{var i,c;r.info("CONTENT","Starting content extraction for ".concat(window.location.href));var u=performance.now(),d=l(),s=performance.now();r.info("CONTENT","Content extraction completed in ".concat((s-u).toFixed(2),"ms, sending response")),r.info("CONTENT","Extracted ".concat((null===(i=d.content)||void 0===i?void 0:i.length)||0," characters of content, ").concat((null===(c=d.headings)||void 0===c?void 0:c.length)||0," headings")),a({success:!0,data:d})}catch(t){r.error("CONTENT","Error getting page content:",t),a({success:!1,error:t.message})}return!0}if(e.action===n)return r.info("CONTENT","Received PING from ".concat(o.tab?"tab "+o.tab.id:"extension")),a({success:!0,message:"PONG",timestamp:Date.now()}),!0})),r.info("CONTENT","Chat content script loaded")})();