From b809d3add94bd6c038aa616fe1648fbfb65c500f Mon Sep 17 00:00:00 2001
From: Nikhil Sonti <nikhilsv92@gmail.com>
Date: Wed, 16 Apr 2025 23:06:45 +0530
Subject: [PATCH] AI sidepanel integration new

---
 chrome/browser/browser_resources.grd          |   1 +
 .../allowlist.cc                              |   2 +
 chrome/browser/extensions/component_loader.cc |   3 +
 .../component_extension_resources.grd         |  13 +
 .../common/extensions/extension_constants.h   |   3 +
 18 files changed, 1041 insertions(+)

diff --git a/chrome/browser/browser_resources.grd b/chrome/browser/browser_resources.grd
index 03d941670b8cd..f1d592a6dd64c 100644
--- a/chrome/browser/browser_resources.grd
+++ b/chrome/browser/browser_resources.grd
@@ -237,6 +237,7 @@
         <include name="IDR_CERT_MANAGER_DIALOG_HTML" file="resources\certificate_manager\certificate_manager_dialog.html" type="BINDATA" />
         <include name="IDR_CERT_MANAGER_DIALOG_V2_HTML" file="resources\certificate_manager\certificate_manager_dialog_v2.html" type="BINDATA" />
       </if>
+      <include name="IDR_AI_SIDE_PANEL_MANIFEST" file="resources\ai_side_panel\manifest.json" type="BINDATA" />
     </includes>
   </release>
 </grit>
diff --git a/chrome/browser/extensions/component_extensions_allowlist/allowlist.cc b/chrome/browser/extensions/component_extensions_allowlist/allowlist.cc
index b818225467c01..b2e9219008a54 100644
--- a/chrome/browser/extensions/component_extensions_allowlist/allowlist.cc
+++ b/chrome/browser/extensions/component_extensions_allowlist/allowlist.cc
@@ -31,6 +31,7 @@ bool IsComponentExtensionAllowlisted(const std::string& extension_id) {
   constexpr auto kAllowed = base::MakeFixedFlatSet<std::string_view>({
       extension_misc::kInAppPaymentsSupportAppId,
       extension_misc::kPdfExtensionId,
+      extension_misc::kAISidePanelExtensionId,
 #if BUILDFLAG(IS_CHROMEOS)
       extension_misc::kAssessmentAssistantExtensionId,
       extension_misc::kAccessibilityCommonExtensionId,
@@ -89,6 +90,7 @@ bool IsComponentExtensionAllowlisted(int manifest_resource_id) {
     case IDR_TTS_ENGINE_MANIFEST:
 #endif  // BUILDFLAG(IS_WIN) || BUILDFLAG(IS_LINUX) || BUILDFLAG(IS_MAC)
     case IDR_WEBSTORE_MANIFEST:
+    case IDR_AI_SIDE_PANEL_MANIFEST:  // AI Side Panel Extension
 
 #if BUILDFLAG(IS_CHROMEOS)
     // Separate ChromeOS list, as it is quite large.
diff --git a/chrome/browser/extensions/component_loader.cc b/chrome/browser/extensions/component_loader.cc
index 06b3cd1444078..ae47c19ceaa67 100644
--- a/chrome/browser/extensions/component_loader.cc
+++ b/chrome/browser/extensions/component_loader.cc
@@ -532,6 +532,9 @@ void ComponentLoader::AddDefaultComponentExtensionsWithBackgroundPages(
        command_line->HasSwitch(
            ::switches::kDisableComponentExtensionsWithBackgroundPages));
 
+  Add(IDR_AI_SIDE_PANEL_MANIFEST,
+      base::FilePath(FILE_PATH_LITERAL("ai_side_panel")));
+
 #if BUILDFLAG(ENABLE_HANGOUT_SERVICES_EXTENSION)
   const bool enable_hangout_services_extension_for_testing =
       command_line->HasSwitch(::switches::kTestType) &&
diff --git a/chrome/browser/resources/BUILD.gn b/chrome/browser/resources/BUILD.gn
index dc603ec1540ba..9fc3dfaf6f425 100644
--- a/chrome/browser/resources/BUILD.gn
+++ b/chrome/browser/resources/BUILD.gn
@@ -19,6 +19,7 @@ group("resources") {
   public_deps = [
     "saved_tab_groups_unsupported:resources",
     "segmentation_internals:resources",
+    "ai_side_panel:build",
   ]
 
   if (!is_android) {
diff --git a/chrome/browser/resources/component_extension_resources.grd b/chrome/browser/resources/component_extension_resources.grd
index 16679059ebc52..bc7d3cd4b9740 100644
--- a/chrome/browser/resources/component_extension_resources.grd
+++ b/chrome/browser/resources/component_extension_resources.grd
@@ -78,6 +78,19 @@
       <include name="IDS_READING_MODE_DARK_PNG" file="side_panel/read_anything/images/read_anything_dark.png" type="BINDATA" />
       <include name="IDS_READING_MODE_YELLOW_PNG" file="side_panel/read_anything/images/read_anything_yellow.png" type="BINDATA" />
       <include name="IDS_READING_MODE_BLUE_PNG" file="side_panel/read_anything/images/read_anything_blue.png" type="BINDATA" />
+
+      <!-- AI Side Panel Extension -->
+      <include name="IDR_AI_SIDE_PANEL_MANIFEST" file="ai_side_panel/manifest.json" type="BINDATA" />
+      <include name="IDR_AI_SIDE_PANEL_BACKGROUND_JS" file="ai_side_panel/background.js" type="BINDATA" />
+      <include name="IDR_AI_SIDE_PANEL_CONTENT_JS" file="ai_side_panel/content.js" type="BINDATA" />
+      <include name="IDR_AI_SIDE_PANEL_SIDEPANEL_HTML" file="ai_side_panel/sidepanel.html" type="BINDATA" />
+      <include name="IDR_AI_SIDE_PANEL_SIDEPANEL_JS" file="ai_side_panel/sidepanel.js" type="BINDATA" />
+      <include name="IDR_AI_SIDE_PANEL_CHAT_CSS" file="ai_side_panel/styles/chat.css" type="BINDATA" />
+      <include name="IDR_AI_SIDE_PANEL_GLOBALS_CSS" file="ai_side_panel/styles/globals.css" type="BINDATA" />
+      <include name="IDR_AI_SIDE_PANEL_ICON16" file="ai_side_panel/icon16.png" type="BINDATA" />
+      <include name="IDR_AI_SIDE_PANEL_ICON48" file="ai_side_panel/icon48.png" type="BINDATA" />
+      <include name="IDR_AI_SIDE_PANEL_ICON128" file="ai_side_panel/icon128.png" type="BINDATA" />
+      <include name="IDR_AI_SIDE_PANEL_ICON" file="ai_side_panel/icons/icon.png" type="BINDATA" />
     </includes>
 
     <!-- Game Controls lottie json files -->
diff --git a/chrome/common/extensions/extension_constants.h b/chrome/common/extensions/extension_constants.h
index 7a46135d8fa99..b73ab6259a19d 100644
--- a/chrome/common/extensions/extension_constants.h
+++ b/chrome/common/extensions/extension_constants.h
@@ -27,6 +27,9 @@ inline constexpr char kLaunchSourceAppListInfoDialog[] =
 }  // namespace extension_urls
 
 namespace extension_misc {
+// The extension id of the AI Side Panel extension.
+inline constexpr char kAISidePanelExtensionId[] =
+    "opocihnfjcgcjecjhjjgifkbkgeeoonh";
 
 // The extension id of the Calendar application.
 inline constexpr char kCalendarAppId[] = "ejjicmeblgpmajnghnpcppodonldlgfn";
-- 
2.49.0

