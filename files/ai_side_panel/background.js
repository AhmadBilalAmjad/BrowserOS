/*! For license information please see background.js.LICENSE.txt */
(()=>{"use strict";var e="get_page_content",t="close_panel",i="ping_content_script",r="heartbeat",n="heartbeat_ack",s="request_page_content",o="page_content_ready",a="refresh_tab_content",l="get_tabs",c="tabs_list",u="ping_content_script",h="pong_content_script",d="close_panel",p="posthog",g="error";const v={LITE_LLM_KEY:"sk-M6Osg4w_eRqZTgYeZAZtnQ",BASE_URL:"http://llm.nxtscape.ai",DEV_MODE:!1};const f={debug:function(e,t,i){if(v.DEV_MODE){var r=(new Date).toISOString();"[".concat(r,"] [").concat(e,"] DEBUG: ").concat(t)}},info:function(e,t,i){if(v.DEV_MODE){var r=(new Date).toISOString();"[".concat(r,"] [").concat(e,"] INFO: ").concat(t)}},warn:function(e,t,i){var r=(new Date).toISOString();"[".concat(r,"] [").concat(e,"] WARN: ").concat(t)},error:function(e,t,i){var r=(new Date).toISOString();"[".concat(r,"] [").concat(e,"] ERROR: ").concat(t)}};var _,m="undefined"!=typeof window?window:void 0,y="undefined"!=typeof globalThis?globalThis:m,b=Array.prototype,w=b.forEach,E=b.indexOf,k=null==y?void 0:y.navigator,x=null==y?void 0:y.document,S=null==y?void 0:y.location,I=null==y?void 0:y.fetch,F=null!=y&&y.XMLHttpRequest&&"withCredentials"in new y.XMLHttpRequest?y.XMLHttpRequest:void 0,R=null==y?void 0:y.AbortController,O=null==k?void 0:k.userAgent,$=null!=m?m:{},C={DEBUG:!1,LIB_VERSION:"1.242.2"},P="$copy_autocapture",M=["$snapshot","$pageview","$pageleave","$set","survey dismissed","survey sent","survey shown","$identify","$groupidentify","$create_alias","$$client_ingestion_warning","$web_experiment_applied","$feature_enrollment_update","$feature_flag_called"];!function(e){e.GZipJS="gzip-js",e.Base64="base64"}(_||(_={}));var A=["fatal","error","warning","log","info","debug"];function D(e,t){return-1!==e.indexOf(t)}var T=function(e){return e.trim()},L=function(e){return e.replace(/^\$/,"")},N=Array.isArray,B=Object.prototype,U=B.hasOwnProperty,q=B.toString,j=N||function(e){return"[object Array]"===q.call(e)},G=e=>"function"==typeof e,H=e=>e===Object(e)&&!j(e),W=e=>{if(H(e)){for(var t in e)if(U.call(e,t))return!1;return!0}return!1},K=e=>void 0===e,z=e=>"[object String]"==q.call(e),V=e=>z(e)&&0===e.trim().length,Y=e=>null===e,J=e=>K(e)||Y(e),X=e=>"[object Number]"==q.call(e),Z=e=>"[object Boolean]"===q.call(e),Q=e=>D(M,e),ee=e=>{var t={t:function(t){if(m&&(C.DEBUG||$.POSTHOG_DEBUG)&&!K(m.console)&&m.console){for(var i=("__rrweb_original__"in m.console[t]?m.console[t].__rrweb_original__:m.console[t]),r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];i(e,...n)}},info:function(){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];t.t("log",...i)},warn:function(){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];t.t("warn",...i)},error:function(){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];t.t("error",...i)},critical:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i]},uninitializedWarning:e=>{t.error("You must initialize PostHog before calling "+e)},createLogger:t=>ee(e+" "+t)};return t},te=ee("[PostHog.js]"),ie=te.createLogger,re=ie("[ExternalScriptsLoader]"),ne=(e,t,i)=>{if(e.config.disable_external_dependency_loading)return re.warn(t+" was requested but loading of external scripts is disabled."),i("Loading of external scripts is disabled");var r=null==x?void 0:x.querySelectorAll("script");if(r)for(var n=0;n<r.length;n++)if(r[n].src===t)return i();var s=()=>{if(!x)return i("document not found");var r=x.createElement("script");if(r.type="text/javascript",r.crossOrigin="anonymous",r.src=t,r.onload=e=>i(void 0,e),r.onerror=e=>i(e),e.config.prepare_external_dependency_script&&(r=e.config.prepare_external_dependency_script(r)),!r)return i("prepare_external_dependency_script returned null");var n,s=x.querySelectorAll("body > script");s.length>0?null==(n=s[0].parentNode)||n.insertBefore(r,s[0]):x.body.appendChild(r)};null!=x&&x.body?s():null==x||x.addEventListener("DOMContentLoaded",s)};function se(){return se=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},se.apply(this,arguments)}function oe(e,t){if(null==e)return{};var i,r,n={},s=Object.keys(e);for(r=0;r<s.length;r++)i=s[r],t.indexOf(i)>=0||(n[i]=e[i]);return n}$.__PosthogExtensions__=$.__PosthogExtensions__||{},$.__PosthogExtensions__.loadExternalDependency=(e,t,i)=>{var r="/static/"+t+".js?v="+e.version;if("remote-config"===t&&(r="/array/"+e.config.token+"/config.js"),"toolbar"===t){var n=3e5;r=r+"&t="+Math.floor(Date.now()/n)*n}var s=e.requestRouter.endpointFor("assets",r);ne(e,s,i)},$.__PosthogExtensions__.loadSiteApp=(e,t,i)=>{var r=e.requestRouter.endpointFor("api",t);ne(e,r,i)};var ae={};function le(e,t,i){if(j(e))if(w&&e.forEach===w)e.forEach(t,i);else if("length"in e&&e.length===+e.length)for(var r=0,n=e.length;r<n;r++)if(r in e&&t.call(i,e[r],r)===ae)return}function ce(e,t,i){if(!J(e)){if(j(e))return le(e,t,i);if((e=>e instanceof FormData)(e)){for(var r of e.entries())if(t.call(i,r[1],r[0])===ae)return}else for(var n in e)if(U.call(e,n)&&t.call(i,e[n],n)===ae)return}}var ue=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return le(i,(function(t){for(var i in t)void 0!==t[i]&&(e[i]=t[i])})),e},he=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return le(i,(function(t){le(t,(function(t){e.push(t)}))})),e};function de(e){for(var t=Object.keys(e),i=t.length,r=new Array(i);i--;)r[i]=[t[i],e[t[i]]];return r}var pe=function(e){try{return e()}catch(e){return}},ge=function(e){return function(){try{for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return e.apply(this,i)}catch(e){te.critical("Implementation error. Please turn on debug mode and open a ticket on https://app.posthog.com/home#panel=support%3Asupport%3A."),te.critical(e)}}},ve=function(e){var t={};return ce(e,(function(e,i){(z(e)&&e.length>0||X(e))&&(t[i]=e)})),t};var fe=["herokuapp.com","vercel.app","netlify.app"];function _e(e){var t=null==e?void 0:e.hostname;if(!z(t))return!1;var i=t.split(".").slice(-2).join(".");for(var r of fe)if(i===r)return!1;return!0}function me(e,t){for(var i=0;i<e.length;i++)if(t(e[i]))return e[i]}function ye(e,t,i,r){var{capture:n=!1,passive:s=!0}=null!=r?r:{};null==e||e.addEventListener(t,i,{capture:n,passive:s})}var be="$people_distinct_id",we="__alias",Ee="__timers",ke="$autocapture_disabled_server_side",xe="$heatmaps_enabled_server_side",Se="$exception_capture_enabled_server_side",Ie="$web_vitals_enabled_server_side",Fe="$dead_clicks_enabled_server_side",Re="$web_vitals_allowed_metrics",Oe="$session_recording_enabled_server_side",$e="$console_log_recording_enabled_server_side",Ce="$session_recording_network_payload_capture",Pe="$session_recording_masking",Me="$session_recording_canvas_recording",Ae="$replay_sample_rate",De="$replay_minimum_duration",Te="$replay_script_config",Le="$sesid",Ne="$session_is_sampled",Be="$session_recording_url_trigger_activated_session",Ue="$session_recording_event_trigger_activated_session",qe="$enabled_feature_flags",je="$early_access_features",Ge="$feature_flag_details",He="$stored_person_properties",We="$stored_group_properties",Ke="$surveys",ze="$surveys_activated",Ve="$flag_call_reported",Ye="$user_state",Je="$client_session_props",Xe="$capture_rate_limit",Ze="$initial_campaign_params",Qe="$initial_referrer_info",et="$initial_person_info",tt="$epp",it="__POSTHOG_TOOLBAR__",rt="$posthog_cookieless",nt=[be,we,"__cmpns",Ee,Oe,xe,Le,qe,Ye,je,Ge,We,He,Ke,Ve,Je,Xe,Ze,Qe,tt,et];function st(e){return e instanceof Element&&(e.id===it||!(null==e.closest||!e.closest(".toolbar-global-fade-container")))}function ot(e){return!!e&&1===e.nodeType}function at(e,t){return!!e&&!!e.tagName&&e.tagName.toLowerCase()===t.toLowerCase()}function lt(e){return!!e&&3===e.nodeType}function ct(e){return!!e&&11===e.nodeType}function ut(e){return e?T(e).split(/\s+/):[]}function ht(e){var t=null==m?void 0:m.location.href;return!!(t&&e&&e.some((e=>t.match(e))))}function dt(e){var t="";switch(typeof e.className){case"string":t=e.className;break;case"object":t=(e.className&&"baseVal"in e.className?e.className.baseVal:null)||e.getAttribute("class")||"";break;default:t=""}return ut(t)}function pt(e){return J(e)?null:T(e).split(/(\s+)/).filter((e=>It(e))).join("").replace(/[\r\n]/g," ").replace(/[ ]+/g," ").substring(0,255)}function gt(e){var t="";return mt(e)&&!yt(e)&&e.childNodes&&e.childNodes.length&&ce(e.childNodes,(function(e){var i;lt(e)&&e.textContent&&(t+=null!==(i=pt(e.textContent))&&void 0!==i?i:"")})),T(t)}function vt(e){return K(e.target)?e.srcElement||null:null!=(t=e.target)&&t.shadowRoot?e.composedPath()[0]||null:e.target||null;var t}var ft=["a","button","form","input","select","textarea","label"];function _t(e){var t=e.parentNode;return!(!t||!ot(t))&&t}function mt(e){for(var t=e;t.parentNode&&!at(t,"body");t=t.parentNode){var i=dt(t);if(D(i,"ph-sensitive")||D(i,"ph-no-capture"))return!1}if(D(dt(e),"ph-include"))return!0;var r=e.type||"";if(z(r))switch(r.toLowerCase()){case"hidden":case"password":return!1}var n=e.name||e.id||"";return!z(n)||!/^cc|cardnum|ccnum|creditcard|csc|cvc|cvv|exp|pass|pwd|routing|seccode|securitycode|securitynum|socialsec|socsec|ssn/i.test(n.replace(/[^a-zA-Z0-9]/g,""))}function yt(e){return!!(at(e,"input")&&!["button","checkbox","submit","reset"].includes(e.type)||at(e,"select")||at(e,"textarea")||"true"===e.getAttribute("contenteditable"))}var bt="(4[0-9]{12}(?:[0-9]{3})?)|(5[1-5][0-9]{14})|(6(?:011|5[0-9]{2})[0-9]{12})|(3[47][0-9]{13})|(3(?:0[0-5]|[68][0-9])[0-9]{11})|((?:2131|1800|35[0-9]{3})[0-9]{11})",wt=new RegExp("^(?:"+bt+")$"),Et=new RegExp(bt),kt="\\d{3}-?\\d{2}-?\\d{4}",xt=new RegExp("^("+kt+")$"),St=new RegExp("("+kt+")");function It(e,t){if(void 0===t&&(t=!0),J(e))return!1;if(z(e)){if(e=T(e),(t?wt:Et).test((e||"").replace(/[- ]/g,"")))return!1;if((t?xt:St).test(e))return!1}return!0}function Ft(e){var t=gt(e);return It(t=(t+" "+Rt(e)).trim())?t:""}function Rt(e){var t="";return e&&e.childNodes&&e.childNodes.length&&ce(e.childNodes,(function(e){var i;if(e&&"span"===(null==(i=e.tagName)?void 0:i.toLowerCase()))try{var r=gt(e);t=(t+" "+r).trim(),e.childNodes&&e.childNodes.length&&(t=(t+" "+Rt(e)).trim())}catch(e){te.error("[AutoCapture]",e)}})),t}function Ot(e){return function(e){var t=e.map((e=>{var t,i,r="";if(e.tag_name&&(r+=e.tag_name),e.attr_class)for(var n of(e.attr_class.sort(),e.attr_class))r+="."+n.replace(/"/g,"");var s=se({},e.text?{text:e.text}:{},{"nth-child":null!==(t=e.nth_child)&&void 0!==t?t:0,"nth-of-type":null!==(i=e.nth_of_type)&&void 0!==i?i:0},e.href?{href:e.href}:{},e.attr_id?{attr_id:e.attr_id}:{},e.attributes),o={};return de(s).sort(((e,t)=>{var[i]=e,[r]=t;return i.localeCompare(r)})).forEach((e=>{var[t,i]=e;return o[$t(t.toString())]=$t(i.toString())})),(r+=":")+de(o).map((e=>{var[t,i]=e;return t+'="'+i+'"'})).join("")}));return t.join(";")}(function(e){return e.map((e=>{var t,i,r={text:null==(t=e.$el_text)?void 0:t.slice(0,400),tag_name:e.tag_name,href:null==(i=e.attr__href)?void 0:i.slice(0,2048),attr_class:Ct(e),attr_id:e.attr__id,nth_child:e.nth_child,nth_of_type:e.nth_of_type,attributes:{}};return de(e).filter((e=>{var[t]=e;return 0===t.indexOf("attr__")})).forEach((e=>{var[t,i]=e;return r.attributes[t]=i})),r}))}(e))}function $t(e){return e.replace(/"|\\"/g,'\\"')}function Ct(e){var t=e.attr__class;return t?j(t)?t:ut(t):void 0}class Pt{constructor(){this.clicks=[]}isRageClick(e,t,i){var r=this.clicks[this.clicks.length-1];if(r&&Math.abs(e-r.x)+Math.abs(t-r.y)<30&&i-r.timestamp<1e3){if(this.clicks.push({x:e,y:t,timestamp:i}),3===this.clicks.length)return!0}else this.clicks=[{x:e,y:t,timestamp:i}];return!1}}var Mt=["localhost","127.0.0.1"],At=e=>{var t=null==x?void 0:x.createElement("a");return K(t)?null:(t.href=e,t)},Dt=function(e,t){for(var i,r=((e.split("#")[0]||"").split(/\?(.*)/)[1]||"").replace(/^\?+/g,"").split("&"),n=0;n<r.length;n++){var s=r[n].split("=");if(s[0]===t){i=s;break}}if(!j(i)||i.length<2)return"";var o=i[1];try{o=decodeURIComponent(o)}catch(e){te.error("Skipping decoding for malformed query param: "+o)}return o.replace(/\+/g," ")},Tt=function(e,t,i){if(!e||!t||!t.length)return e;for(var r=e.split("#"),n=r[0]||"",s=r[1],o=n.split("?"),a=o[1],l=o[0],c=(a||"").split("&"),u=[],h=0;h<c.length;h++){var d=c[h].split("=");j(d)&&(t.includes(d[0])?u.push(d[0]+"="+i):u.push(c[h]))}var p=l;return null!=a&&(p+="?"+u.join("&")),null!=s&&(p+="#"+s),p},Lt=function(e,t){var i=e.match(new RegExp(t+"=([^&]*)"));return i?i[1]:null},Nt=ie("[AutoCapture]");function Bt(e,t){return t.length>e?t.slice(0,e)+"...":t}function Ut(e){if(e.previousElementSibling)return e.previousElementSibling;var t=e;do{t=t.previousSibling}while(t&&!ot(t));return t}function qt(e,t){for(var i,r,{e:n,maskAllElementAttributes:s,maskAllText:o,elementAttributeIgnoreList:a,elementsChainAsString:l}=t,c=[e],u=e;u.parentNode&&!at(u,"body");)ct(u.parentNode)?(c.push(u.parentNode.host),u=u.parentNode.host):(c.push(u.parentNode),u=u.parentNode);var h,d=[],p={},g=!1,v=!1;if(ce(c,(e=>{var t=mt(e);"a"===e.tagName.toLowerCase()&&(g=e.getAttribute("href"),g=t&&g&&It(g)&&g),D(dt(e),"ph-no-capture")&&(v=!0),d.push(function(e,t,i,r){var n=e.tagName.toLowerCase(),s={tag_name:n};ft.indexOf(n)>-1&&!i&&("a"===n.toLowerCase()||"button"===n.toLowerCase()?s.$el_text=Bt(1024,Ft(e)):s.$el_text=Bt(1024,gt(e)));var o=dt(e);o.length>0&&(s.classes=o.filter((function(e){return""!==e}))),ce(e.attributes,(function(i){var n;if((!yt(e)||-1!==["name","id","class","aria-label"].indexOf(i.name))&&(null==r||!r.includes(i.name))&&!t&&It(i.value)&&(n=i.name,!z(n)||"_ngcontent"!==n.substring(0,10)&&"_nghost"!==n.substring(0,7))){var o=i.value;"class"===i.name&&(o=ut(o).join(" ")),s["attr__"+i.name]=Bt(1024,o)}}));for(var a=1,l=1,c=e;c=Ut(c);)a++,c.tagName===e.tagName&&l++;return s.nth_child=a,s.nth_of_type=l,s}(e,s,o,a));var i=function(e){if(!mt(e))return{};var t={};return ce(e.attributes,(function(e){if(e.name&&0===e.name.indexOf("data-ph-capture-attribute")){var i=e.name.replace("data-ph-capture-attribute-",""),r=e.value;i&&r&&It(r)&&(t[i]=r)}})),t}(e);ue(p,i)})),v)return{props:{},explicitNoCapture:v};if(o||("a"===e.tagName.toLowerCase()||"button"===e.tagName.toLowerCase()?d[0].$el_text=Ft(e):d[0].$el_text=gt(e)),g){var f,_;d[0].attr__href=g;var y=null==(f=At(g))?void 0:f.host,b=null==m||null==(_=m.location)?void 0:_.host;y&&b&&y!==b&&(h=g)}return{props:ue({$event_type:n.type,$ce_version:1},l?{}:{$elements:d},{$elements_chain:Ot(d)},null!=(i=d[0])&&i.$el_text?{$el_text:null==(r=d[0])?void 0:r.$el_text}:{},h&&"click"===n.type?{$external_click_url:h}:{},p)}}class jt{constructor(e){this.i=!1,this.o=null,this.rageclicks=new Pt,this.h=!1,this.instance=e,this.m=null}get S(){var e,t,i=H(this.instance.config.autocapture)?this.instance.config.autocapture:{};return i.url_allowlist=null==(e=i.url_allowlist)?void 0:e.map((e=>new RegExp(e))),i.url_ignorelist=null==(t=i.url_ignorelist)?void 0:t.map((e=>new RegExp(e))),i}$(){if(this.isBrowserSupported()){if(m&&x){var e=e=>{e=e||(null==m?void 0:m.event);try{this.k(e)}catch(e){Nt.error("Failed to capture event",e)}};if(ye(x,"submit",e,{capture:!0}),ye(x,"change",e,{capture:!0}),ye(x,"click",e,{capture:!0}),this.S.capture_copied_text){var t=e=>{e=e||(null==m?void 0:m.event),this.k(e,P)};ye(x,"copy",t,{capture:!0}),ye(x,"cut",t,{capture:!0})}}}else Nt.info("Disabling Automatic Event Collection because this browser is not supported")}startIfEnabled(){this.isEnabled&&!this.i&&(this.$(),this.i=!0)}onRemoteConfig(e){e.elementsChainAsString&&(this.h=e.elementsChainAsString),this.instance.persistence&&this.instance.persistence.register({[ke]:!!e.autocapture_opt_out}),this.o=!!e.autocapture_opt_out,this.startIfEnabled()}setElementSelectors(e){this.m=e}getElementSelectors(e){var t,i=[];return null==(t=this.m)||t.forEach((t=>{var r=null==x?void 0:x.querySelectorAll(t);null==r||r.forEach((r=>{e===r&&i.push(t)}))})),i}get isEnabled(){var e,t,i=null==(e=this.instance.persistence)?void 0:e.props[ke],r=this.o;if(Y(r)&&!Z(i)&&!this.instance.config.advanced_disable_decide)return!1;var n=null!==(t=this.o)&&void 0!==t?t:!!i;return!!this.instance.config.autocapture&&!n}k(e,t){if(void 0===t&&(t="$autocapture"),this.isEnabled){var i,r=vt(e);lt(r)&&(r=r.parentNode||null),"$autocapture"===t&&"click"===e.type&&e instanceof MouseEvent&&this.instance.config.rageclick&&null!=(i=this.rageclicks)&&i.isRageClick(e.clientX,e.clientY,(new Date).getTime())&&this.k(e,"$rageclick");var n=t===P;if(r&&function(e,t,i,r,n){var s,o,a;if(void 0===i&&(i=void 0),!m||!e||at(e,"html")||!ot(e))return!1;if(null!=(s=i)&&s.url_allowlist&&!ht(i.url_allowlist))return!1;if(null!=(o=i)&&o.url_ignorelist&&ht(i.url_ignorelist))return!1;if(null!=(a=i)&&a.dom_event_allowlist){var l=i.dom_event_allowlist;if(l&&!l.some((e=>t.type===e)))return!1}for(var c=!1,u=[e],h=!0,d=e;d.parentNode&&!at(d,"body");)if(ct(d.parentNode))u.push(d.parentNode.host),d=d.parentNode.host;else{if(!(h=_t(d)))break;if(r||ft.indexOf(h.tagName.toLowerCase())>-1)c=!0;else{var p=m.getComputedStyle(h);p&&"pointer"===p.getPropertyValue("cursor")&&(c=!0)}u.push(h),d=h}if(!function(e,t){var i=null==t?void 0:t.element_allowlist;if(K(i))return!0;var r=function(e){if(i.some((t=>e.tagName.toLowerCase()===t)))return{v:!0}};for(var n of e){var s=r(n);if("object"==typeof s)return s.v}return!1}(u,i))return!1;if(!function(e,t){var i=null==t?void 0:t.css_selector_allowlist;if(K(i))return!0;var r=function(e){if(i.some((t=>e.matches(t))))return{v:!0}};for(var n of e){var s=r(n);if("object"==typeof s)return s.v}return!1}(u,i))return!1;var g=m.getComputedStyle(e);if(g&&"pointer"===g.getPropertyValue("cursor")&&"click"===t.type)return!0;var v=e.tagName.toLowerCase();switch(v){case"html":return!1;case"form":return(n||["submit"]).indexOf(t.type)>=0;case"input":case"select":case"textarea":return(n||["change","click"]).indexOf(t.type)>=0;default:return c?(n||["click"]).indexOf(t.type)>=0:(n||["click"]).indexOf(t.type)>=0&&(ft.indexOf(v)>-1||"true"===e.getAttribute("contenteditable"))}}(r,e,this.S,n,n?["copy","cut"]:void 0)){var{props:s,explicitNoCapture:o}=qt(r,{e,maskAllElementAttributes:this.instance.config.mask_all_element_attributes,maskAllText:this.instance.config.mask_all_text,elementAttributeIgnoreList:this.S.element_attribute_ignorelist,elementsChainAsString:this.h});if(o)return!1;var a=this.getElementSelectors(r);if(a&&a.length>0&&(s.$element_selectors=a),t===P){var l,c=pt(null==m||null==(l=m.getSelection())?void 0:l.toString()),u=e.type||"clipboard";if(!c)return!1;s.$selected_content=c,s.$copy_type=u}return this.instance.capture(t,s),!0}}}isBrowserSupported(){return G(null==x?void 0:x.querySelectorAll)}}Math.trunc||(Math.trunc=function(e){return e<0?Math.ceil(e):Math.floor(e)}),Number.isInteger||(Number.isInteger=function(e){return X(e)&&isFinite(e)&&Math.floor(e)===e});var Gt="0123456789abcdef";class Ht{constructor(e){if(this.bytes=e,16!==e.length)throw new TypeError("not 128-bit length")}static fromFieldsV7(e,t,i,r){if(!Number.isInteger(e)||!Number.isInteger(t)||!Number.isInteger(i)||!Number.isInteger(r)||e<0||t<0||i<0||r<0||e>0xffffffffffff||t>4095||i>1073741823||r>4294967295)throw new RangeError("invalid field value");var n=new Uint8Array(16);return n[0]=e/Math.pow(2,40),n[1]=e/Math.pow(2,32),n[2]=e/Math.pow(2,24),n[3]=e/Math.pow(2,16),n[4]=e/Math.pow(2,8),n[5]=e,n[6]=112|t>>>8,n[7]=t,n[8]=128|i>>>24,n[9]=i>>>16,n[10]=i>>>8,n[11]=i,n[12]=r>>>24,n[13]=r>>>16,n[14]=r>>>8,n[15]=r,new Ht(n)}toString(){for(var e="",t=0;t<this.bytes.length;t++)e=e+Gt.charAt(this.bytes[t]>>>4)+Gt.charAt(15&this.bytes[t]),3!==t&&5!==t&&7!==t&&9!==t||(e+="-");if(36!==e.length)throw new Error("Invalid UUIDv7 was generated");return e}clone(){return new Ht(this.bytes.slice(0))}equals(e){return 0===this.compareTo(e)}compareTo(e){for(var t=0;t<16;t++){var i=this.bytes[t]-e.bytes[t];if(0!==i)return Math.sign(i)}return 0}}class Wt{constructor(){this.I=0,this.P=0,this.R=new Vt}generate(){var e=this.generateOrAbort();if(K(e)){this.I=0;var t=this.generateOrAbort();if(K(t))throw new Error("Could not generate UUID after timestamp reset");return t}return e}generateOrAbort(){var e=Date.now();if(e>this.I)this.I=e,this.T();else{if(!(e+1e4>this.I))return;this.P++,this.P>4398046511103&&(this.I++,this.T())}return Ht.fromFieldsV7(this.I,Math.trunc(this.P/Math.pow(2,30)),this.P&Math.pow(2,30)-1,this.R.nextUint32())}T(){this.P=1024*this.R.nextUint32()+(1023&this.R.nextUint32())}}var Kt,zt=e=>{if("undefined"!=typeof UUIDV7_DENY_WEAK_RNG&&UUIDV7_DENY_WEAK_RNG)throw new Error("no cryptographically strong RNG available");for(var t=0;t<e.length;t++)e[t]=65536*Math.trunc(65536*Math.random())+Math.trunc(65536*Math.random());return e};m&&!K(m.crypto)&&crypto.getRandomValues&&(zt=e=>crypto.getRandomValues(e));class Vt{constructor(){this.M=new Uint32Array(8),this.C=1/0}nextUint32(){return this.C>=this.M.length&&(zt(this.M),this.C=0),this.M[this.C++]}}var Yt=()=>Jt().toString(),Jt=()=>(Kt||(Kt=new Wt)).generate(),Xt="",Zt=/[a-z0-9][a-z0-9-]+\.[a-z]{2,}$/i;var Qt,ei={O:()=>!!x,F:function(e){te.error("cookieStore error: "+e)},A:function(e){if(x){try{for(var t=e+"=",i=x.cookie.split(";").filter((e=>e.length)),r=0;r<i.length;r++){for(var n=i[r];" "==n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(t))return decodeURIComponent(n.substring(t.length,n.length))}}catch(e){}return null}},D:function(e){var t;try{t=JSON.parse(ei.A(e))||{}}catch(e){}return t},j:function(e,t,i,r,n){if(x)try{var s="",o="",a=function(e,t){if(t){var i=function(e,t){if(void 0===t&&(t=x),Xt)return Xt;if(!t)return"";if(["localhost","127.0.0.1"].includes(e))return"";for(var i=e.split("."),r=Math.min(i.length,8),n="dmn_chk_"+Yt(),s=new RegExp("(^|;)\\s*"+n+"=1");!Xt&&r--;){var o=i.slice(r).join("."),a=n+"=1;domain=."+o;t.cookie=a,s.test(t.cookie)&&(t.cookie=a+";expires=Thu, 01 Jan 1970 00:00:00 GMT",Xt=o)}return Xt}(e);if(!i){var r=(e=>{var t=e.match(Zt);return t?t[0]:""})(e);r!==i&&te.info("Warning: cookie subdomain discovery mismatch",r,i),i=r}return i?"; domain=."+i:""}return""}(x.location.hostname,r);if(i){var l=new Date;l.setTime(l.getTime()+24*i*60*60*1e3),s="; expires="+l.toUTCString()}n&&(o="; secure");var c=e+"="+encodeURIComponent(JSON.stringify(t))+s+"; SameSite=Lax; path=/"+a+o;return c.length>3686.4&&te.warn("cookieStore warning: large cookie, len="+c.length),x.cookie=c,c}catch(e){return}},L:function(e,t){try{ei.j(e,"",-1,t)}catch(e){return}}},ti=null,ii={O:function(){if(!Y(ti))return ti;var e=!0;if(K(m))e=!1;else try{var t="__mplssupport__";ii.j(t,"xyz"),'"xyz"'!==ii.A(t)&&(e=!1),ii.L(t)}catch(t){e=!1}return e||te.error("localStorage unsupported; falling back to cookie store"),ti=e,e},F:function(e){te.error("localStorage error: "+e)},A:function(e){try{return null==m?void 0:m.localStorage.getItem(e)}catch(e){ii.F(e)}return null},D:function(e){try{return JSON.parse(ii.A(e))||{}}catch(e){}return null},j:function(e,t){try{null==m||m.localStorage.setItem(e,JSON.stringify(t))}catch(e){ii.F(e)}},L:function(e){try{null==m||m.localStorage.removeItem(e)}catch(e){ii.F(e)}}},ri=["distinct_id",Le,Ne,tt,et],ni=se({},ii,{D:function(e){try{var t={};try{t=ei.D(e)||{}}catch(e){}var i=ue(t,JSON.parse(ii.A(e)||"{}"));return ii.j(e,i),i}catch(e){}return null},j:function(e,t,i,r,n,s){try{ii.j(e,t,void 0,void 0,s);var o={};ri.forEach((e=>{t[e]&&(o[e]=t[e])})),Object.keys(o).length&&ei.j(e,o,i,r,n,s)}catch(e){ii.F(e)}},L:function(e,t){try{null==m||m.localStorage.removeItem(e),ei.L(e,t)}catch(e){ii.F(e)}}}),si={},oi={O:function(){return!0},F:function(e){te.error("memoryStorage error: "+e)},A:function(e){return si[e]||null},D:function(e){return si[e]||null},j:function(e,t){si[e]=t},L:function(e){delete si[e]}},ai=null,li={O:function(){if(!Y(ai))return ai;if(ai=!0,K(m))ai=!1;else try{var e="__support__";li.j(e,"xyz"),'"xyz"'!==li.A(e)&&(ai=!1),li.L(e)}catch(e){ai=!1}return ai},F:function(e){te.error("sessionStorage error: ",e)},A:function(e){try{return null==m?void 0:m.sessionStorage.getItem(e)}catch(e){li.F(e)}return null},D:function(e){try{return JSON.parse(li.A(e))||null}catch(e){}return null},j:function(e,t){try{null==m||m.sessionStorage.setItem(e,JSON.stringify(t))}catch(e){li.F(e)}},L:function(e){try{null==m||m.sessionStorage.removeItem(e)}catch(e){li.F(e)}}};!function(e){e[e.PENDING=-1]="PENDING",e[e.DENIED=0]="DENIED",e[e.GRANTED=1]="GRANTED"}(Qt||(Qt={}));class ci{constructor(e){this._instance=e}get S(){return this._instance.config}get consent(){return this.N()?Qt.DENIED:this.U}isOptedOut(){return this.consent===Qt.DENIED||this.consent===Qt.PENDING&&this.S.opt_out_capturing_by_default}isOptedIn(){return!this.isOptedOut()}optInOut(e){this.q.j(this.B,e?1:0,this.S.cookie_expiration,this.S.cross_subdomain_cookie,this.S.secure_cookie)}reset(){this.q.L(this.B,this.S.cross_subdomain_cookie)}get B(){var{token:e,opt_out_capturing_cookie_prefix:t}=this._instance.config;return(t||"__ph_opt_in_out_")+e}get U(){var e=this.q.A(this.B);return"1"===e?Qt.GRANTED:"0"===e?Qt.DENIED:Qt.PENDING}get q(){if(!this.H){var e=this.S.opt_out_capturing_persistence_type;this.H="localStorage"===e?ii:ei;var t="localStorage"===e?ei:ii;t.A(this.B)&&(this.H.A(this.B)||this.optInOut("1"===t.A(this.B)),t.L(this.B,this.S.cross_subdomain_cookie))}return this.H}N(){return!!this.S.respect_dnt&&!!me([null==k?void 0:k.doNotTrack,null==k?void 0:k.msDoNotTrack,$.doNotTrack],(e=>D([!0,1,"1","yes"],e)))}}var ui=ie("[Dead Clicks]"),hi=()=>!0,di=e=>{var t,i=!(null==(t=e.instance.persistence)||!t.get_property(Fe)),r=e.instance.config.capture_dead_clicks;return Z(r)?r:i};class pi{get lazyLoadedDeadClicksAutocapture(){return this.W}constructor(e,t,i){this.instance=e,this.isEnabled=t,this.onCapture=i,this.startIfEnabled()}onRemoteConfig(e){this.instance.persistence&&this.instance.persistence.register({[Fe]:null==e?void 0:e.captureDeadClicks}),this.startIfEnabled()}startIfEnabled(){this.isEnabled(this)&&this.G((()=>{this.J()}))}G(e){var t,i;null!=(t=$.__PosthogExtensions__)&&t.initDeadClicksAutocapture&&e(),null==(i=$.__PosthogExtensions__)||null==i.loadExternalDependency||i.loadExternalDependency(this.instance,"dead-clicks-autocapture",(t=>{t?ui.error("failed to load script",t):e()}))}J(){var e;if(x){if(!this.W&&null!=(e=$.__PosthogExtensions__)&&e.initDeadClicksAutocapture){var t=H(this.instance.config.capture_dead_clicks)?this.instance.config.capture_dead_clicks:{};t.__onCapture=this.onCapture,this.W=$.__PosthogExtensions__.initDeadClicksAutocapture(this.instance,t),this.W.start(x),ui.info("starting...")}}else ui.error("`document` not found. Cannot start.")}stop(){this.W&&(this.W.stop(),this.W=void 0,ui.info("stopping..."))}}var gi=ie("[ExceptionAutocapture]");class vi{constructor(e){var t;this.V=()=>{var e;if(m&&this.isEnabled&&null!=(e=$.__PosthogExtensions__)&&e.errorWrappingFunctions){var t=$.__PosthogExtensions__.errorWrappingFunctions.wrapOnError,i=$.__PosthogExtensions__.errorWrappingFunctions.wrapUnhandledRejection,r=$.__PosthogExtensions__.errorWrappingFunctions.wrapConsoleError;try{!this.K&&this.S.capture_unhandled_errors&&(this.K=t(this.captureException.bind(this))),!this.Y&&this.S.capture_unhandled_rejections&&(this.Y=i(this.captureException.bind(this))),!this.X&&this.S.capture_console_errors&&(this.X=r(this.captureException.bind(this)))}catch(e){gi.error("failed to start",e),this.Z()}}},this._instance=e,this.tt=!(null==(t=this._instance.persistence)||!t.props[Se]),this.S=this.it(),this.startIfEnabled()}it(){var e=this._instance.config.capture_exceptions,t={capture_unhandled_errors:!1,capture_unhandled_rejections:!1,capture_console_errors:!1};return H(e)?t=se({},t,e):(K(e)?this.tt:e)&&(t=se({},t,{capture_unhandled_errors:!0,capture_unhandled_rejections:!0})),t}get isEnabled(){return this.S.capture_console_errors||this.S.capture_unhandled_errors||this.S.capture_unhandled_rejections}startIfEnabled(){this.isEnabled&&(gi.info("enabled"),this.G(this.V))}G(e){var t,i;null!=(t=$.__PosthogExtensions__)&&t.errorWrappingFunctions&&e(),null==(i=$.__PosthogExtensions__)||null==i.loadExternalDependency||i.loadExternalDependency(this._instance,"exception-autocapture",(t=>{if(t)return gi.error("failed to load script",t);e()}))}Z(){var e,t,i;null==(e=this.K)||e.call(this),this.K=void 0,null==(t=this.Y)||t.call(this),this.Y=void 0,null==(i=this.X)||i.call(this),this.X=void 0}onRemoteConfig(e){var t=e.autocaptureExceptions;this.tt=!!t||!1,this.S=this.it(),this._instance.persistence&&this._instance.persistence.register({[Se]:this.tt}),this.startIfEnabled()}captureException(e){var t=this._instance.requestRouter.endpointFor("ui");e.$exception_personURL=t+"/project/"+this._instance.config.token+"/person/"+this._instance.get_distinct_id(),this._instance.exceptions.sendExceptionEvent(e)}}function fi(e){return!K(Event)&&_i(e,Event)}function _i(e,t){try{return e instanceof t}catch(e){return!1}}function mi(e){switch(Object.prototype.toString.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object DOMError]":return!0;default:return _i(e,Error)}}function yi(e,t){return Object.prototype.toString.call(e)==="[object "+t+"]"}function bi(e){return yi(e,"DOMError")}var wi=/\(error: (.*)\)/,Ei="?";function ki(e,t,i,r){var n={platform:"web:javascript",filename:e,function:"<anonymous>"===t?Ei:t,in_app:!0};return K(i)||(n.lineno=i),K(r)||(n.colno=r),n}var xi=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,Si=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,Ii=/\((\S*)(?::(\d+))(?::(\d+))\)/,Fi=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,Ri=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,Oi=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var r=t.sort(((e,t)=>e[0]-t[0])).map((e=>e[1]));return function(e,t){void 0===t&&(t=0);for(var i=[],n=e.split("\n"),s=t;s<n.length;s++){var o=n[s];if(!(o.length>1024)){var a=wi.test(o)?o.replace(wi,"$1"):o;if(!a.match(/\S*Error: /)){for(var l of r){var c=l(a);if(c){i.push(c);break}}if(i.length>=50)break}}}return function(e){if(!e.length)return[];var t=Array.from(e);return t.reverse(),t.slice(0,50).map((e=>se({},e,{filename:e.filename||$i(t).filename,function:e.function||Ei})))}(i)}}([30,e=>{var t=xi.exec(e);if(t){var[,i,r,n]=t;return ki(i,Ei,+r,+n)}var s=Si.exec(e);if(s){if(s[2]&&0===s[2].indexOf("eval")){var o=Ii.exec(s[2]);o&&(s[2]=o[1],s[3]=o[2],s[4]=o[3])}var[a,l]=Ai(s[1]||Ei,s[2]);return ki(l,a,s[3]?+s[3]:void 0,s[4]?+s[4]:void 0)}}],[50,e=>{var t=Fi.exec(e);if(t){if(t[3]&&t[3].indexOf(" > eval")>-1){var i=Ri.exec(t[3]);i&&(t[1]=t[1]||"eval",t[3]=i[1],t[4]=i[2],t[5]="")}var r=t[3],n=t[1]||Ei;return[n,r]=Ai(n,r),ki(r,n,t[4]?+t[4]:void 0,t[5]?+t[5]:void 0)}}]);function $i(e){return e[e.length-1]||{}}var Ci,Pi,Mi,Ai=(e,t)=>{var i=-1!==e.indexOf("safari-extension"),r=-1!==e.indexOf("safari-web-extension");return i||r?[-1!==e.indexOf("@")?e.split("@")[0]:Ei,i?"safari-extension:"+t:"safari-web-extension:"+t]:[e,t]},Di=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/i;function Ti(e,t){void 0===t&&(t=0);var i=e.stacktrace||e.stack||"",r=function(e){return e&&Li.test(e.message)?1:0}(e);try{var n=Oi,s=function(e,t){var i=function(e){var t=globalThis._posthogChunkIds;if(!t)return{};var i=Object.keys(t);return Mi&&i.length===Pi||(Pi=i.length,Mi=i.reduce(((i,r)=>{Ci||(Ci={});var n=Ci[r];if(n)i[n[0]]=n[1];else for(var s=e(r),o=s.length-1;o>=0;o--){var a=s[o],l=null==a?void 0:a.filename,c=t[r];if(l&&c){i[l]=c,Ci[r]=[l,c];break}}return i}),{})),Mi}(t);return e.forEach((e=>{e.filename&&(e.chunk_id=i[e.filename])})),e}(n(i,r),n);return s.slice(0,s.length-t)}catch(e){}return[]}var Li=/Minified React error #\d+;/i;function Ni(e,t){var i=function(e,t){var i,r,n=Ti(e),s=null===(i=null==t?void 0:t.handled)||void 0===i||i,o=null!==(r=null==t?void 0:t.synthetic)&&void 0!==r&&r;return{type:null!=t&&t.overrideExceptionType?t.overrideExceptionType:e.name,value:function(e){var t=e.message;return t.error&&"string"==typeof t.error.message?String(t.error.message):String(t)}(e),stacktrace:{frames:n,type:"raw"},mechanism:{handled:s,synthetic:o}}}(e,t);return e.cause&&mi(e.cause)&&e.cause!==e?[i,...Ni(e.cause,{handled:null==t?void 0:t.handled,synthetic:null==t?void 0:t.synthetic})]:[i]}function Bi(e,t){return{$exception_list:Ni(e,t),$exception_level:"error"}}function Ui(e,t){var i,r,n,s=null===(i=null==t?void 0:t.handled)||void 0===i||i,o=null===(r=null==t?void 0:t.synthetic)||void 0===r||r,a={type:null!=t&&t.overrideExceptionType?t.overrideExceptionType:null!==(n=null==t?void 0:t.defaultExceptionType)&&void 0!==n?n:"Error",value:e||(null==t?void 0:t.defaultExceptionMessage),mechanism:{handled:s,synthetic:o}};if(null!=t&&t.syntheticException){var l=Ti(t.syntheticException,1);l.length&&(a.stacktrace={frames:l,type:"raw"})}return{$exception_list:[a],$exception_level:"error"}}function qi(e){return z(e)&&!V(e)&&A.indexOf(e)>=0}function ji(e,t){var{error:i,event:r}=e,n={$exception_list:[]},s=i||r;if(bi(s)||function(e){return yi(e,"DOMException")}(s)){var o=s;if(function(e){return"stack"in e}(s))n=Bi(s,t);else{var a=o.name||(bi(o)?"DOMError":"DOMException"),l=o.message?a+": "+o.message:a;n=Ui(l,se({},t,{overrideExceptionType:bi(o)?"DOMError":"DOMException",defaultExceptionMessage:l}))}return"code"in o&&(n.$exception_DOMException_code=""+o.code),n}if(function(e){return yi(e,"ErrorEvent")}(s)&&s.error)return Bi(s.error,t);if(mi(s))return Bi(s,t);if(function(e){return yi(e,"Object")}(s)||fi(s))return function(e,t){var i,r,n=null===(i=null==t?void 0:t.handled)||void 0===i||i,s=null===(r=null==t?void 0:t.synthetic)||void 0===r||r,o=null!=t&&t.overrideExceptionType?t.overrideExceptionType:fi(e)?e.constructor.name:"Error",a="Non-Error 'exception' captured with keys: "+function(e,t){void 0===t&&(t=40);var i=Object.keys(e);if(i.sort(),!i.length)return"[object has no keys]";for(var r=i.length;r>0;r--){var n=i.slice(0,r).join(", ");if(!(n.length>t))return r===i.length||n.length<=t?n:n.slice(0,t)+"..."}return""}(e),l={type:o,value:a,mechanism:{handled:n,synthetic:s}};if(null!=t&&t.syntheticException){var c=Ti(null==t?void 0:t.syntheticException,1);c.length&&(l.stacktrace={frames:c,type:"raw"})}return{$exception_list:[l],$exception_level:qi(e.level)?e.level:"error"}}(s,t);if(K(i)&&z(r)){var c="Error",u=r,h=r.match(Di);return h&&(c=h[1],u=h[2]),Ui(u,se({},t,{overrideExceptionType:c,defaultExceptionMessage:u}))}return Ui(s,t)}function Gi(e,t,i){try{if(!(t in e))return()=>{};var r=e[t],n=i(r);return G(n)&&(n.prototype=n.prototype||{},Object.defineProperties(n,{__posthog_wrapped__:{enumerable:!1,value:!0}})),e[t]=n,()=>{e[t]=r}}catch(e){return()=>{}}}class Hi{constructor(e){var t;this._instance=e,this.et=(null==m||null==(t=m.location)?void 0:t.pathname)||""}get isEnabled(){return"history_change"===this._instance.config.capture_pageview}startIfEnabled(){this.isEnabled&&(te.info("History API monitoring enabled, starting..."),this.monitorHistoryChanges())}stop(){this.rt&&this.rt(),this.rt=void 0,te.info("History API monitoring stopped")}monitorHistoryChanges(){var e,t;if(m&&m.history){var i=this;null!=(e=m.history.pushState)&&e.__posthog_wrapped__||Gi(m.history,"pushState",(e=>function(t,r,n){e.call(this,t,r,n),i.st("pushState")})),null!=(t=m.history.replaceState)&&t.__posthog_wrapped__||Gi(m.history,"replaceState",(e=>function(t,r,n){e.call(this,t,r,n),i.st("replaceState")})),this.nt()}}st(e){try{var t,i=null==m||null==(t=m.location)?void 0:t.pathname;if(!i)return;i!==this.et&&this.isEnabled&&this._instance.capture("$pageview",{navigation_type:e}),this.et=i}catch(t){te.error("Error capturing "+e+" pageview",t)}}nt(){if(!this.rt){var e=()=>{this.st("popstate")};ye(m,"popstate",e),this.rt=()=>{m&&m.removeEventListener("popstate",e)}}}}function Wi(e){var t,i;return(null==(t=JSON.stringify(e,(i=[],function(e,t){if(H(t)){for(;i.length>0&&i[i.length-1]!==this;)i.pop();return i.includes(t)?"[Circular]":(i.push(t),t)}return t})))?void 0:t.length)||0}function Ki(e,t){if(void 0===t&&(t=6606028.8),e.size>=t&&e.data.length>1){var i=Math.floor(e.data.length/2),r=e.data.slice(0,i),n=e.data.slice(i);return[Ki({size:Wi(r),data:r,sessionId:e.sessionId,windowId:e.windowId}),Ki({size:Wi(n),data:n,sessionId:e.sessionId,windowId:e.windowId})].flatMap((e=>e))}return[e]}var zi=(e=>(e[e.DomContentLoaded=0]="DomContentLoaded",e[e.Load=1]="Load",e[e.FullSnapshot=2]="FullSnapshot",e[e.IncrementalSnapshot=3]="IncrementalSnapshot",e[e.Meta=4]="Meta",e[e.Custom=5]="Custom",e[e.Plugin=6]="Plugin",e))(zi||{}),Vi=(e=>(e[e.Mutation=0]="Mutation",e[e.MouseMove=1]="MouseMove",e[e.MouseInteraction=2]="MouseInteraction",e[e.Scroll=3]="Scroll",e[e.ViewportResize=4]="ViewportResize",e[e.Input=5]="Input",e[e.TouchMove=6]="TouchMove",e[e.MediaInteraction=7]="MediaInteraction",e[e.StyleSheetRule=8]="StyleSheetRule",e[e.CanvasMutation=9]="CanvasMutation",e[e.Font=10]="Font",e[e.Log=11]="Log",e[e.Drag=12]="Drag",e[e.StyleDeclaration=13]="StyleDeclaration",e[e.Selection=14]="Selection",e[e.AdoptedStyleSheet=15]="AdoptedStyleSheet",e[e.CustomElement=16]="CustomElement",e))(Vi||{}),Yi="[SessionRecording]",Ji="redacted",Xi={initiatorTypes:["audio","beacon","body","css","early-hint","embed","fetch","frame","iframe","icon","image","img","input","link","navigation","object","ping","script","track","video","xmlhttprequest"],maskRequestFn:e=>e,recordHeaders:!1,recordBody:!1,recordInitialRequests:!1,recordPerformance:!1,performanceEntryTypeToObserve:["first-input","navigation","paint","resource"],payloadSizeLimitBytes:1e6,payloadHostDenyList:[".lr-ingest.io",".ingest.sentry.io",".clarity.ms","analytics.google.com"]},Zi=["authorization","x-forwarded-for","authorization","cookie","set-cookie","x-api-key","x-real-ip","remote-addr","forwarded","proxy-authorization","x-csrf-token","x-csrftoken","x-xsrf-token"],Qi=["password","secret","passwd","api_key","apikey","auth","credentials","mysql_pwd","privatekey","private_key","token"],er=["/s/","/e/","/i/"];function tr(e,t,i,r){if(J(e))return e;var n=(null==t?void 0:t["content-length"])||function(e){return new Blob([e]).size}(e);return z(n)&&(n=parseInt(n)),n>i?Yi+" "+r+" body too large to record ("+n+" bytes)":e}function ir(e,t){if(J(e))return e;var i=e;return It(i,!1)||(i=Yi+" "+t+" body "+Ji),ce(Qi,(e=>{var r,n;null!=(r=i)&&r.length&&-1!==(null==(n=i)?void 0:n.indexOf(e))&&(i=Yi+" "+t+" body "+Ji+" as might contain: "+e)})),i}function rr(e,t,i,r,n){return t>i&&(te.warn("min cannot be greater than max."),t=i),X(e)?e>i?(r&&te.warn(r+" cannot be  greater than max: "+i+". Using max value instead."),i):e<t?(r&&te.warn(r+" cannot be less than min: "+t+". Using min value instead."),t):e:(r&&te.warn(r+" must be a number. using max or fallback. max: "+i+", fallback: "+n),rr(n||i,t,i,r))}class nr{constructor(e,t){var i,r;void 0===t&&(t={}),this.ot=100,this.lt=10,this.ht={},this.ut={},this.dt=()=>{Object.keys(this.ht).forEach((e=>{this.ht[e]=this.ht[e]+this.lt,this.ht[e]>=this.ot&&delete this.ht[e]}))},this.vt=e=>{var t=this._rrweb.mirror.getNode(e);if("svg"!==(null==t?void 0:t.nodeName)&&t instanceof Element){var i=t.closest("svg");if(i)return[this._rrweb.mirror.getId(i),i]}return[e,t]},this.ct=e=>{var t,i,r,n,s,o,a,l;return(null!==(t=null==(i=e.removes)?void 0:i.length)&&void 0!==t?t:0)+(null!==(r=null==(n=e.attributes)?void 0:n.length)&&void 0!==r?r:0)+(null!==(s=null==(o=e.texts)?void 0:o.length)&&void 0!==s?s:0)+(null!==(a=null==(l=e.adds)?void 0:l.length)&&void 0!==a?a:0)},this.throttleMutations=e=>{if(3!==e.type||0!==e.data.source)return e;var t=e.data,i=this.ct(t);t.attributes&&(t.attributes=t.attributes.filter((e=>{var t,i,r,[n,s]=this.vt(e.id);return 0!==this.ht[n]&&(this.ht[n]=null!==(t=this.ht[n])&&void 0!==t?t:this.ot,this.ht[n]=Math.max(this.ht[n]-1,0),0===this.ht[n]&&(this.ut[n]||(this.ut[n]=!0,null==(i=(r=this.ft).onBlockedNode)||i.call(r,n,s))),e)})));var r=this.ct(t);return 0!==r||i===r?e:void 0},this._rrweb=e,this.ft=t,this.lt=rr(null!==(i=this.ft.refillRate)&&void 0!==i?i:this.lt,0,100,"mutation throttling refill rate"),this.ot=rr(null!==(r=this.ft.bucketSize)&&void 0!==r?r:this.ot,0,100,"mutation throttling bucket size"),setInterval((()=>{this.dt()}),1e3)}}var sr=Uint8Array,or=Uint16Array,ar=Uint32Array,lr=new sr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),cr=new sr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ur=new sr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),hr=function(e,t){for(var i=new or(31),r=0;r<31;++r)i[r]=t+=1<<e[r-1];var n=new ar(i[30]);for(r=1;r<30;++r)for(var s=i[r];s<i[r+1];++s)n[s]=s-i[r]<<5|r;return[i,n]},dr=hr(lr,2),pr=dr[0],gr=dr[1];pr[28]=258,gr[258]=28;for(var vr=hr(cr,0)[1],fr=new or(32768),_r=0;_r<32768;++_r){var mr=(43690&_r)>>>1|(21845&_r)<<1;mr=(61680&(mr=(52428&mr)>>>2|(13107&mr)<<2))>>>4|(3855&mr)<<4,fr[_r]=((65280&mr)>>>8|(255&mr)<<8)>>>1}var yr=function(e,t,i){for(var r=e.length,n=0,s=new or(t);n<r;++n)++s[e[n]-1];var o,a=new or(t);for(n=0;n<t;++n)a[n]=a[n-1]+s[n-1]<<1;if(i){o=new or(1<<t);var l=15-t;for(n=0;n<r;++n)if(e[n])for(var c=n<<4|e[n],u=t-e[n],h=a[e[n]-1]++<<u,d=h|(1<<u)-1;h<=d;++h)o[fr[h]>>>l]=c}else for(o=new or(r),n=0;n<r;++n)o[n]=fr[a[e[n]-1]++]>>>15-e[n];return o},br=new sr(288);for(_r=0;_r<144;++_r)br[_r]=8;for(_r=144;_r<256;++_r)br[_r]=9;for(_r=256;_r<280;++_r)br[_r]=7;for(_r=280;_r<288;++_r)br[_r]=8;var wr=new sr(32);for(_r=0;_r<32;++_r)wr[_r]=5;var Er=yr(br,9,0),kr=yr(wr,5,0),xr=function(e){return(e/8|0)+(7&e&&1)},Sr=function(e,t,i){(null==i||i>e.length)&&(i=e.length);var r=new(e instanceof or?or:e instanceof ar?ar:sr)(i-t);return r.set(e.subarray(t,i)),r},Ir=function(e,t,i){i<<=7&t;var r=t/8|0;e[r]|=i,e[r+1]|=i>>>8},Fr=function(e,t,i){i<<=7&t;var r=t/8|0;e[r]|=i,e[r+1]|=i>>>8,e[r+2]|=i>>>16},Rr=function(e,t){for(var i=[],r=0;r<e.length;++r)e[r]&&i.push({s:r,f:e[r]});var n=i.length,s=i.slice();if(!n)return[new sr(0),0];if(1==n){var o=new sr(i[0].s+1);return o[i[0].s]=1,[o,1]}i.sort((function(e,t){return e.f-t.f})),i.push({s:-1,f:25001});var a=i[0],l=i[1],c=0,u=1,h=2;for(i[0]={s:-1,f:a.f+l.f,l:a,r:l};u!=n-1;)a=i[i[c].f<i[h].f?c++:h++],l=i[c!=u&&i[c].f<i[h].f?c++:h++],i[u++]={s:-1,f:a.f+l.f,l:a,r:l};var d=s[0].s;for(r=1;r<n;++r)s[r].s>d&&(d=s[r].s);var p=new or(d+1),g=Or(i[u-1],p,0);if(g>t){r=0;var v=0,f=g-t,_=1<<f;for(s.sort((function(e,t){return p[t.s]-p[e.s]||e.f-t.f}));r<n;++r){var m=s[r].s;if(!(p[m]>t))break;v+=_-(1<<g-p[m]),p[m]=t}for(v>>>=f;v>0;){var y=s[r].s;p[y]<t?v-=1<<t-p[y]++-1:++r}for(;r>=0&&v;--r){var b=s[r].s;p[b]==t&&(--p[b],++v)}g=t}return[new sr(p),g]},Or=function(e,t,i){return-1==e.s?Math.max(Or(e.l,t,i+1),Or(e.r,t,i+1)):t[e.s]=i},$r=function(e){for(var t=e.length;t&&!e[--t];);for(var i=new or(++t),r=0,n=e[0],s=1,o=function(e){i[r++]=e},a=1;a<=t;++a)if(e[a]==n&&a!=t)++s;else{if(!n&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(n),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(n);s=1,n=e[a]}return[i.subarray(0,r),t]},Cr=function(e,t){for(var i=0,r=0;r<t.length;++r)i+=e[r]*t[r];return i},Pr=function(e,t,i){var r=i.length,n=xr(t+2);e[n]=255&r,e[n+1]=r>>>8,e[n+2]=255^e[n],e[n+3]=255^e[n+1];for(var s=0;s<r;++s)e[n+s+4]=i[s];return 8*(n+4+r)},Mr=function(e,t,i,r,n,s,o,a,l,c,u){Ir(t,u++,i),++n[256];for(var h=Rr(n,15),d=h[0],p=h[1],g=Rr(s,15),v=g[0],f=g[1],_=$r(d),m=_[0],y=_[1],b=$r(v),w=b[0],E=b[1],k=new or(19),x=0;x<m.length;++x)k[31&m[x]]++;for(x=0;x<w.length;++x)k[31&w[x]]++;for(var S=Rr(k,7),I=S[0],F=S[1],R=19;R>4&&!I[ur[R-1]];--R);var O,$,C,P,M=c+5<<3,A=Cr(n,br)+Cr(s,wr)+o,D=Cr(n,d)+Cr(s,v)+o+14+3*R+Cr(k,I)+(2*k[16]+3*k[17]+7*k[18]);if(M<=A&&M<=D)return Pr(t,u,e.subarray(l,l+c));if(Ir(t,u,1+(D<A)),u+=2,D<A){O=yr(d,p,0),$=d,C=yr(v,f,0),P=v;var T=yr(I,F,0);for(Ir(t,u,y-257),Ir(t,u+5,E-1),Ir(t,u+10,R-4),u+=14,x=0;x<R;++x)Ir(t,u+3*x,I[ur[x]]);u+=3*R;for(var L=[m,w],N=0;N<2;++N){var B=L[N];for(x=0;x<B.length;++x){var U=31&B[x];Ir(t,u,T[U]),u+=I[U],U>15&&(Ir(t,u,B[x]>>>5&127),u+=B[x]>>>12)}}}else O=Er,$=br,C=kr,P=wr;for(x=0;x<a;++x)if(r[x]>255){U=r[x]>>>18&31,Fr(t,u,O[U+257]),u+=$[U+257],U>7&&(Ir(t,u,r[x]>>>23&31),u+=lr[U]);var q=31&r[x];Fr(t,u,C[q]),u+=P[q],q>3&&(Fr(t,u,r[x]>>>5&8191),u+=cr[q])}else Fr(t,u,O[r[x]]),u+=$[r[x]];return Fr(t,u,O[256]),u+$[256]},Ar=new ar([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Dr=function(){for(var e=new ar(256),t=0;t<256;++t){for(var i=t,r=9;--r;)i=(1&i&&3988292384)^i>>>1;e[t]=i}return e}(),Tr=function(e,t,i){for(;i;++t)e[t]=i,i>>>=8};function Lr(e,t){void 0===t&&(t={});var i=function(){var e=4294967295;return{p:function(t){for(var i=e,r=0;r<t.length;++r)i=Dr[255&i^t[r]]^i>>>8;e=i},d:function(){return 4294967295^e}}}(),r=e.length;i.p(e);var n=function(e,t,i,r,n){return function(e,t,i,r,n,s){var o=e.length,a=new sr(r+o+5*(1+Math.floor(o/7e3))+n),l=a.subarray(r,a.length-n),c=0;if(!t||o<8)for(var u=0;u<=o;u+=65535){var h=u+65535;h<o?c=Pr(l,c,e.subarray(u,h)):(l[u]=s,c=Pr(l,c,e.subarray(u,o)))}else{for(var d=Ar[t-1],p=d>>>13,g=8191&d,v=(1<<i)-1,f=new or(32768),_=new or(v+1),m=Math.ceil(i/3),y=2*m,b=function(t){return(e[t]^e[t+1]<<m^e[t+2]<<y)&v},w=new ar(25e3),E=new or(288),k=new or(32),x=0,S=0,I=(u=0,0),F=0,R=0;u<o;++u){var O=b(u),$=32767&u,C=_[O];if(f[$]=C,_[O]=$,F<=u){var P=o-u;if((x>7e3||I>24576)&&P>423){c=Mr(e,l,0,w,E,k,S,I,R,u-R,c),I=x=S=0,R=u;for(var M=0;M<286;++M)E[M]=0;for(M=0;M<30;++M)k[M]=0}var A=2,D=0,T=g,L=$-C&32767;if(P>2&&O==b(u-L))for(var N=Math.min(p,P)-1,B=Math.min(32767,u),U=Math.min(258,P);L<=B&&--T&&$!=C;){if(e[u+A]==e[u+A-L]){for(var q=0;q<U&&e[u+q]==e[u+q-L];++q);if(q>A){if(A=q,D=L,q>N)break;var j=Math.min(L,q-2),G=0;for(M=0;M<j;++M){var H=u-L+M+32768&32767,W=H-f[H]+32768&32767;W>G&&(G=W,C=H)}}}L+=($=C)-(C=f[$])+32768&32767}if(D){w[I++]=268435456|gr[A]<<18|vr[D];var K=31&gr[A],z=31&vr[D];S+=lr[K]+cr[z],++E[257+K],++k[z],F=u+A,++x}else w[I++]=e[u],++E[e[u]]}}c=Mr(e,l,s,w,E,k,S,I,R,u-R,c)}return Sr(a,0,r+xr(c)+n)}(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,i,r,!n)}(e,t,function(e){return 10+(e.filename&&e.filename.length+1||0)}(t),8),s=n.length;return function(e,t){var i=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&Tr(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),i){e[3]=8;for(var r=0;r<=i.length;++r)e[r+10]=i.charCodeAt(r)}}(n,t),Tr(n,s-8,i.d()),Tr(n,s-4,r),n}function Nr(e,t){var i=e.length;if("undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);for(var r=new sr(e.length+(e.length>>>1)),n=0,s=function(e){r[n++]=e},o=0;o<i;++o){if(n+5>r.length){var a=new sr(n+8+(i-o<<1));a.set(r),r=a}var l=e.charCodeAt(o);l<128||t?s(l):l<2048?(s(192|l>>>6),s(128|63&l)):l>55295&&l<57344?(s(240|(l=65536+(1047552&l)|1023&e.charCodeAt(++o))>>>18),s(128|l>>>12&63),s(128|l>>>6&63),s(128|63&l)):(s(224|l>>>12),s(128|l>>>6&63),s(128|63&l))}return Sr(r,0,n)}var Br="disabled",Ur="sampled",qr="active",jr="buffering",Gr="paused",Hr="trigger",Wr=Hr+"_activated",Kr=Hr+"_pending",zr=Hr+"_"+Br;function Vr(e,t){return t.some((t=>"regex"===t.matching&&new RegExp(t.url).test(e)))}class Yr{constructor(e){this.gt=e}triggerStatus(e){var t=this.gt.map((t=>t.triggerStatus(e)));return t.includes(Wr)?Wr:t.includes(Kr)?Kr:zr}stop(){this.gt.forEach((e=>e.stop()))}}class Jr{constructor(e){this.gt=e}triggerStatus(e){var t=new Set;for(var i of this.gt)t.add(i.triggerStatus(e));switch(t.delete(zr),t.size){case 0:return zr;case 1:return Array.from(t)[0];default:return Kr}}stop(){this.gt.forEach((e=>e.stop()))}}class Xr{triggerStatus(){return Kr}stop(){}}class Zr{constructor(e){this._t=[],this.bt=[],this.urlBlocked=!1,this._instance=e}onRemoteConfig(e){var t,i;this._t=(null==(t=e.sessionRecording)?void 0:t.urlTriggers)||[],this.bt=(null==(i=e.sessionRecording)?void 0:i.urlBlocklist)||[]}wt(e){var t;return 0===this._t.length?zr:(null==(t=this._instance)?void 0:t.get_property(Be))===e?Wr:Kr}triggerStatus(e){var t=this.wt(e),i=t===Wr?Wr:t===Kr?Kr:zr;return this._instance.register_for_session({$sdk_debug_replay_url_trigger_status:i}),i}checkUrlTriggerConditions(e,t,i){if(void 0!==m&&m.location.href){var r=m.location.href,n=this.urlBlocked,s=Vr(r,this.bt);n&&s||(s&&!n?e():!s&&n&&t(),Vr(r,this._t)&&i("url"))}}stop(){}}class Qr{constructor(e){this.linkedFlag=null,this.linkedFlagSeen=!1,this.yt=()=>{},this._instance=e}triggerStatus(){var e=Kr;return J(this.linkedFlag)&&(e=zr),this.linkedFlagSeen&&(e=Wr),this._instance.register_for_session({$sdk_debug_replay_linked_flag_trigger_status:e}),e}onRemoteConfig(e,t){var i;if(this.linkedFlag=(null==(i=e.sessionRecording)?void 0:i.linkedFlag)||null,!J(this.linkedFlag)&&!this.linkedFlagSeen){var r=z(this.linkedFlag)?this.linkedFlag:this.linkedFlag.flag,n=z(this.linkedFlag)?null:this.linkedFlag.variant;this.yt=this._instance.onFeatureFlags(((e,i)=>{var s=H(i)&&r in i&&(n?i[r]===n:!0===i[r]);s&&t(r,n),this.linkedFlagSeen=s}))}}stop(){this.yt()}}class en{constructor(e){this.St=[],this._instance=e}onRemoteConfig(e){var t;this.St=(null==(t=e.sessionRecording)?void 0:t.eventTriggers)||[]}$t(e){var t;return 0===this.St.length?zr:(null==(t=this._instance)?void 0:t.get_property(Ue))===e?Wr:Kr}triggerStatus(e){var t=this.$t(e),i=t===Wr?Wr:t===Kr?Kr:zr;return this._instance.register_for_session({$sdk_debug_replay_event_trigger_status:i}),i}stop(){}}function tn(e){return e.isRecordingEnabled?jr:Br}function rn(e){if(!e.receivedDecide)return jr;if(!e.isRecordingEnabled)return Br;if(e.urlTriggerMatching.urlBlocked)return Gr;var t=!0===e.isSampled,i=new Yr([e.eventTriggerMatching,e.urlTriggerMatching,e.linkedFlagMatching]).triggerStatus(e.sessionId);return t?Ur:i===Wr?qr:i===Kr?jr:!1===e.isSampled?Br:qr}function nn(e){if(!e.receivedDecide)return jr;if(!e.isRecordingEnabled)return Br;if(e.urlTriggerMatching.urlBlocked)return Gr;var t=new Jr([e.eventTriggerMatching,e.urlTriggerMatching,e.linkedFlagMatching]).triggerStatus(e.sessionId),i=t!==zr,r=Z(e.isSampled);return i&&t===Kr?jr:i&&t===zr||r&&!e.isSampled?Br:!0===e.isSampled?Ur:qr}var sn="[SessionRecording]",on=ie(sn);function an(){var e,t;return null==$||null==(e=$.__PosthogExtensions__)||null==(t=e.rrweb)?void 0:t.record}var ln=[Vi.MouseMove,Vi.MouseInteraction,Vi.Scroll,Vi.ViewportResize,Vi.Input,Vi.TouchMove,Vi.MediaInteraction,Vi.Drag],cn=e=>({rrwebMethod:e,enqueuedAt:Date.now(),attempt:1});function un(e){return function(e){for(var t="",i=0;i<e.length;){var r=e[i++];t+=String.fromCharCode(r)}return t}(Lr(Nr(JSON.stringify(e))))}function hn(e){return e.type===zi.Custom&&"sessionIdle"===e.data.tag}class dn{get sessionId(){return this.kt}get xt(){return this._instance.config.session_recording.session_idle_threshold_ms||3e5}get started(){return this.Et}get It(){if(!this._instance.sessionManager)throw new Error(sn+" must be started with a valid sessionManager.");return this._instance.sessionManager}get Pt(){var e,t;return this.Rt.triggerStatus(this.sessionId)===Kr?6e4:null!==(e=null==(t=this._instance.config.session_recording)?void 0:t.full_snapshot_interval_millis)&&void 0!==e?e:3e5}get Tt(){var e=this._instance.get_property(Ne);return Z(e)?e:null}get Mt(){var e,t,i=null==(e=this.M)?void 0:e.data[(null==(t=this.M)?void 0:t.data.length)-1],{sessionStartTimestamp:r}=this.It.checkAndGetSessionAndWindowId(!0);return i?i.timestamp-r:null}get Ct(){var e=!!this._instance.get_property(Oe),t=!this._instance.config.disable_session_recording;return m&&e&&t}get Ot(){var e=!!this._instance.get_property($e),t=this._instance.config.enable_recording_console_log;return null!=t?t:e}get Ft(){var e,t,i,r,n,s,o=this._instance.config.session_recording.captureCanvas,a=this._instance.get_property(Me),l=null!==(e=null!==(t=null==o?void 0:o.recordCanvas)&&void 0!==t?t:null==a?void 0:a.enabled)&&void 0!==e&&e,c=null!==(i=null!==(r=null==o?void 0:o.canvasFps)&&void 0!==r?r:null==a?void 0:a.fps)&&void 0!==i?i:4,u=null!==(n=null!==(s=null==o?void 0:o.canvasQuality)&&void 0!==s?s:null==a?void 0:a.quality)&&void 0!==n?n:.4;if("string"==typeof u){var h=parseFloat(u);u=isNaN(h)?.4:h}return{enabled:l,fps:rr(c,0,12,"canvas recording fps",4),quality:rr(u,0,1,"canvas recording quality",.4)}}get At(){var e,t,i=this._instance.get_property(Ce),r={recordHeaders:null==(e=this._instance.config.session_recording)?void 0:e.recordHeaders,recordBody:null==(t=this._instance.config.session_recording)?void 0:t.recordBody},n=(null==r?void 0:r.recordHeaders)||(null==i?void 0:i.recordHeaders),s=(null==r?void 0:r.recordBody)||(null==i?void 0:i.recordBody),o=H(this._instance.config.capture_performance)?this._instance.config.capture_performance.network_timing:this._instance.config.capture_performance,a=!!(Z(o)?o:null==i?void 0:i.capturePerformance);return n||s||a?{recordHeaders:n,recordBody:s,recordPerformance:a}:void 0}get Dt(){var e,t,i,r,n,s,o=this._instance.get_property(Pe),a={maskAllInputs:null==(e=this._instance.config.session_recording)?void 0:e.maskAllInputs,maskTextSelector:null==(t=this._instance.config.session_recording)?void 0:t.maskTextSelector,blockSelector:null==(i=this._instance.config.session_recording)?void 0:i.blockSelector},l=null!==(r=null==a?void 0:a.maskAllInputs)&&void 0!==r?r:null==o?void 0:o.maskAllInputs,c=null!==(n=null==a?void 0:a.maskTextSelector)&&void 0!==n?n:null==o?void 0:o.maskTextSelector,u=null!==(s=null==a?void 0:a.blockSelector)&&void 0!==s?s:null==o?void 0:o.blockSelector;return K(l)&&K(c)&&K(u)?void 0:{maskAllInputs:null==l||l,maskTextSelector:c,blockSelector:u}}get jt(){var e=this._instance.get_property(Ae);return X(e)?e:null}get Lt(){var e=this._instance.get_property(De);return X(e)?e:null}get status(){return this.Nt?this.zt({receivedDecide:this.Nt,isRecordingEnabled:this.Ct,isSampled:this.Tt,urlTriggerMatching:this.Ut,eventTriggerMatching:this.qt,linkedFlagMatching:this.Bt,sessionId:this.sessionId}):jr}constructor(e){if(this.zt=tn,this.Nt=!1,this.Ht=[],this.Wt="unknown",this.Gt=Date.now(),this.Rt=new Xr,this.Jt=void 0,this.Vt=void 0,this.Kt=void 0,this.Yt=void 0,this.Xt=void 0,this._forceAllowLocalhostNetworkCapture=!1,this.Qt=()=>{this.Zt()},this.ti=()=>{this.ii("browser offline",{})},this.ei=()=>{this.ii("browser online",{})},this.ri=()=>{if(null!=x&&x.visibilityState){var e="window "+x.visibilityState;this.ii(e,{})}},this._instance=e,this.Et=!1,this.si="/s/",this.ni=void 0,this.Nt=!1,!this._instance.sessionManager)throw on.error("started without valid sessionManager"),new Error(sn+" started without valid sessionManager. This is a bug.");if(this._instance.config.__preview_experimental_cookieless_mode)throw new Error(sn+" cannot be used with __preview_experimental_cookieless_mode.");this.Bt=new Qr(this._instance),this.Ut=new Zr(this._instance),this.qt=new en(this._instance);var{sessionId:t,windowId:i}=this.It.checkAndGetSessionAndWindowId();this.kt=t,this.oi=i,this.M=this.ai(),this.xt>=this.It.sessionTimeoutMs&&on.warn("session_idle_threshold_ms ("+this.xt+") is greater than the session timeout ("+this.It.sessionTimeoutMs+"). Session will never be detected as idle")}startIfEnabledOrStop(e){this.Ct?(this.li(e),ye(m,"beforeunload",this.Qt),ye(m,"offline",this.ti),ye(m,"online",this.ei),ye(m,"visibilitychange",this.ri),this.hi(),this.ui(),J(this.Jt)&&(this.Jt=this._instance.on("eventCaptured",(e=>{try{if("$pageview"===e.event){var t=null!=e&&e.properties.$current_url?this.di(null==e?void 0:e.properties.$current_url):"";if(!t)return;this.ii("$pageview",{href:t})}}catch(e){on.error("Could not add $pageview to rrweb session",e)}}))),this.Vt||(this.Vt=this.It.onSessionId(((e,t,i)=>{var r,n,s,o;i&&(this.ii("$session_id_change",{sessionId:e,windowId:t,changeReason:i}),null==(r=this._instance)||null==(n=r.persistence)||n.unregister(Ue),null==(s=this._instance)||null==(o=s.persistence)||o.unregister(Be))})))):this.stopRecording()}stopRecording(){var e,t,i,r;this.Et&&this.ni&&(this.ni(),this.ni=void 0,this.Et=!1,null==m||m.removeEventListener("beforeunload",this.Qt),null==m||m.removeEventListener("offline",this.ti),null==m||m.removeEventListener("online",this.ei),null==m||m.removeEventListener("visibilitychange",this.ri),this.ai(),clearInterval(this.vi),null==(e=this.Jt)||e.call(this),this.Jt=void 0,null==(t=this.Xt)||t.call(this),this.Xt=void 0,null==(i=this.Vt)||i.call(this),this.Vt=void 0,null==(r=this.Yt)||r.call(this),this.Yt=void 0,this.qt.stop(),this.Ut.stop(),this.Bt.stop(),on.info("stopped"))}ci(){var e;null==(e=this._instance.persistence)||e.unregister(Ne)}fi(e){var t,i=this.kt!==e,r=this.jt;if(X(r)){var n=this.Tt,s=i||!Z(n),o=s?function(e,t){return function(e){for(var t=0,i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return Math.abs(t)}(e)%100<rr(100*t,0,100)}(e,r):n;s&&(o?this.pi(Ur):on.warn("Sample rate ("+r+") has determined that this sessionId ("+e+") will not be sent to the server."),this.ii("samplingDecisionMade",{sampleRate:r,isSampled:o})),null==(t=this._instance.persistence)||t.register({[Ne]:o})}else this.ci()}onRemoteConfig(e){var t,i,r,n;this.ii("$remote_config_received",e),this.gi(e),null!=(t=e.sessionRecording)&&t.endpoint&&(this.si=null==(n=e.sessionRecording)?void 0:n.endpoint),this.hi(),"any"===(null==(i=e.sessionRecording)?void 0:i.triggerMatchType)?(this.zt=rn,this.Rt=new Yr([this.qt,this.Ut])):(this.zt=nn,this.Rt=new Jr([this.qt,this.Ut])),this._instance.register_for_session({$sdk_debug_replay_remote_trigger_matching_config:null==(r=e.sessionRecording)?void 0:r.triggerMatchType}),this.Ut.onRemoteConfig(e),this.qt.onRemoteConfig(e),this.Bt.onRemoteConfig(e,((e,t)=>{this.pi("linked_flag_matched",{flag:e,variant:t})})),this.Nt=!0,this.startIfEnabledOrStop()}hi(){X(this.jt)&&J(this.Yt)&&(this.Yt=this.It.onSessionId((e=>{this.fi(e)})))}gi(e){if(this._instance.persistence){var t,i=this._instance.persistence,r=()=>{var t,r,n,s,o,a,l,c,u,h=null==(t=e.sessionRecording)?void 0:t.sampleRate,d=J(h)?null:parseFloat(h);J(d)&&this.ci();var p=null==(r=e.sessionRecording)?void 0:r.minimumDurationMilliseconds;i.register({[Oe]:!!e.sessionRecording,[$e]:null==(n=e.sessionRecording)?void 0:n.consoleLogRecordingEnabled,[Ce]:se({capturePerformance:e.capturePerformance},null==(s=e.sessionRecording)?void 0:s.networkPayloadCapture),[Pe]:null==(o=e.sessionRecording)?void 0:o.masking,[Me]:{enabled:null==(a=e.sessionRecording)?void 0:a.recordCanvas,fps:null==(l=e.sessionRecording)?void 0:l.canvasFps,quality:null==(c=e.sessionRecording)?void 0:c.canvasQuality},[Ae]:d,[De]:K(p)?null:p,[Te]:null==(u=e.sessionRecording)?void 0:u.scriptConfig})};r(),null==(t=this.Kt)||t.call(this),this.Kt=this.It.onSessionId(r)}}log(e,t){var i;void 0===t&&(t="log"),null==(i=this._instance.sessionRecording)||i.onRRwebEmit({type:6,data:{plugin:"rrweb/console@1",payload:{level:t,trace:[],payload:[JSON.stringify(e)]}},timestamp:Date.now()})}li(e){var t;K(Object.assign)||K(Array.from)||(this.Et||this._instance.config.disable_session_recording||this._instance.consent.isOptedOut())||(this.Et=!0,this.It.checkAndGetSessionAndWindowId(),an()?this.mi():null==(t=$.__PosthogExtensions__)||null==t.loadExternalDependency||t.loadExternalDependency(this._instance,this.bi,(e=>{if(e)return on.error("could not load recorder",e);this.mi()})),on.info("starting"),this.status===qr&&this.pi(e||"recording_initialized"))}get bi(){var e,t,i;return(null==(e=this._instance)||null==(t=e.persistence)||null==(i=t.get_property(Te))?void 0:i.script)||"recorder"}wi(e){var t;return 3===e.type&&-1!==ln.indexOf(null==(t=e.data)?void 0:t.source)}yi(e){var t=this.wi(e);t||this.Wt||e.timestamp-this.Gt>this.xt&&(this.Wt=!0,clearInterval(this.vi),this.ii("sessionIdle",{eventTimestamp:e.timestamp,lastActivityTimestamp:this.Gt,threshold:this.xt,bufferLength:this.M.data.length,bufferSize:this.M.size}),this.Zt());var i=!1;if(t&&(this.Gt=e.timestamp,this.Wt)){var r="unknown"===this.Wt;this.Wt=!1,r||(this.ii("sessionNoLongerIdle",{reason:"user activity",type:e.type}),i=!0)}if(!this.Wt){var{windowId:n,sessionId:s}=this.It.checkAndGetSessionAndWindowId(!t,e.timestamp),o=this.kt!==s,a=this.oi!==n;this.oi=n,this.kt=s,o||a?(this.stopRecording(),this.startIfEnabledOrStop("session_id_changed")):i&&this.Si()}}$i(e){try{return e.rrwebMethod(),!0}catch(t){return this.Ht.length<10?this.Ht.push({enqueuedAt:e.enqueuedAt||Date.now(),attempt:e.attempt++,rrwebMethod:e.rrwebMethod}):on.warn("could not emit queued rrweb event.",t,e),!1}}ii(e,t){return this.$i(cn((()=>an().addCustomEvent(e,t))))}ki(){return this.$i(cn((()=>an().takeFullSnapshot())))}mi(){var e,t,i,r,n={blockClass:"ph-no-capture",blockSelector:void 0,ignoreClass:"ph-ignore-input",maskTextClass:"ph-mask",maskTextSelector:void 0,maskTextFn:void 0,maskAllInputs:!0,maskInputOptions:{password:!0},maskInputFn:void 0,slimDOMOptions:{},collectFonts:!1,inlineStylesheet:!0,recordCrossOriginIframes:!1},s=this._instance.config.session_recording;for(var[o,a]of Object.entries(s||{}))o in n&&("maskInputOptions"===o?n.maskInputOptions=se({password:!0},a):n[o]=a);this.Ft&&this.Ft.enabled&&(n.recordCanvas=!0,n.sampling={canvas:this.Ft.fps},n.dataURLOptions={type:"image/webp",quality:this.Ft.quality}),this.Dt&&(n.maskAllInputs=null===(t=this.Dt.maskAllInputs)||void 0===t||t,n.maskTextSelector=null!==(i=this.Dt.maskTextSelector)&&void 0!==i?i:void 0,n.blockSelector=null!==(r=this.Dt.blockSelector)&&void 0!==r?r:void 0);var l=an();if(l){this.xi=null!==(e=this.xi)&&void 0!==e?e:new nr(l,{refillRate:this._instance.config.session_recording.__mutationRateLimiterRefillRate,bucketSize:this._instance.config.session_recording.__mutationRateLimiterBucketSize,onBlockedNode:(e,t)=>{var i="Too many mutations on node '"+e+"'. Rate limiting. This could be due to SVG animations or something similar";on.info(i,{node:t}),this.log(sn+" "+i,"warn")}});var c=this.Ei();this.ni=l(se({emit:e=>{this.onRRwebEmit(e)},plugins:c},n)),this.Gt=Date.now(),this.Wt=Z(this.Wt)?this.Wt:"unknown",this.ii("$session_options",{sessionRecordingOptions:n,activePlugins:c.map((e=>null==e?void 0:e.name))}),this.ii("$posthog_config",{config:this._instance.config})}else on.error("onScriptLoaded was called but rrwebRecord is not available. This indicates something has gone wrong.")}Si(){if(this.vi&&clearInterval(this.vi),!0!==this.Wt){var e=this.Pt;e&&(this.vi=setInterval((()=>{this.ki()}),e))}}Ei(){var e,t,i,r,n=[],s=null==(e=$.__PosthogExtensions__)||null==(t=e.rrwebPlugins)?void 0:t.getRecordConsolePlugin;s&&this.Ot&&n.push(s());var o=null==(i=$.__PosthogExtensions__)||null==(r=i.rrwebPlugins)?void 0:r.getRecordNetworkPlugin;return this.At&&G(o)&&(!Mt.includes(location.hostname)||this._forceAllowLocalhostNetworkCapture?n.push(o(((e,t)=>{var i,r,n,s={payloadSizeLimitBytes:Xi.payloadSizeLimitBytes,performanceEntryTypeToObserve:[...Xi.performanceEntryTypeToObserve],payloadHostDenyList:[...t.payloadHostDenyList||[],...Xi.payloadHostDenyList]},o=!1!==e.session_recording.recordHeaders&&t.recordHeaders,a=!1!==e.session_recording.recordBody&&t.recordBody,l=!1!==e.capture_performance&&t.recordPerformance,c=(i=s,n=Math.min(1e6,null!==(r=i.payloadSizeLimitBytes)&&void 0!==r?r:1e6),e=>(null!=e&&e.requestBody&&(e.requestBody=tr(e.requestBody,e.requestHeaders,n,"Request")),null!=e&&e.responseBody&&(e.responseBody=tr(e.responseBody,e.responseHeaders,n,"Response")),e)),u=t=>{return c(((e,t)=>{var i,r=At(e.name),n=0===t.indexOf("http")?null==(i=At(t))?void 0:i.pathname:t;"/"===n&&(n="");var s=null==r?void 0:r.pathname.replace(n||"","");if(!(r&&s&&er.some((e=>0===s.indexOf(e)))))return e})((r=(i=t).requestHeaders,J(r)||ce(Object.keys(null!=r?r:{}),(e=>{Zi.includes(e.toLowerCase())&&(r[e]=Ji)})),i),e.api_host));var i,r},h=G(e.session_recording.maskNetworkRequestFn);return h&&G(e.session_recording.maskCapturedNetworkRequestFn)&&te.warn("Both `maskNetworkRequestFn` and `maskCapturedNetworkRequestFn` are defined. `maskNetworkRequestFn` will be ignored."),h&&(e.session_recording.maskCapturedNetworkRequestFn=t=>{var i=e.session_recording.maskNetworkRequestFn({url:t.name});return se({},t,{name:null==i?void 0:i.url})}),s.maskRequestFn=G(e.session_recording.maskCapturedNetworkRequestFn)?t=>{var i,r=u(t);return r&&null!==(i=null==e.session_recording.maskCapturedNetworkRequestFn?void 0:e.session_recording.maskCapturedNetworkRequestFn(r))&&void 0!==i?i:void 0}:e=>function(e){if(!K(e))return e.requestBody=ir(e.requestBody,"Request"),e.responseBody=ir(e.responseBody,"Response"),e}(u(e)),se({},Xi,s,{recordHeaders:o,recordBody:a,recordPerformance:l,recordInitialRequests:l})})(this._instance.config,this.At))):on.info("NetworkCapture not started because we are on localhost.")),n}onRRwebEmit(e){var t;if(this.Ii(),e&&H(e)){if(e.type===zi.Meta){var i=this.di(e.data.href);if(this.Pi=i,!i)return;e.data.href=i}else this.Ri();if(this.Ut.checkUrlTriggerConditions((()=>this.Ti()),(()=>this.Mi()),(e=>this.Ci(e))),!this.Ut.urlBlocked||(r=e).type===zi.Custom&&"recording paused"===r.data.tag){var r;e.type===zi.FullSnapshot&&this.Si(),e.type===zi.FullSnapshot&&this.Nt&&this.Rt.triggerStatus(this.sessionId)===Kr&&this.ai();var n=this.xi?this.xi.throttleMutations(e):e;if(n){var s=function(e){var t=e;if(t&&H(t)&&6===t.type&&H(t.data)&&"rrweb/console@1"===t.data.plugin){t.data.payload.payload.length>10&&(t.data.payload.payload=t.data.payload.payload.slice(0,10),t.data.payload.payload.push("...[truncated]"));for(var i=[],r=0;r<t.data.payload.payload.length;r++)t.data.payload.payload[r]&&t.data.payload.payload[r].length>2e3?i.push(t.data.payload.payload[r].slice(0,2e3)+"...[truncated]"):i.push(t.data.payload.payload[r]);return t.data.payload.payload=i,e}return e}(n);if(this.yi(s),!0!==this.Wt||hn(s)){if(hn(s)){var o=s.data.payload;if(o){var a=o.lastActivityTimestamp,l=o.threshold;s.timestamp=a+l}}var c=null===(t=this._instance.config.session_recording.compress_events)||void 0===t||t?function(e){if(Wi(e)<1024)return e;try{if(e.type===zi.FullSnapshot)return se({},e,{data:un(e.data),cv:"2024-10"});if(e.type===zi.IncrementalSnapshot&&e.data.source===Vi.Mutation)return se({},e,{cv:"2024-10",data:se({},e.data,{texts:un(e.data.texts),attributes:un(e.data.attributes),removes:un(e.data.removes),adds:un(e.data.adds)})});if(e.type===zi.IncrementalSnapshot&&e.data.source===Vi.StyleSheetRule)return se({},e,{cv:"2024-10",data:se({},e.data,{adds:e.data.adds?un(e.data.adds):void 0,removes:e.data.removes?un(e.data.removes):void 0})})}catch(e){on.error("could not compress event - will use uncompressed event",e)}return e}(s):s,u={$snapshot_bytes:Wi(c),$snapshot_data:c,$session_id:this.kt,$window_id:this.oi};this.status!==Br?this.Oi(u):this.ai()}}}}}Ri(){if(!this._instance.config.capture_pageview&&m){var e=this.di(m.location.href);this.Pi!==e&&(this.ii("$url_changed",{href:e}),this.Pi=e)}}Ii(){if(this.Ht.length){var e=[...this.Ht];this.Ht=[],e.forEach((e=>{Date.now()-e.enqueuedAt<=2e3&&this.$i(e)}))}}di(e){var t=this._instance.config.session_recording;if(t.maskNetworkRequestFn){var i,r={url:e};return null==(i=r=t.maskNetworkRequestFn(r))?void 0:i.url}return e}ai(){return this.M={size:0,data:[],sessionId:this.kt,windowId:this.oi},this.M}Zt(){this.Fi&&(clearTimeout(this.Fi),this.Fi=void 0);var e=this.Lt,t=this.Mt,i=X(t)&&t>=0,r=X(e)&&i&&t<e;return this.status===jr||this.status===Gr||this.status===Br||r?(this.Fi=setTimeout((()=>{this.Zt()}),2e3),this.M):(this.M.data.length>0&&Ki(this.M).forEach((e=>{this.Ai({$snapshot_bytes:e.size,$snapshot_data:e.data,$session_id:e.sessionId,$window_id:e.windowId,$lib:"web",$lib_version:C.LIB_VERSION})})),this.ai())}Oi(e){var t,i=2+((null==(t=this.M)?void 0:t.data.length)||0);!this.Wt&&(this.M.size+e.$snapshot_bytes+i>943718.4||this.M.sessionId!==this.kt)&&(this.M=this.Zt()),this.M.size+=e.$snapshot_bytes,this.M.data.push(e.$snapshot_data),this.Fi||this.Wt||(this.Fi=setTimeout((()=>{this.Zt()}),2e3))}Ai(e){this._instance.capture("$snapshot",e,{_url:this._instance.requestRouter.endpointFor("api",this.si),_noTruncate:!0,_batchKey:"recordings",skip_client_rate_limiting:!0})}Ci(e){var t,i;this.Rt.triggerStatus(this.sessionId)===Kr&&(null==(t=this._instance)||null==(i=t.persistence)||i.register({["url"===e?Be:Ue]:this.kt}),this.Zt(),this.pi(e+"_trigger_matched"))}Ti(){this.Ut.urlBlocked||(this.Ut.urlBlocked=!0,clearInterval(this.vi),on.info("recording paused due to URL blocker"),this.ii("recording paused",{reason:"url blocker"}))}Mi(){this.Ut.urlBlocked&&(this.Ut.urlBlocked=!1,this.ki(),this.Si(),this.ii("recording resumed",{reason:"left blocked url"}),on.info("recording resumed"))}ui(){0!==this.qt.St.length&&J(this.Xt)&&(this.Xt=this._instance.on("eventCaptured",(e=>{try{this.qt.St.includes(e.event)&&this.Ci("event")}catch(e){on.error("Could not activate event trigger",e)}})))}overrideLinkedFlag(){this.Bt.linkedFlagSeen=!0,this.ki(),this.pi("linked_flag_overridden")}overrideSampling(){var e;null==(e=this._instance.persistence)||e.register({[Ne]:!0}),this.ki(),this.pi("sampling_overridden")}overrideTrigger(e){this.Ci(e)}pi(e,t){this._instance.register_for_session({$session_recording_start_reason:e}),on.info(e.replace("_"," "),t),D(["recording_initialized","session_id_changed"],e)||this.ii(e,t)}get sdkDebugProperties(){var{sessionStartTimestamp:e}=this.It.checkAndGetSessionAndWindowId(!0);return{$recording_status:this.status,$sdk_debug_replay_internal_buffer_length:this.M.data.length,$sdk_debug_replay_internal_buffer_size:this.M.size,$sdk_debug_current_session_duration:this.Mt,$sdk_debug_session_start:e}}}var pn=ie("[SegmentIntegration]");var gn="posthog-js";function vn(e,t){var{organization:i,projectId:r,prefix:n,severityAllowList:s=["error"]}=void 0===t?{}:t;return t=>{var o,a,l,c,u;if("*"!==s&&!s.includes(t.level)||!e.__loaded)return t;t.tags||(t.tags={});var h=e.requestRouter.endpointFor("ui","/project/"+e.config.token+"/person/"+e.get_distinct_id());t.tags["PostHog Person URL"]=h,e.sessionRecordingStarted()&&(t.tags["PostHog Recording URL"]=e.get_session_replay_url({withTimestamp:!0}));var d=(null==(o=t.exception)?void 0:o.values)||[],p=d.map((e=>se({},e,{stacktrace:e.stacktrace?se({},e.stacktrace,{type:"raw",frames:(e.stacktrace.frames||[]).map((e=>se({},e,{platform:"web:javascript"})))}):void 0}))),g={$exception_message:(null==(a=d[0])?void 0:a.value)||t.message,$exception_type:null==(l=d[0])?void 0:l.type,$exception_personURL:h,$exception_level:t.level,$exception_list:p,$sentry_event_id:t.event_id,$sentry_exception:t.exception,$sentry_exception_message:(null==(c=d[0])?void 0:c.value)||t.message,$sentry_exception_type:null==(u=d[0])?void 0:u.type,$sentry_tags:t.tags};return i&&r&&(g.$sentry_url=(n||"https://sentry.io/organizations/")+i+"/issues/?project="+r+"&query="+t.event_id),e.exceptions.sendExceptionEvent(g),t}}class fn{constructor(e,t,i,r,n){this.name=gn,this.setupOnce=function(s){s(vn(e,{organization:t,projectId:i,prefix:r,severityAllowList:n}))}}}var _n,mn=null!=m&&m.location?Lt(m.location.hash,"__posthog")||Lt(location.hash,"state"):null,yn="_postHogToolbarParams",bn=ie("[Toolbar]");!function(e){e[e.UNINITIALIZED=0]="UNINITIALIZED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(_n||(_n={}));class wn{constructor(e){this.instance=e}Di(e){$.ph_toolbar_state=e}ji(){var e;return null!==(e=$.ph_toolbar_state)&&void 0!==e?e:_n.UNINITIALIZED}maybeLoadToolbar(e,t,i){var r,n;if(void 0===e&&(e=void 0),void 0===t&&(t=void 0),void 0===i&&(i=void 0),!m||!x)return!1;e=null!==(r=e)&&void 0!==r?r:m.location,i=null!==(n=i)&&void 0!==n?n:m.history;try{if(!t){try{m.localStorage.setItem("test","test"),m.localStorage.removeItem("test")}catch(e){return!1}t=null==m?void 0:m.localStorage}var s,o=mn||Lt(e.hash,"__posthog")||Lt(e.hash,"state"),a=o?pe((()=>JSON.parse(atob(decodeURIComponent(o)))))||pe((()=>JSON.parse(decodeURIComponent(o)))):null;return a&&"ph_authorize"===a.action?((s=a).source="url",s&&Object.keys(s).length>0&&(a.desiredHash?e.hash=a.desiredHash:i?i.replaceState(i.state,"",e.pathname+e.search):e.hash="")):((s=JSON.parse(t.getItem(yn)||"{}")).source="localstorage",delete s.userIntent),!(!s.token||this.instance.config.token!==s.token||(this.loadToolbar(s),0))}catch(e){return!1}}Li(e){var t=$.ph_load_toolbar||$.ph_load_editor;!J(t)&&G(t)?t(e,this.instance):bn.warn("No toolbar load function found")}loadToolbar(e){var t=!(null==x||!x.getElementById(it));if(!m||t)return!1;var i="custom"===this.instance.requestRouter.region&&this.instance.config.advanced_disable_toolbar_metrics,r=se({token:this.instance.config.token},e,{apiURL:this.instance.requestRouter.endpointFor("ui")},i?{instrument:!1}:{});if(m.localStorage.setItem(yn,JSON.stringify(se({},r,{source:void 0}))),this.ji()===_n.LOADED)this.Li(r);else if(this.ji()===_n.UNINITIALIZED){var n;this.Di(_n.LOADING),null==(n=$.__PosthogExtensions__)||null==n.loadExternalDependency||n.loadExternalDependency(this.instance,"toolbar",(e=>{if(e)return bn.error("[Toolbar] Failed to load",e),void this.Di(_n.UNINITIALIZED);this.Di(_n.LOADED),this.Li(r)})),ye(m,"turbolinks:load",(()=>{this.Di(_n.UNINITIALIZED),this.loadToolbar(r)}))}return!0}Ni(e){return this.loadToolbar(e)}maybeLoadEditor(e,t,i){return void 0===e&&(e=void 0),void 0===t&&(t=void 0),void 0===i&&(i=void 0),this.maybeLoadToolbar(e,t,i)}}var En=ie("[TracingHeaders]");class kn{constructor(e){this.zi=void 0,this.Ui=void 0,this.V=()=>{var e,t,i,r;K(this.zi)&&(null==(e=$.__PosthogExtensions__)||null==(t=e.tracingHeadersPatchFns)||t._patchXHR(this._instance.sessionManager)),K(this.Ui)&&(null==(i=$.__PosthogExtensions__)||null==(r=i.tracingHeadersPatchFns)||r._patchFetch(this._instance.sessionManager))},this._instance=e}G(e){var t,i;null!=(t=$.__PosthogExtensions__)&&t.tracingHeadersPatchFns&&e(),null==(i=$.__PosthogExtensions__)||null==i.loadExternalDependency||i.loadExternalDependency(this._instance,"tracing-headers",(t=>{if(t)return En.error("failed to load script",t);e()}))}startIfEnabledOrStop(){var e,t;this._instance.config.__add_tracing_headers?this.G(this.V):(null==(e=this.zi)||e.call(this),null==(t=this.Ui)||t.call(this),this.zi=void 0,this.Ui=void 0)}}var xn=ie("[Web Vitals]"),Sn=9e5;class In{constructor(e){var t;this.qi=!1,this.i=!1,this.M={url:void 0,metrics:[],firstMetricTimestamp:void 0},this.Bi=()=>{clearTimeout(this.Hi),0!==this.M.metrics.length&&(this._instance.capture("$web_vitals",this.M.metrics.reduce(((e,t)=>se({},e,{["$web_vitals_"+t.name+"_event"]:se({},t),["$web_vitals_"+t.name+"_value"]:t.value})),{})),this.M={url:void 0,metrics:[],firstMetricTimestamp:void 0})},this.Wi=e=>{var t,i=null==(t=this._instance.sessionManager)?void 0:t.checkAndGetSessionAndWindowId(!0);if(K(i))xn.error("Could not read session ID. Dropping metrics!");else{this.M=this.M||{url:void 0,metrics:[],firstMetricTimestamp:void 0};var r=this.Gi();K(r)||(J(null==e?void 0:e.name)||J(null==e?void 0:e.value)?xn.error("Invalid metric received",e):this.Ji&&e.value>=this.Ji?xn.error("Ignoring metric with value >= "+this.Ji,e):(this.M.url!==r&&(this.Bi(),this.Hi=setTimeout(this.Bi,this.flushToCaptureTimeoutMs)),K(this.M.url)&&(this.M.url=r),this.M.firstMetricTimestamp=K(this.M.firstMetricTimestamp)?Date.now():this.M.firstMetricTimestamp,e.attribution&&e.attribution.interactionTargetElement&&(e.attribution.interactionTargetElement=void 0),this.M.metrics.push(se({},e,{$current_url:r,$session_id:i.sessionId,$window_id:i.windowId,timestamp:Date.now()})),this.M.metrics.length===this.allowedMetrics.length&&this.Bi()))}},this.V=()=>{var e,t,i,r,n=$.__PosthogExtensions__;K(n)||K(n.postHogWebVitalsCallbacks)||({onLCP:e,onCLS:t,onFCP:i,onINP:r}=n.postHogWebVitalsCallbacks),e&&t&&i&&r?(this.allowedMetrics.indexOf("LCP")>-1&&e(this.Wi.bind(this)),this.allowedMetrics.indexOf("CLS")>-1&&t(this.Wi.bind(this)),this.allowedMetrics.indexOf("FCP")>-1&&i(this.Wi.bind(this)),this.allowedMetrics.indexOf("INP")>-1&&r(this.Wi.bind(this)),this.i=!0):xn.error("web vitals callbacks not loaded - not starting")},this._instance=e,this.qi=!(null==(t=this._instance.persistence)||!t.props[Ie]),this.startIfEnabled()}get allowedMetrics(){var e,t,i=H(this._instance.config.capture_performance)?null==(e=this._instance.config.capture_performance)?void 0:e.web_vitals_allowed_metrics:void 0;return K(i)?(null==(t=this._instance.persistence)?void 0:t.props[Re])||["CLS","FCP","INP","LCP"]:i}get flushToCaptureTimeoutMs(){return(H(this._instance.config.capture_performance)?this._instance.config.capture_performance.web_vitals_delayed_flush_ms:void 0)||5e3}get Ji(){var e=H(this._instance.config.capture_performance)&&X(this._instance.config.capture_performance.__web_vitals_max_value)?this._instance.config.capture_performance.__web_vitals_max_value:Sn;return 0<e&&e<=6e4?Sn:e}get isEnabled(){var e=null==S?void 0:S.protocol;if("http:"!==e&&"https:"!==e)return xn.info("Web Vitals are disabled on non-http/https protocols"),!1;var t=H(this._instance.config.capture_performance)?this._instance.config.capture_performance.web_vitals:Z(this._instance.config.capture_performance)?this._instance.config.capture_performance:void 0;return Z(t)?t:this.qi}startIfEnabled(){this.isEnabled&&!this.i&&(xn.info("enabled, starting..."),this.G(this.V))}onRemoteConfig(e){var t=H(e.capturePerformance)&&!!e.capturePerformance.web_vitals,i=H(e.capturePerformance)?e.capturePerformance.web_vitals_allowed_metrics:void 0;this._instance.persistence&&(this._instance.persistence.register({[Ie]:t}),this._instance.persistence.register({[Re]:i})),this.qi=t,this.startIfEnabled()}G(e){var t,i;null!=(t=$.__PosthogExtensions__)&&t.postHogWebVitalsCallbacks&&e(),null==(i=$.__PosthogExtensions__)||null==i.loadExternalDependency||i.loadExternalDependency(this._instance,"web-vitals",(t=>{t?xn.error("failed to load script",t):e()}))}Gi(){var e=m?m.location.href:void 0;return e||xn.error("Could not determine current URL"),e}}var Fn=ie("[Heatmaps]");function Rn(e){return H(e)&&"clientX"in e&&"clientY"in e&&X(e.clientX)&&X(e.clientY)}class On{constructor(e){var t;this.rageclicks=new Pt,this.qi=!1,this.i=!1,this.Vi=null,this.instance=e,this.qi=!(null==(t=this.instance.persistence)||!t.props[xe])}get flushIntervalMilliseconds(){var e=5e3;return H(this.instance.config.capture_heatmaps)&&this.instance.config.capture_heatmaps.flush_interval_milliseconds&&(e=this.instance.config.capture_heatmaps.flush_interval_milliseconds),e}get isEnabled(){return K(this.instance.config.capture_heatmaps)?K(this.instance.config.enable_heatmaps)?this.qi:this.instance.config.enable_heatmaps:!1!==this.instance.config.capture_heatmaps}startIfEnabled(){if(this.isEnabled){if(this.i)return;Fn.info("starting..."),this.Ki(),this.Vi=setInterval(this.Yi.bind(this),this.flushIntervalMilliseconds)}else{var e,t;clearInterval(null!==(e=this.Vi)&&void 0!==e?e:void 0),null==(t=this.Xi)||t.stop(),this.getAndClearBuffer()}}onRemoteConfig(e){var t=!!e.heatmaps;this.instance.persistence&&this.instance.persistence.register({[xe]:t}),this.qi=t,this.startIfEnabled()}getAndClearBuffer(){var e=this.M;return this.M=void 0,e}Qi(e){this.Zi(e.originalEvent,"deadclick")}Ki(){m&&x&&(ye(m,"beforeunload",this.Yi.bind(this)),ye(x,"click",(e=>this.Zi(e||(null==m?void 0:m.event))),{capture:!0}),ye(x,"mousemove",(e=>this.te(e||(null==m?void 0:m.event))),{capture:!0}),this.Xi=new pi(this.instance,hi,this.Qi.bind(this)),this.Xi.startIfEnabled(),this.i=!0)}ie(e,t){var i=this.instance.scrollManager.scrollY(),r=this.instance.scrollManager.scrollX(),n=this.instance.scrollManager.scrollElement(),s=function(e,t,i){for(var r=e;r&&ot(r)&&!at(r,"body");){if(r===i)return!1;if(D(t,null==m?void 0:m.getComputedStyle(r).position))return!0;r=_t(r)}return!1}(vt(e),["fixed","sticky"],n);return{x:e.clientX+(s?0:r),y:e.clientY+(s?0:i),target_fixed:s,type:t}}Zi(e,t){var i;if(void 0===t&&(t="click"),!st(e.target)&&Rn(e)){var r=this.ie(e,t);null!=(i=this.rageclicks)&&i.isRageClick(e.clientX,e.clientY,(new Date).getTime())&&this.ee(se({},r,{type:"rageclick"})),this.ee(r)}}te(e){!st(e.target)&&Rn(e)&&(clearTimeout(this.re),this.re=setTimeout((()=>{this.ee(this.ie(e,"mousemove"))}),500))}ee(e){if(m){var t=m.location.href;this.M=this.M||{},this.M[t]||(this.M[t]=[]),this.M[t].push(e)}}Yi(){this.M&&!W(this.M)&&this.instance.capture("$$heatmap",{$heatmap_data:this.getAndClearBuffer()})}}class $n{constructor(e){this._instance=e}doPageView(e,t){var i,r=this.se(e,t);return this.ne={pathname:null!==(i=null==m?void 0:m.location.pathname)&&void 0!==i?i:"",pageViewId:t,timestamp:e},this._instance.scrollManager.resetContext(),r}doPageLeave(e){var t;return this.se(e,null==(t=this.ne)?void 0:t.pageViewId)}doEvent(){var e;return{$pageview_id:null==(e=this.ne)?void 0:e.pageViewId}}se(e,t){var i=this.ne;if(!i)return{$pageview_id:t};var r={$pageview_id:t,$prev_pageview_id:i.pageViewId},n=this._instance.scrollManager.getContext();if(n&&!this._instance.config.disable_scroll_properties){var{maxScrollHeight:s,lastScrollY:o,maxScrollY:a,maxContentHeight:l,lastContentY:c,maxContentY:u}=n;if(!(K(s)||K(o)||K(a)||K(l)||K(c)||K(u))){s=Math.ceil(s),o=Math.ceil(o),a=Math.ceil(a),l=Math.ceil(l),c=Math.ceil(c),u=Math.ceil(u);var h=s<=1?1:rr(o/s,0,1),d=s<=1?1:rr(a/s,0,1),p=l<=1?1:rr(c/l,0,1),g=l<=1?1:rr(u/l,0,1);r=ue(r,{$prev_pageview_last_scroll:o,$prev_pageview_last_scroll_percentage:h,$prev_pageview_max_scroll:a,$prev_pageview_max_scroll_percentage:d,$prev_pageview_last_content:c,$prev_pageview_last_content_percentage:p,$prev_pageview_max_content:u,$prev_pageview_max_content_percentage:g})}}return i.pathname&&(r.$prev_pageview_pathname=i.pathname),i.timestamp&&(r.$prev_pageview_duration=(e.getTime()-i.timestamp.getTime())/1e3),r}}class Cn{constructor(e){this._instance=e}sendExceptionEvent(e){this._instance.capture("$exception",e,{_noTruncate:!0,_batchKey:"exceptionEvent"})}}var Pn="Mobile",Mn="iOS",An="Android",Dn="Tablet",Tn=An+" "+Dn,Ln="iPad",Nn="Apple",Bn=Nn+" Watch",Un="Safari",qn="BlackBerry",jn="Samsung",Gn=jn+"Browser",Hn=jn+" Internet",Wn="Chrome",Kn=Wn+" OS",zn=Wn+" "+Mn,Vn="Internet Explorer",Yn=Vn+" "+Pn,Jn="Opera",Xn=Jn+" Mini",Zn="Edge",Qn="Microsoft "+Zn,es="Firefox",ts=es+" "+Mn,is="Nintendo",rs="PlayStation",ns="Xbox",ss=An+" "+Pn,os=Pn+" "+Un,as="Windows",ls=as+" Phone",cs="Nokia",us="Ouya",hs="Generic",ds=hs+" "+Pn.toLowerCase(),ps=hs+" "+Dn.toLowerCase(),gs="Konqueror",vs="(\\d+(\\.\\d+)?)",fs=new RegExp("Version/"+vs),_s=new RegExp(ns,"i"),ms=new RegExp(rs+" \\w+","i"),ys=new RegExp(is+" \\w+","i"),bs=new RegExp(qn+"|PlayBook|BB10","i"),ws={"NT3.51":"NT 3.11","NT4.0":"NT 4.0","5.0":"2000",5.1:"XP",5.2:"XP","6.0":"Vista",6.1:"7",6.2:"8",6.3:"8.1",6.4:"10","10.0":"10"},Es=function(e,t){return t=t||"",D(e," OPR/")&&D(e,"Mini")?Xn:D(e," OPR/")?Jn:bs.test(e)?qn:D(e,"IE"+Pn)||D(e,"WPDesktop")?Yn:D(e,Gn)?Hn:D(e,Zn)||D(e,"Edg/")?Qn:D(e,"FBIOS")?"Facebook "+Pn:D(e,"UCWEB")||D(e,"UCBrowser")?"UC Browser":D(e,"CriOS")?zn:D(e,"CrMo")||D(e,Wn)?Wn:D(e,An)&&D(e,Un)?ss:D(e,"FxiOS")?ts:D(e.toLowerCase(),gs.toLowerCase())?gs:((e,t)=>t&&D(t,Nn)||function(e){return D(e,Un)&&!D(e,Wn)&&!D(e,An)}(e))(e,t)?D(e,Pn)?os:Un:D(e,es)?es:D(e,"MSIE")||D(e,"Trident/")?Vn:D(e,"Gecko")?es:""},ks={[Yn]:[new RegExp("rv:"+vs)],[Qn]:[new RegExp(Zn+"?\\/"+vs)],[Wn]:[new RegExp("("+Wn+"|CrMo)\\/"+vs)],[zn]:[new RegExp("CriOS\\/"+vs)],"UC Browser":[new RegExp("(UCBrowser|UCWEB)\\/"+vs)],[Un]:[fs],[os]:[fs],[Jn]:[new RegExp("(Opera|OPR)\\/"+vs)],[es]:[new RegExp(es+"\\/"+vs)],[ts]:[new RegExp("FxiOS\\/"+vs)],[gs]:[new RegExp("Konqueror[:/]?"+vs,"i")],[qn]:[new RegExp(qn+" "+vs),fs],[ss]:[new RegExp("android\\s"+vs,"i")],[Hn]:[new RegExp(Gn+"\\/"+vs)],[Vn]:[new RegExp("(rv:|MSIE )"+vs)],Mozilla:[new RegExp("rv:"+vs)]},xs=function(e,t){var i=Es(e,t),r=ks[i];if(K(r))return null;for(var n=0;n<r.length;n++){var s=r[n],o=e.match(s);if(o)return parseFloat(o[o.length-2])}return null},Ss=[[new RegExp(ns+"; "+ns+" (.*?)[);]","i"),e=>[ns,e&&e[1]||""]],[new RegExp(is,"i"),[is,""]],[new RegExp(rs,"i"),[rs,""]],[bs,[qn,""]],[new RegExp(as,"i"),(e,t)=>{if(/Phone/.test(t)||/WPDesktop/.test(t))return[ls,""];if(new RegExp(Pn).test(t)&&!/IEMobile\b/.test(t))return[as+" "+Pn,""];var i=/Windows NT ([0-9.]+)/i.exec(t);if(i&&i[1]){var r=i[1],n=ws[r]||"";return/arm/i.test(t)&&(n="RT"),[as,n]}return[as,""]}],[/((iPhone|iPad|iPod).*?OS (\d+)_(\d+)_?(\d+)?|iPhone)/,e=>{if(e&&e[3]){var t=[e[3],e[4],e[5]||"0"];return[Mn,t.join(".")]}return[Mn,""]}],[/(watch.*\/(\d+\.\d+\.\d+)|watch os,(\d+\.\d+),)/i,e=>{var t="";return e&&e.length>=3&&(t=K(e[2])?e[3]:e[2]),["watchOS",t]}],[new RegExp("("+An+" (\\d+)\\.(\\d+)\\.?(\\d+)?|"+An+")","i"),e=>{if(e&&e[2]){var t=[e[2],e[3],e[4]||"0"];return[An,t.join(".")]}return[An,""]}],[/Mac OS X (\d+)[_.](\d+)[_.]?(\d+)?/i,e=>{var t=["Mac OS X",""];if(e&&e[1]){var i=[e[1],e[2],e[3]||"0"];t[1]=i.join(".")}return t}],[/Mac/i,["Mac OS X",""]],[/CrOS/,[Kn,""]],[/Linux|debian/i,["Linux",""]]],Is=function(e){return ys.test(e)?is:ms.test(e)?rs:_s.test(e)?ns:new RegExp(us,"i").test(e)?us:new RegExp("("+ls+"|WPDesktop)","i").test(e)?ls:/iPad/.test(e)?Ln:/iPod/.test(e)?"iPod Touch":/iPhone/.test(e)?"iPhone":/(watch)(?: ?os[,/]|\d,\d\/)[\d.]+/i.test(e)?Bn:bs.test(e)?qn:/(kobo)\s(ereader|touch)/i.test(e)?"Kobo":new RegExp(cs,"i").test(e)?cs:/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i.test(e)||/(kf[a-z]+)( bui|\)).+silk\//i.test(e)?"Kindle Fire":/(Android|ZTE)/i.test(e)?!new RegExp(Pn).test(e)||/(9138B|TB782B|Nexus [97]|pixel c|HUAWEISHT|BTV|noble nook|smart ultra 6)/i.test(e)?/pixel[\daxl ]{1,6}/i.test(e)&&!/pixel c/i.test(e)||/(huaweimed-al00|tah-|APA|SM-G92|i980|zte|U304AA)/i.test(e)||/lmy47v/i.test(e)&&!/QTAQZ3/i.test(e)?An:Tn:An:new RegExp("(pda|"+Pn+")","i").test(e)?ds:new RegExp(Dn,"i").test(e)&&!new RegExp(Dn+" pc","i").test(e)?ps:""},Fs="https?://(.*)",Rs=["gclid","gclsrc","dclid","gbraid","wbraid","fbclid","msclkid","twclid","li_fat_id","igshid","ttclid","rdt_cid","epik","qclid","sccid","irclid","_kx"],Os=he(["utm_source","utm_medium","utm_campaign","utm_content","utm_term","gad_source","mc_cid"],Rs),$s="<masked>";function Cs(e,t,i){if(!x)return{};var r=t?he([],Rs,i||[]):[];return Ps(Tt(x.URL,r,$s),e)}function Ps(e,t){var i=Os.concat(t||[]),r={};return ce(i,(function(t){var i=Dt(e,t);r[t]=i||null})),r}function Ms(e){var t=function(e){return e?0===e.search(Fs+"google.([^/?]*)")?"google":0===e.search(Fs+"bing.com")?"bing":0===e.search(Fs+"yahoo.com")?"yahoo":0===e.search(Fs+"duckduckgo.com")?"duckduckgo":null:null}(e),i="yahoo"!=t?"q":"p",r={};if(!Y(t)){r.$search_engine=t;var n=x?Dt(x.referrer,i):"";n.length&&(r.ph_keyword=n)}return r}function As(){return navigator.language||navigator.userLanguage}function Ds(){return(null==x?void 0:x.referrer)||"$direct"}function Ts(e,t){var i=e?he([],Rs,t||[]):[],r=null==S?void 0:S.href.substring(0,1e3);return{r:Ds().substring(0,1e3),u:r?Tt(r,i,$s):void 0}}function Ls(e){var t,{r:i,u:r}=e,n={$referrer:i,$referring_domain:null==i?void 0:"$direct"==i?"$direct":null==(t=At(i))?void 0:t.host};if(r){n.$current_url=r;var s=At(r);n.$host=null==s?void 0:s.host,n.$pathname=null==s?void 0:s.pathname;var o=Ps(r);ue(n,o)}if(i){var a=Ms(i);ue(n,a)}return n}function Ns(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){return}}function Bs(){try{return(new Date).getTimezoneOffset()}catch(e){return}}function Us(e,t){if(!O)return{};var i,r,n,s=e?he([],Rs,t||[]):[],[o,a]=function(e){for(var t=0;t<Ss.length;t++){var[i,r]=Ss[t],n=i.exec(e),s=n&&(G(r)?r(n,e):r);if(s)return s}return["",""]}(O);return ue(ve({$os:o,$os_version:a,$browser:Es(O,navigator.vendor),$device:Is(O),$device_type:(r=O,n=Is(r),n===Ln||n===Tn||"Kobo"===n||"Kindle Fire"===n||n===ps?Dn:n===is||n===ns||n===rs||n===us?"Console":n===Bn?"Wearable":n?Pn:"Desktop"),$timezone:Ns(),$timezone_offset:Bs()}),{$current_url:Tt(null==S?void 0:S.href,s,$s),$host:null==S?void 0:S.host,$pathname:null==S?void 0:S.pathname,$raw_user_agent:O.length>1e3?O.substring(0,997)+"...":O,$browser_version:xs(O,navigator.vendor),$browser_language:As(),$browser_language_prefix:(i=As(),"string"==typeof i?i.split("-")[0]:void 0),$screen_height:null==m?void 0:m.screen.height,$screen_width:null==m?void 0:m.screen.width,$viewport_height:null==m?void 0:m.innerHeight,$viewport_width:null==m?void 0:m.innerWidth,$lib:"web",$lib_version:C.LIB_VERSION,$insert_id:Math.random().toString(36).substring(2,10)+Math.random().toString(36).substring(2,10),$time:Date.now()/1e3})}var qs,js=ie("[FeatureFlags]"),Gs="$active_feature_flags",Hs="$override_feature_flags",Ws="$feature_flag_payloads",Ks="$override_feature_flag_payloads",zs="$feature_flag_request_id",Vs=e=>{var t={};for(var[i,r]of de(e||{}))r&&(t[i]=r);return t};!function(e){e.FeatureFlags="feature_flags",e.Recordings="recordings"}(qs||(qs={}));class Ys{constructor(e){this.oe=!1,this.ae=!1,this.le=!1,this.he=!1,this.ue=!1,this.de=!1,this.ve=!1,this._instance=e,this.featureFlagEventHandlers=[]}decide(){if(this._instance.config.__preview_remote_config)this.de=!0;else{var e=!this.ce&&(this._instance.config.advanced_disable_feature_flags||this._instance.config.advanced_disable_feature_flags_on_first_load);this.fe({disableFlags:e})}}get hasLoadedFlags(){return this.ae}getFlags(){return Object.keys(this.getFlagVariants())}getFlagsWithDetails(){var e=this._instance.get_property(Ge),t=this._instance.get_property(Hs),i=this._instance.get_property(Ks);if(!i&&!t)return e||{};var r=ue({},e||{}),n=[...new Set([...Object.keys(i||{}),...Object.keys(t||{})])];for(var s of n){var o,a,l=r[s],c=null==t?void 0:t[s],u=K(c)?null!==(o=null==l?void 0:l.enabled)&&void 0!==o&&o:!!c,h=K(c)?l.variant:"string"==typeof c?c:void 0,d=null==i?void 0:i[s],p=se({},l,{enabled:u,variant:u?null!=h?h:null==l?void 0:l.variant:void 0});u!==(null==l?void 0:l.enabled)&&(p.original_enabled=null==l?void 0:l.enabled),h!==(null==l?void 0:l.variant)&&(p.original_variant=null==l?void 0:l.variant),d&&(p.metadata=se({},null==l?void 0:l.metadata,{payload:d,original_payload:null==l||null==(a=l.metadata)?void 0:a.payload})),r[s]=p}return this.oe||(js.warn(" Overriding feature flag details!",{flagDetails:e,overriddenPayloads:i,finalDetails:r}),this.oe=!0),r}getFlagVariants(){var e=this._instance.get_property(qe),t=this._instance.get_property(Hs);if(!t)return e||{};for(var i=ue({},e),r=Object.keys(t),n=0;n<r.length;n++)i[r[n]]=t[r[n]];return this.oe||(js.warn(" Overriding feature flags!",{enabledFlags:e,overriddenFlags:t,finalFlags:i}),this.oe=!0),i}getFlagPayloads(){var e=this._instance.get_property(Ws),t=this._instance.get_property(Ks);if(!t)return e||{};for(var i=ue({},e||{}),r=Object.keys(t),n=0;n<r.length;n++)i[r[n]]=t[r[n]];return this.oe||(js.warn(" Overriding feature flag payloads!",{flagPayloads:e,overriddenPayloads:t,finalPayloads:i}),this.oe=!0),i}reloadFeatureFlags(){this.he||this._instance.config.advanced_disable_feature_flags||this.ce||(this.ce=setTimeout((()=>{this.fe()}),5))}pe(){clearTimeout(this.ce),this.ce=void 0}ensureFlagsLoaded(){this.ae||this.le||this.ce||this.reloadFeatureFlags()}setAnonymousDistinctId(e){this.$anon_distinct_id=e}setReloadingPaused(e){this.he=e}fe(e){var t;if(this.pe(),!this._instance.config.advanced_disable_decide)if(this.le)this.ue=!0;else{var i={token:this._instance.config.token,distinct_id:this._instance.get_distinct_id(),groups:this._instance.getGroups(),$anon_distinct_id:this.$anon_distinct_id,person_properties:se({},(null==(t=this._instance.persistence)?void 0:t.get_initial_props())||{},this._instance.get_property(He)||{}),group_properties:this._instance.get_property(We)};(null!=e&&e.disableFlags||this._instance.config.advanced_disable_feature_flags)&&(i.disable_flags=!0);var r=this._instance.config.__preview_flags_v2&&this._instance.config.__preview_remote_config;r&&(i.timezone=Ns()),this.le=!0,this._instance.ge({method:"POST",url:this._instance.requestRouter.endpointFor("api",r?"/flags/?v=2":"/decide/?v=4"),data:i,compression:this._instance.config.disable_compression?void 0:_.Base64,timeout:this._instance.config.feature_flag_request_timeout_ms,callback:e=>{var t,r,n,s=!0;200===e.statusCode&&(this.ue||(this.$anon_distinct_id=void 0),s=!1),this.le=!1,this.de||(this.de=!0,this._instance._e(null!==(n=e.json)&&void 0!==n?n:{})),i.disable_flags&&!this.ue||(this.ve=!s,e.json&&null!=(t=e.json.quotaLimited)&&t.includes(qs.FeatureFlags)?js.warn("You have hit your feature flags quota limit, and will not be able to load feature flags until the quota is reset.  Please visit https://posthog.com/docs/billing/limits-alerts to learn more."):(this.receivedFeatureFlags(null!==(r=e.json)&&void 0!==r?r:{},s),this.ue&&(this.ue=!1,this.fe())))}})}}getFeatureFlag(e,t){if(void 0===t&&(t={}),this.ae||this.getFlags()&&this.getFlags().length>0){var i=this.getFlagVariants()[e],r=""+i,n=this._instance.get_property(zs)||void 0,s=this._instance.get_property(Ve)||{};if((t.send_event||!("send_event"in t))&&(!(e in s)||!s[e].includes(r))){var o,a,l,c,u,h,d,p,g,v,f;j(s[e])?s[e].push(r):s[e]=[r],null==(o=this._instance.persistence)||o.register({[Ve]:s});var _=this.getFeatureFlagDetails(e),m={$feature_flag:e,$feature_flag_response:i,$feature_flag_payload:this.getFeatureFlagPayload(e)||null,$feature_flag_request_id:n,$feature_flag_bootstrapped_response:(null==(a=this._instance.config.bootstrap)||null==(l=a.featureFlags)?void 0:l[e])||null,$feature_flag_bootstrapped_payload:(null==(c=this._instance.config.bootstrap)||null==(u=c.featureFlagPayloads)?void 0:u[e])||null,$used_bootstrap_value:!this.ve};K(null==_||null==(h=_.metadata)?void 0:h.version)||(m.$feature_flag_version=_.metadata.version);var y,b=null!==(d=null==_||null==(p=_.reason)?void 0:p.description)&&void 0!==d?d:null==_||null==(g=_.reason)?void 0:g.code;b&&(m.$feature_flag_reason=b),null!=_&&null!=(v=_.metadata)&&v.id&&(m.$feature_flag_id=_.metadata.id),K(null==_?void 0:_.original_variant)&&K(null==_?void 0:_.original_enabled)||(m.$feature_flag_original_response=K(_.original_variant)?_.original_enabled:_.original_variant),null!=_&&null!=(f=_.metadata)&&f.original_payload&&(m.$feature_flag_original_payload=null==_||null==(y=_.metadata)?void 0:y.original_payload),this._instance.capture("$feature_flag_called",m)}return i}js.warn('getFeatureFlag for key "'+e+"\" failed. Feature flags didn't load in time.")}getFeatureFlagDetails(e){return this.getFlagsWithDetails()[e]}getFeatureFlagPayload(e){return this.getFlagPayloads()[e]}getRemoteConfigPayload(e,t){var i=this._instance.config.token;this._instance.ge({method:"POST",url:this._instance.requestRouter.endpointFor("api","/decide/?v=4"),data:{distinct_id:this._instance.get_distinct_id(),token:i},compression:this._instance.config.disable_compression?void 0:_.Base64,timeout:this._instance.config.feature_flag_request_timeout_ms,callback:i=>{var r,n=null==(r=i.json)?void 0:r.featureFlagPayloads;t((null==n?void 0:n[e])||void 0)}})}isFeatureEnabled(e,t){if(void 0===t&&(t={}),this.ae||this.getFlags()&&this.getFlags().length>0)return!!this.getFeatureFlag(e,t);js.warn('isFeatureEnabled for key "'+e+"\" failed. Feature flags didn't load in time.")}addFeatureFlagsHandler(e){this.featureFlagEventHandlers.push(e)}removeFeatureFlagsHandler(e){this.featureFlagEventHandlers=this.featureFlagEventHandlers.filter((t=>t!==e))}receivedFeatureFlags(e,t){if(this._instance.persistence){this.ae=!0;var i=this.getFlagVariants(),r=this.getFlagPayloads(),n=this.getFlagsWithDetails();!function(e,t,i,r,n){void 0===i&&(i={}),void 0===r&&(r={}),void 0===n&&(n={});var s=(e=>{var t=e.flags;return t?(e.featureFlags=Object.fromEntries(Object.keys(t).map((e=>{var i;return[e,null!==(i=t[e].variant)&&void 0!==i?i:t[e].enabled]}))),e.featureFlagPayloads=Object.fromEntries(Object.keys(t).filter((e=>t[e].enabled)).filter((e=>{var i;return null==(i=t[e].metadata)?void 0:i.payload})).map((e=>{var i;return[e,null==(i=t[e].metadata)?void 0:i.payload]})))):js.warn("Using an older version of the feature flags endpoint. Please upgrade your PostHog server to the latest version"),e})(e),o=s.flags,a=s.featureFlags,l=s.featureFlagPayloads;if(a){var c=e.requestId;if(j(a)){js.warn("v1 of the feature flags endpoint is deprecated. Please use the latest version.");var u={};if(a)for(var h=0;h<a.length;h++)u[a[h]]=!0;t&&t.register({[Gs]:a,[qe]:u})}else{var d=a,p=l,g=o;e.errorsWhileComputingFlags&&(d=se({},i,d),p=se({},r,p),g=se({},n,g)),t&&t.register(se({[Gs]:Object.keys(Vs(d)),[qe]:d||{},[Ws]:p||{},[Ge]:g||{}},c?{[zs]:c}:{}))}}}(e,this._instance.persistence,i,r,n),this.me(t)}}override(e,t){void 0===t&&(t=!1),js.warn("override is deprecated. Please use overrideFeatureFlags instead."),this.overrideFeatureFlags({flags:e,suppressWarning:t})}overrideFeatureFlags(e){if(!this._instance.__loaded||!this._instance.persistence)return js.uninitializedWarning("posthog.featureFlags.overrideFeatureFlags");if(!1===e)return this._instance.persistence.unregister(Hs),this._instance.persistence.unregister(Ks),void this.me();if(e&&"object"==typeof e&&("flags"in e||"payloads"in e)){var t,i=e;if(this.oe=Boolean(null!==(t=i.suppressWarning)&&void 0!==t&&t),"flags"in i)if(!1===i.flags)this._instance.persistence.unregister(Hs);else if(i.flags)if(j(i.flags)){for(var r={},n=0;n<i.flags.length;n++)r[i.flags[n]]=!0;this._instance.persistence.register({[Hs]:r})}else this._instance.persistence.register({[Hs]:i.flags});return"payloads"in i&&(!1===i.payloads?this._instance.persistence.unregister(Ks):i.payloads&&this._instance.persistence.register({[Ks]:i.payloads})),void this.me()}this.me()}onFeatureFlags(e){if(this.addFeatureFlagsHandler(e),this.ae){var{flags:t,flagVariants:i}=this.be();e(t,i)}return()=>this.removeFeatureFlagsHandler(e)}updateEarlyAccessFeatureEnrollment(e,t){var i,r=(this._instance.get_property(je)||[]).find((t=>t.flagKey===e)),n={["$feature_enrollment/"+e]:t},s={$feature_flag:e,$feature_enrollment:t,$set:n};r&&(s.$early_access_feature_name=r.name),this._instance.capture("$feature_enrollment_update",s),this.setPersonPropertiesForFlags(n,!1);var o=se({},this.getFlagVariants(),{[e]:t});null==(i=this._instance.persistence)||i.register({[Gs]:Object.keys(Vs(o)),[qe]:o}),this.me()}getEarlyAccessFeatures(e,t,i){void 0===t&&(t=!1);var r=this._instance.get_property(je),n=i?"&"+i.map((e=>"stage="+e)).join("&"):"";if(r&&!t)return e(r);this._instance.ge({url:this._instance.requestRouter.endpointFor("api","/api/early_access_features/?token="+this._instance.config.token+n),method:"GET",callback:t=>{var i;if(t.json){var r=t.json.earlyAccessFeatures;return null==(i=this._instance.persistence)||i.register({[je]:r}),e(r)}}})}be(){var e=this.getFlags(),t=this.getFlagVariants();return{flags:e.filter((e=>t[e])),flagVariants:Object.keys(t).filter((e=>t[e])).reduce(((e,i)=>(e[i]=t[i],e)),{})}}me(e){var{flags:t,flagVariants:i}=this.be();this.featureFlagEventHandlers.forEach((r=>r(t,i,{errorsLoading:e})))}setPersonPropertiesForFlags(e,t){void 0===t&&(t=!0);var i=this._instance.get_property(He)||{};this._instance.register({[He]:se({},i,e)}),t&&this._instance.reloadFeatureFlags()}resetPersonPropertiesForFlags(){this._instance.unregister(He)}setGroupPropertiesForFlags(e,t){void 0===t&&(t=!0);var i=this._instance.get_property(We)||{};0!==Object.keys(i).length&&Object.keys(i).forEach((t=>{i[t]=se({},i[t],e[t]),delete e[t]})),this._instance.register({[We]:se({},i,e)}),t&&this._instance.reloadFeatureFlags()}resetGroupPropertiesForFlags(e){if(e){var t=this._instance.get_property(We)||{};this._instance.register({[We]:se({},t,{[e]:{}})})}else this._instance.unregister(We)}}var Js=["cookie","localstorage","localstorage+cookie","sessionstorage","memory"];class Xs{constructor(e){this.S=e,this.props={},this.we=!1,this.ye=(e=>{var t="";return e.token&&(t=e.token.replace(/\+/g,"PL").replace(/\//g,"SL").replace(/=/g,"EQ")),e.persistence_name?"ph_"+e.persistence_name:"ph_"+t+"_posthog"})(e),this.q=this.Se(e),this.load(),e.debug&&te.info("Persistence loaded",e.persistence,se({},this.props)),this.update_config(e,e),this.save()}Se(e){-1===Js.indexOf(e.persistence.toLowerCase())&&(te.critical("Unknown persistence type "+e.persistence+"; falling back to localStorage+cookie"),e.persistence="localStorage+cookie");var t=e.persistence.toLowerCase();return"localstorage"===t&&ii.O()?ii:"localstorage+cookie"===t&&ni.O()?ni:"sessionstorage"===t&&li.O()?li:"memory"===t?oi:"cookie"===t?ei:ni.O()?ni:ei}properties(){var e={};return ce(this.props,(function(t,i){if(i===qe&&H(t))for(var r=Object.keys(t),n=0;n<r.length;n++)e["$feature/"+r[n]]=t[r[n]];else o=i,a=!1,(Y(s=nt)?a:E&&s.indexOf===E?-1!=s.indexOf(o):(ce(s,(function(e){if(a||(a=e===o))return ae})),a))||(e[i]=t);var s,o,a})),e}load(){if(!this.$e){var e=this.q.D(this.ye);e&&(this.props=ue({},e))}}save(){this.$e||this.q.j(this.ye,this.props,this.ke,this.xe,this.Ee,this.S.debug)}remove(){this.q.L(this.ye,!1),this.q.L(this.ye,!0)}clear(){this.remove(),this.props={}}register_once(e,t,i){if(H(e)){K(t)&&(t="None"),this.ke=K(i)?this.Ie:i;var r=!1;if(ce(e,((e,i)=>{this.props.hasOwnProperty(i)&&this.props[i]!==t||(this.props[i]=e,r=!0)})),r)return this.save(),!0}return!1}register(e,t){if(H(e)){this.ke=K(t)?this.Ie:t;var i=!1;if(ce(e,((t,r)=>{e.hasOwnProperty(r)&&this.props[r]!==t&&(this.props[r]=t,i=!0)})),i)return this.save(),!0}return!1}unregister(e){e in this.props&&(delete this.props[e],this.save())}update_campaign_params(){if(!this.we){var e=Cs(this.S.custom_campaign_params,this.S.mask_personal_data_properties,this.S.custom_personal_data_properties);W(ve(e))||this.register(e),this.we=!0}}update_search_keyword(){var e;this.register((e=null==x?void 0:x.referrer)?Ms(e):{})}update_referrer_info(){var e;this.register_once({$referrer:Ds(),$referring_domain:null!=x&&x.referrer&&(null==(e=At(x.referrer))?void 0:e.host)||"$direct"},void 0)}set_initial_person_info(){this.props[Ze]||this.props[Qe]||this.register_once({[et]:Ts(this.S.mask_personal_data_properties,this.S.custom_personal_data_properties)},void 0)}get_initial_props(){var e={};ce([Qe,Ze],(t=>{var i=this.props[t];i&&ce(i,(function(t,i){e["$initial_"+L(i)]=t}))}));var t,i,r=this.props[et];if(r){var n=(t=Ls(r),i={},ce(t,(function(e,t){i["$initial_"+L(t)]=e})),i);ue(e,n)}return e}safe_merge(e){return ce(this.props,(function(t,i){i in e||(e[i]=t)})),e}update_config(e,t){if(this.Ie=this.ke=e.cookie_expiration,this.set_disabled(e.disable_persistence),this.set_cross_subdomain(e.cross_subdomain_cookie),this.set_secure(e.secure_cookie),e.persistence!==t.persistence){var i=this.Se(e),r=this.props;this.clear(),this.q=i,this.props=r,this.save()}}set_disabled(e){this.$e=e,this.$e?this.remove():this.save()}set_cross_subdomain(e){e!==this.xe&&(this.xe=e,this.remove(),this.save())}set_secure(e){e!==this.Ee&&(this.Ee=e,this.remove(),this.save())}set_event_timer(e,t){var i=this.props[Ee]||{};i[e]=t,this.props[Ee]=i,this.save()}remove_event_timer(e){var t=(this.props[Ee]||{})[e];return K(t)||(delete this.props[Ee][e],this.save()),t}get_property(e){return this.props[e]}set_property(e,t){this.props[e]=t,this.save()}}class Zs{constructor(){this.Pe={},this.Pe={}}on(e,t){return this.Pe[e]||(this.Pe[e]=[]),this.Pe[e].push(t),()=>{this.Pe[e]=this.Pe[e].filter((e=>e!==t))}}emit(e,t){for(var i of this.Pe[e]||[])i(t);for(var r of this.Pe["*"]||[])r(e,t)}}var Qs=function(e,t){if(!function(e){try{new RegExp(e)}catch(e){return!1}return!0}(t))return!1;try{return new RegExp(t).test(e)}catch(e){return!1}};class eo{constructor(e){this.Re=new Zs,this.Te=(e,t)=>this.Me(e,t)&&this.Ce(e,t)&&this.Oe(e,t),this.Me=(e,t)=>null==t||!t.event||(null==e?void 0:e.event)===(null==t?void 0:t.event),this._instance=e,this.Fe=new Set,this.Ae=new Set}init(){var e,t;K(null==(e=this._instance)?void 0:e.De)||(null==(t=this._instance)||t.De(((e,t)=>{this.on(e,t)})))}register(e){var t,i;if(!K(null==(t=this._instance)?void 0:t.De)&&(e.forEach((e=>{var t,i;null==(t=this.Ae)||t.add(e),null==(i=e.steps)||i.forEach((e=>{var t;null==(t=this.Fe)||t.add((null==e?void 0:e.event)||"")}))})),null!=(i=this._instance)&&i.autocapture)){var r,n=new Set;e.forEach((e=>{var t;null==(t=e.steps)||t.forEach((e=>{null!=e&&e.selector&&n.add(null==e?void 0:e.selector)}))})),null==(r=this._instance)||r.autocapture.setElementSelectors(n)}}on(e,t){var i;null!=t&&0!=e.length&&(this.Fe.has(e)||this.Fe.has(null==t?void 0:t.event))&&this.Ae&&(null==(i=this.Ae)?void 0:i.size)>0&&this.Ae.forEach((e=>{this.je(t,e)&&this.Re.emit("actionCaptured",e.name)}))}Le(e){this.onAction("actionCaptured",(t=>e(t)))}je(e,t){if(null==(null==t?void 0:t.steps))return!1;for(var i of t.steps)if(this.Te(e,i))return!0;return!1}onAction(e,t){return this.Re.on(e,t)}Ce(e,t){if(null!=t&&t.url){var i,r=null==e||null==(i=e.properties)?void 0:i.$current_url;if(!r||"string"!=typeof r)return!1;if(!eo.Ne(r,null==t?void 0:t.url,(null==t?void 0:t.url_matching)||"contains"))return!1}return!0}static Ne(e,t,i){switch(i){case"regex":return!!m&&Qs(e,t);case"exact":return t===e;case"contains":var r=eo.ze(t).replace(/_/g,".").replace(/%/g,".*");return Qs(e,r);default:return!1}}static ze(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}Oe(e,t){if((null!=t&&t.href||null!=t&&t.tag_name||null!=t&&t.text)&&!this.Ue(e).some((e=>!(null!=t&&t.href&&!eo.Ne(e.href||"",null==t?void 0:t.href,(null==t?void 0:t.href_matching)||"exact")||null!=t&&t.tag_name&&e.tag_name!==(null==t?void 0:t.tag_name)||null!=t&&t.text&&!eo.Ne(e.text||"",null==t?void 0:t.text,(null==t?void 0:t.text_matching)||"exact")&&!eo.Ne(e.$el_text||"",null==t?void 0:t.text,(null==t?void 0:t.text_matching)||"exact")))))return!1;if(null!=t&&t.selector){var i,r=null==e||null==(i=e.properties)?void 0:i.$element_selectors;if(!r)return!1;if(!r.includes(null==t?void 0:t.selector))return!1}return!0}Ue(e){return null==(null==e?void 0:e.properties.$elements)?[]:null==e?void 0:e.properties.$elements}}var to=ie("[Surveys]");class io{constructor(e){this._instance=e,this.qe=new Map,this.Be=new Map}register(e){var t;K(null==(t=this._instance)?void 0:t.De)||(this.He(e),this.We(e))}We(e){var t=e.filter((e=>{var t,i,r,n;return(null==(t=e.conditions)?void 0:t.actions)&&(null==(i=e.conditions)||null==(r=i.actions)||null==(n=r.values)?void 0:n.length)>0}));0!==t.length&&(null==this.Ge&&(this.Ge=new eo(this._instance),this.Ge.init(),this.Ge.Le((e=>{this.onAction(e)}))),t.forEach((e=>{var t,i,r,n,s,o,a,l,c,u;e.conditions&&null!=(t=e.conditions)&&t.actions&&null!=(i=e.conditions)&&null!=(r=i.actions)&&r.values&&(null==(n=e.conditions)||null==(s=n.actions)||null==(o=s.values)?void 0:o.length)>0&&(null==(a=this.Ge)||a.register(e.conditions.actions.values),null==(l=e.conditions)||null==(c=l.actions)||null==(u=c.values)||u.forEach((t=>{if(t&&t.name){var i=this.Be.get(t.name);i&&i.push(e.id),this.Be.set(t.name,i||[e.id])}})))})))}He(e){var t;0!==e.filter((e=>{var t,i,r,n;return(null==(t=e.conditions)?void 0:t.events)&&(null==(i=e.conditions)||null==(r=i.events)||null==(n=r.values)?void 0:n.length)>0})).length&&(null==(t=this._instance)||t.De(((e,t)=>{this.onEvent(e,t)})),e.forEach((e=>{var t,i,r;null==(t=e.conditions)||null==(i=t.events)||null==(r=i.values)||r.forEach((t=>{if(t&&t.name){var i=this.qe.get(t.name);i&&i.push(e.id),this.qe.set(t.name,i||[e.id])}}))})))}onEvent(e,t){var i,r,n=(null==(i=this._instance)||null==(r=i.persistence)?void 0:r.props[ze])||[];if("survey shown"===e&&t&&n.length>0){var s;to.info("survey event matched, removing survey from activated surveys",{event:e,eventPayload:t,existingActivatedSurveys:n});var o=null==t||null==(s=t.properties)?void 0:s.$survey_id;if(o){var a=n.indexOf(o);a>=0&&(n.splice(a,1),this.Je(n))}}else this.qe.has(e)&&(to.info("survey event matched, updating activated surveys",{event:e,surveys:this.qe.get(e)}),this.Je(n.concat(this.qe.get(e)||[])))}onAction(e){var t,i,r=(null==(t=this._instance)||null==(i=t.persistence)?void 0:i.props[ze])||[];this.Be.has(e)&&this.Je(r.concat(this.Be.get(e)||[]))}Je(e){var t,i;null==(t=this._instance)||null==(i=t.persistence)||i.register({[ze]:[...new Set(e)]})}getSurveys(){var e,t;return(null==(e=this._instance)||null==(t=e.persistence)?void 0:t.props[ze])||[]}getEventToSurveys(){return this.qe}Ve(){return this.Ge}}class ro{constructor(e){this.Ke=null,this.Ye=!1,this.Xe=!1,this.Qe=[],this._instance=e,this._surveyEventReceiver=null}onRemoteConfig(e){var t=e.surveys;if(J(t))return to.warn("Decide not loaded yet. Not loading surveys.");var i=j(t);this.Ze=i?t.length>0:t,to.info("decide response received, hasSurveys: "+this.Ze),this.Ze&&this.loadIfEnabled()}reset(){localStorage.removeItem("lastSeenSurveyDate");for(var e=[],t=0;t<localStorage.length;t++){var i=localStorage.key(t);(null!=i&&i.startsWith("seenSurvey_")||null!=i&&i.startsWith("inProgressSurvey_"))&&e.push(i)}e.forEach((e=>localStorage.removeItem(e)))}loadIfEnabled(){if(!this.Ke)if(this.Xe)to.info("Already initializing surveys, skipping...");else if(this._instance.config.disable_surveys)to.info("Disabled. Not loading surveys.");else if(this.Ze){var e=null==$?void 0:$.__PosthogExtensions__;if(e){this.Xe=!0;try{var t=e.generateSurveys;if(t)return void this.tr(t);var i=e.loadExternalDependency;if(!i)return void this.ir("PostHog loadExternalDependency extension not found.");i(this._instance,"surveys",(t=>{t||!e.generateSurveys?this.ir("Could not load surveys script",t):this.tr(e.generateSurveys)}))}catch(e){throw this.ir("Error initializing surveys",e),e}finally{this.Xe=!1}}else to.error("PostHog Extensions not found.")}else to.info("No surveys to load.")}tr(e){this.Ke=e(this._instance),this._surveyEventReceiver=new io(this._instance),to.info("Surveys loaded successfully"),this.er({isLoaded:!0})}ir(e,t){to.error(e,t),this.er({isLoaded:!1,error:e})}onSurveysLoaded(e){return this.Qe.push(e),this.Ke&&this.er({isLoaded:!0}),()=>{this.Qe=this.Qe.filter((t=>t!==e))}}getSurveys(e,t){if(void 0===t&&(t=!1),this._instance.config.disable_surveys)return to.info("Disabled. Not loading surveys."),e([]);var i=this._instance.get_property(Ke);if(i&&!t)return e(i,{isLoaded:!0});if(this.Ye)return e([],{isLoaded:!1,error:"Surveys are already being loaded"});try{this.Ye=!0,this._instance.ge({url:this._instance.requestRouter.endpointFor("api","/api/surveys/?token="+this._instance.config.token),method:"GET",timeout:this._instance.config.surveys_request_timeout_ms,callback:t=>{var i;this.Ye=!1;var r=t.statusCode;if(200!==r||!t.json){var n="Surveys API could not be loaded, status: "+r;return to.error(n),e([],{isLoaded:!1,error:n})}var s,o=t.json.surveys||[],a=o.filter((e=>function(e){return!(!e.start_date||e.end_date)}(e)&&(function(e){var t,i,r;return!(null==(t=e.conditions)||null==(i=t.events)||null==(r=i.values)||!r.length)}(e)||function(e){var t,i,r;return!(null==(t=e.conditions)||null==(i=t.actions)||null==(r=i.values)||!r.length)}(e))));return a.length>0&&(null==(s=this._surveyEventReceiver)||s.register(a)),null==(i=this._instance.persistence)||i.register({[Ke]:o}),e(o,{isLoaded:!0})}})}catch(e){throw this.Ye=!1,e}}er(e){for(var t of this.Qe)try{e.isLoaded?this.getSurveys(t):t([],e)}catch(e){to.error("Error in survey callback",e)}}getActiveMatchingSurveys(e,t){if(void 0===t&&(t=!1),!J(this.Ke))return this.Ke.getActiveMatchingSurveys(e,t);to.warn("init was not called")}rr(e){var t=null;return this.getSurveys((i=>{var r;t=null!==(r=i.find((t=>t.id===e)))&&void 0!==r?r:null})),t}sr(e){if(J(this.Ke))return{eligible:!1,reason:"SDK is not enabled or survey functionality is not yet loaded"};var t="string"==typeof e?this.rr(e):e;return t?this.Ke.checkSurveyEligibility(t):{eligible:!1,reason:"Survey not found"}}canRenderSurvey(e){if(J(this.Ke))return to.warn("init was not called"),{visible:!1,disabledReason:"SDK is not enabled or survey functionality is not yet loaded"};var t=this.sr(e);return{visible:t.eligible,disabledReason:t.reason}}canRenderSurveyAsync(e,t){return J(this.Ke)?(to.warn("init was not called"),Promise.resolve({visible:!1,disabledReason:"SDK is not enabled or survey functionality is not yet loaded"})):new Promise((i=>{this.getSurveys((t=>{var r,n=null!==(r=t.find((t=>t.id===e)))&&void 0!==r?r:null;if(n){var s=this.sr(n);i({visible:s.eligible,disabledReason:s.reason})}else i({visible:!1,disabledReason:"Survey not found"})}),t)}))}renderSurvey(e,t){if(J(this.Ke))to.warn("init was not called");else{var i=this.rr(e),r=null==x?void 0:x.querySelector(t);i?r?this.Ke.renderSurvey(i,r):to.warn("Survey element not found"):to.warn("Survey not found")}}}var no=ie("[RateLimiter]");class so{constructor(e){var t,i;this.serverLimits={},this.lastEventRateLimited=!1,this.checkForLimiting=e=>{var t=e.text;if(t&&t.length)try{(JSON.parse(t).quota_limited||[]).forEach((e=>{no.info((e||"events")+" is quota limited."),this.serverLimits[e]=(new Date).getTime()+6e4}))}catch(e){return void no.warn('could not rate limit - continuing. Error: "'+(null==e?void 0:e.message)+'"',{text:t})}},this.instance=e,this.captureEventsPerSecond=(null==(t=e.config.rate_limiting)?void 0:t.events_per_second)||10,this.captureEventsBurstLimit=Math.max((null==(i=e.config.rate_limiting)?void 0:i.events_burst_limit)||10*this.captureEventsPerSecond,this.captureEventsPerSecond),this.lastEventRateLimited=this.clientRateLimitContext(!0).isRateLimited}clientRateLimitContext(e){var t,i,r;void 0===e&&(e=!1);var n=(new Date).getTime(),s=null!==(t=null==(i=this.instance.persistence)?void 0:i.get_property(Xe))&&void 0!==t?t:{tokens:this.captureEventsBurstLimit,last:n};s.tokens+=(n-s.last)/1e3*this.captureEventsPerSecond,s.last=n,s.tokens>this.captureEventsBurstLimit&&(s.tokens=this.captureEventsBurstLimit);var o=s.tokens<1;return o||e||(s.tokens=Math.max(0,s.tokens-1)),!o||this.lastEventRateLimited||e||this.instance.capture("$$client_ingestion_warning",{$$client_ingestion_warning_message:"posthog-js client rate limited. Config is set to "+this.captureEventsPerSecond+" events per second and "+this.captureEventsBurstLimit+" events burst limit."},{skip_client_rate_limiting:!0}),this.lastEventRateLimited=o,null==(r=this.instance.persistence)||r.set_property(Xe,s),{isRateLimited:o,remainingTokens:s.tokens}}isServerRateLimited(e){var t=this.serverLimits[e||"events"]||!1;return!1!==t&&(new Date).getTime()<t}}var oo=ie("[RemoteConfig]");class ao{constructor(e){this._instance=e}get remoteConfig(){var e,t;return null==(e=$._POSTHOG_REMOTE_CONFIG)||null==(t=e[this._instance.config.token])?void 0:t.config}nr(e){var t,i;null!=(t=$.__PosthogExtensions__)&&t.loadExternalDependency?null==(i=$.__PosthogExtensions__)||null==i.loadExternalDependency||i.loadExternalDependency(this._instance,"remote-config",(()=>e(this.remoteConfig))):(oo.error("PostHog Extensions not found. Cannot load remote config."),e())}ar(e){this._instance.ge({method:"GET",url:this._instance.requestRouter.endpointFor("assets","/array/"+this._instance.config.token+"/config"),callback:t=>{e(t.json)}})}load(){try{if(this.remoteConfig)return oo.info("Using preloaded remote config",this.remoteConfig),void this._e(this.remoteConfig);if(this._instance.config.advanced_disable_decide)return void oo.warn("Remote config is disabled. Falling back to local config.");this.nr((e=>{if(!e)return oo.info("No config found after loading remote JS config. Falling back to JSON."),void this.ar((e=>{this._e(e)}));this._e(e)}))}catch(e){oo.error("Error loading remote config",e)}}_e(e){e?this._instance.config.__preview_remote_config?(this._instance._e(e),!1!==e.hasFeatureFlags&&this._instance.featureFlags.ensureFlagsLoaded()):oo.info("__preview_remote_config is disabled. Logging config instead",e):oo.error("Failed to fetch remote config from PostHog.")}}var lo=!!F||!!I,co="text/plain",uo=(e,t)=>{var[i,r]=e.split("?"),n=se({},t);null==r||r.split("&").forEach((e=>{var[t]=e.split("=");delete n[t]}));var s=function(e,t){var i,r;void 0===t&&(t="&");var n=[];return ce(e,(function(e,t){K(e)||K(t)||"undefined"===t||(i=encodeURIComponent((e=>e instanceof File)(e)?e.name:e.toString()),r=encodeURIComponent(t),n[n.length]=r+"="+i)})),n.join(t)}(n);return i+"?"+(s?(r?r+"&":"")+s:r)},ho=(e,t)=>JSON.stringify(e,((e,t)=>"bigint"==typeof t?t.toString():t),t),po=e=>{var{data:t,compression:i}=e;if(t){if(i===_.GZipJS){var r=Lr(Nr(ho(t)),{mtime:0}),n=new Blob([r],{type:co});return{contentType:co,body:n,estimatedSize:n.size}}if(i===_.Base64){var s=function(e){var t,i,r,n,s,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=0,l=0,c="",u=[];if(!e)return e;e=function(e){var t,i,r,n,s="";for(t=i=0,r=(e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n")).length,n=0;n<r;n++){var o=e.charCodeAt(n),a=null;o<128?i++:a=o>127&&o<2048?String.fromCharCode(o>>6|192,63&o|128):String.fromCharCode(o>>12|224,o>>6&63|128,63&o|128),Y(a)||(i>t&&(s+=e.substring(t,i)),s+=a,t=i=n+1)}return i>t&&(s+=e.substring(t,e.length)),s}(e);do{t=(s=e.charCodeAt(a++)<<16|e.charCodeAt(a++)<<8|e.charCodeAt(a++))>>18&63,i=s>>12&63,r=s>>6&63,n=63&s,u[l++]=o.charAt(t)+o.charAt(i)+o.charAt(r)+o.charAt(n)}while(a<e.length);switch(c=u.join(""),e.length%3){case 1:c=c.slice(0,-2)+"==";break;case 2:c=c.slice(0,-1)+"="}return c}(ho(t)),o=(e=>"data="+encodeURIComponent("string"==typeof e?e:ho(e)))(s);return{contentType:"application/x-www-form-urlencoded",body:o,estimatedSize:new Blob([o]).size}}var a=ho(t);return{contentType:"application/json",body:a,estimatedSize:new Blob([a]).size}}},go=[];I&&go.push({transport:"fetch",method:e=>{var t,i,{contentType:r,body:n,estimatedSize:s}=null!==(t=po(e))&&void 0!==t?t:{},o=new Headers;ce(e.headers,(function(e,t){o.append(t,e)})),r&&o.append("Content-Type",r);var a=e.url,l=null;if(R){var c=new R;l={signal:c.signal,timeout:setTimeout((()=>c.abort()),e.timeout)}}I(a,se({method:(null==e?void 0:e.method)||"GET",headers:o,keepalive:"POST"===e.method&&(s||0)<52428.8,body:n,signal:null==(i=l)?void 0:i.signal},e.fetchOptions)).then((t=>t.text().then((i=>{var r={statusCode:t.status,text:i};if(200===t.status)try{r.json=JSON.parse(i)}catch(e){te.error(e)}null==e.callback||e.callback(r)})))).catch((t=>{te.error(t),null==e.callback||e.callback({statusCode:0,text:t})})).finally((()=>l?clearTimeout(l.timeout):null))}}),F&&go.push({transport:"XHR",method:e=>{var t,i=new F;i.open(e.method||"GET",e.url,!0);var{contentType:r,body:n}=null!==(t=po(e))&&void 0!==t?t:{};ce(e.headers,(function(e,t){i.setRequestHeader(t,e)})),r&&i.setRequestHeader("Content-Type",r),e.timeout&&(i.timeout=e.timeout),i.withCredentials=!0,i.onreadystatechange=()=>{if(4===i.readyState){var t={statusCode:i.status,text:i.responseText};if(200===i.status)try{t.json=JSON.parse(i.responseText)}catch(e){}null==e.callback||e.callback(t)}},i.send(n)}}),null!=k&&k.sendBeacon&&go.push({transport:"sendBeacon",method:e=>{var t=uo(e.url,{beacon:"1"});try{var i,{contentType:r,body:n}=null!==(i=po(e))&&void 0!==i?i:{},s="string"==typeof n?new Blob([n],{type:r}):n;k.sendBeacon(t,s)}catch(e){}}});var vo=3e3;class fo{constructor(e,t){this.lr=!0,this.hr=[],this.ur=rr((null==t?void 0:t.flush_interval_ms)||vo,250,5e3,"flush interval",vo),this.dr=e}enqueue(e){this.hr.push(e),this.vr||this.cr()}unload(){this.pr();var e=this.hr.length>0?this.gr():{},t=Object.values(e);[...t.filter((e=>0===e.url.indexOf("/e"))),...t.filter((e=>0!==e.url.indexOf("/e")))].map((e=>{this.dr(se({},e,{transport:"sendBeacon"}))}))}enable(){this.lr=!1,this.cr()}cr(){var e=this;this.lr||(this.vr=setTimeout((()=>{if(this.pr(),this.hr.length>0){var t=this.gr(),i=function(i){var r=t[i],n=(new Date).getTime();r.data&&j(r.data)&&ce(r.data,(e=>{e.offset=Math.abs(e.timestamp-n),delete e.timestamp})),e.dr(r)};for(var r in t)i(r)}}),this.ur))}pr(){clearTimeout(this.vr),this.vr=void 0}gr(){var e={};return ce(this.hr,(t=>{var i,r=t,n=(r?r.batchKey:null)||r.url;K(e[n])&&(e[n]=se({},r,{data:[]})),null==(i=e[n].data)||i.push(r.data)})),this.hr=[],e}}var _o=["retriesPerformedSoFar"];class mo{constructor(e){this._r=!1,this.mr=3e3,this.hr=[],this._instance=e,this.hr=[],this.br=!0,!K(m)&&"onLine"in m.navigator&&(this.br=m.navigator.onLine,ye(m,"online",(()=>{this.br=!0,this.Yi()})),ye(m,"offline",(()=>{this.br=!1})))}get length(){return this.hr.length}retriableRequest(e){var{retriesPerformedSoFar:t}=e,i=oe(e,_o);X(t)&&t>0&&(i.url=uo(i.url,{retry_count:t})),this._instance.ge(se({},i,{callback:e=>{200!==e.statusCode&&(e.statusCode<400||e.statusCode>=500)&&(null!=t?t:0)<10?this.wr(se({retriesPerformedSoFar:t},i)):null==i.callback||i.callback(e)}}))}wr(e){var t=e.retriesPerformedSoFar||0;e.retriesPerformedSoFar=t+1;var i=function(e){var t=3e3*Math.pow(2,e),i=t/2,r=Math.min(18e5,t),n=(Math.random()-.5)*(r-i);return Math.ceil(r+n)}(t),r=Date.now()+i;this.hr.push({retryAt:r,requestOptions:e});var n="Enqueued failed request for retry in "+i;navigator.onLine||(n+=" (Browser is offline)"),te.warn(n),this._r||(this._r=!0,this.yr())}yr(){this.Sr&&clearTimeout(this.Sr),this.Sr=setTimeout((()=>{this.br&&this.hr.length>0&&this.Yi(),this.yr()}),this.mr)}Yi(){var e=Date.now(),t=[],i=this.hr.filter((i=>i.retryAt<e||(t.push(i),!1)));if(this.hr=t,i.length>0)for(var{requestOptions:r}of i)this.retriableRequest(r)}unload(){for(var{requestOptions:e}of(this.Sr&&(clearTimeout(this.Sr),this.Sr=void 0),this.hr))try{this._instance.ge(se({},e,{transport:"sendBeacon"}))}catch(e){te.error(e)}this.hr=[]}}class yo{constructor(e){this.$r=()=>{var e,t,i,r;this.kr||(this.kr={});var n=this.scrollElement(),s=this.scrollY(),o=n?Math.max(0,n.scrollHeight-n.clientHeight):0,a=s+((null==n?void 0:n.clientHeight)||0),l=(null==n?void 0:n.scrollHeight)||0;this.kr.lastScrollY=Math.ceil(s),this.kr.maxScrollY=Math.max(s,null!==(e=this.kr.maxScrollY)&&void 0!==e?e:0),this.kr.maxScrollHeight=Math.max(o,null!==(t=this.kr.maxScrollHeight)&&void 0!==t?t:0),this.kr.lastContentY=a,this.kr.maxContentY=Math.max(a,null!==(i=this.kr.maxContentY)&&void 0!==i?i:0),this.kr.maxContentHeight=Math.max(l,null!==(r=this.kr.maxContentHeight)&&void 0!==r?r:0)},this._instance=e}getContext(){return this.kr}resetContext(){var e=this.kr;return setTimeout(this.$r,0),e}startMeasuringScrollPosition(){ye(m,"scroll",this.$r,{capture:!0}),ye(m,"scrollend",this.$r,{capture:!0}),ye(m,"resize",this.$r)}scrollElement(){if(!this._instance.config.scroll_root_selector)return null==m?void 0:m.document.documentElement;var e=j(this._instance.config.scroll_root_selector)?this._instance.config.scroll_root_selector:[this._instance.config.scroll_root_selector];for(var t of e){var i=null==m?void 0:m.document.querySelector(t);if(i)return i}}scrollY(){if(this._instance.config.scroll_root_selector){var e=this.scrollElement();return e&&e.scrollTop||0}return m&&(m.scrollY||m.pageYOffset||m.document.documentElement.scrollTop)||0}scrollX(){if(this._instance.config.scroll_root_selector){var e=this.scrollElement();return e&&e.scrollLeft||0}return m&&(m.scrollX||m.pageXOffset||m.document.documentElement.scrollLeft)||0}}var bo=e=>Ts(null==e?void 0:e.config.mask_personal_data_properties,null==e?void 0:e.config.custom_personal_data_properties);class wo{constructor(e,t,i,r){this.Er=e=>{var t=this.Ir();if(!t||t.sessionId!==e){var i={sessionId:e,props:this.Pr(this._instance)};this.Rr.register({[Je]:i})}},this._instance=e,this.Tr=t,this.Rr=i,this.Pr=r||bo,this.Tr.onSessionId(this.Er)}Ir(){return this.Rr.props[Je]}getSetOnceProps(){var e,t=null==(e=this.Ir())?void 0:e.props;return t?"r"in t?Ls(t):{$referring_domain:t.referringDomain,$pathname:t.initialPathName,utm_source:t.utm_source,utm_campaign:t.utm_campaign,utm_medium:t.utm_medium,utm_content:t.utm_content,utm_term:t.utm_term}:{}}getSessionProps(){var e={};return ce(ve(this.getSetOnceProps()),((t,i)=>{"$current_url"===i&&(i="url"),e["$session_entry_"+L(i)]=t})),e}}var Eo=ie("[SessionId]");class ko{constructor(e,t,i){var r;if(this.Mr=[],!e.persistence)throw new Error("SessionIdManager requires a PostHogPersistence instance");if(e.config.__preview_experimental_cookieless_mode)throw new Error("SessionIdManager cannot be used with __preview_experimental_cookieless_mode");this.S=e.config,this.Rr=e.persistence,this.oi=void 0,this.kt=void 0,this._sessionStartTimestamp=null,this._sessionActivityTimestamp=null,this.Cr=t||Yt,this.Or=i||Yt;var n=this.S.persistence_name||this.S.token,s=this.S.session_idle_timeout_seconds||1800;if(this._sessionTimeoutMs=1e3*rr(s,60,36e3,"session_idle_timeout_seconds",1800),e.register({$configured_session_timeout_ms:this._sessionTimeoutMs}),this.Fr(),this.Ar="ph_"+n+"_window_id",this.Dr="ph_"+n+"_primary_window_exists",this.jr()){var o=li.D(this.Ar),a=li.D(this.Dr);o&&!a?this.oi=o:li.L(this.Ar),li.j(this.Dr,!0)}if(null!=(r=this.S.bootstrap)&&r.sessionID)try{var l=(()=>{var e=this.S.bootstrap.sessionID.replace(/-/g,"");if(32!==e.length)throw new Error("Not a valid UUID");if("7"!==e[12])throw new Error("Not a UUIDv7");return parseInt(e.substring(0,12),16)})();this.Lr(this.S.bootstrap.sessionID,(new Date).getTime(),l)}catch(e){Eo.error("Invalid sessionID in bootstrap",e)}this.Nr()}get sessionTimeoutMs(){return this._sessionTimeoutMs}onSessionId(e){return K(this.Mr)&&(this.Mr=[]),this.Mr.push(e),this.kt&&e(this.kt,this.oi),()=>{this.Mr=this.Mr.filter((t=>t!==e))}}jr(){return"memory"!==this.S.persistence&&!this.Rr.$e&&li.O()}zr(e){e!==this.oi&&(this.oi=e,this.jr()&&li.j(this.Ar,e))}Ur(){return this.oi?this.oi:this.jr()?li.D(this.Ar):null}Lr(e,t,i){e===this.kt&&t===this._sessionActivityTimestamp&&i===this._sessionStartTimestamp||(this._sessionStartTimestamp=i,this._sessionActivityTimestamp=t,this.kt=e,this.Rr.register({[Le]:[t,e,i]}))}qr(){if(this.kt&&this._sessionActivityTimestamp&&this._sessionStartTimestamp)return[this._sessionActivityTimestamp,this.kt,this._sessionStartTimestamp];var e=this.Rr.props[Le];return j(e)&&2===e.length&&e.push(e[0]),e||[0,null,0]}resetSessionId(){this.Lr(null,null,null)}Nr(){ye(m,"beforeunload",(()=>{this.jr()&&li.L(this.Dr)}),{capture:!1})}checkAndGetSessionAndWindowId(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=null),this.S.__preview_experimental_cookieless_mode)throw new Error("checkAndGetSessionAndWindowId should not be called in __preview_experimental_cookieless_mode");var i=t||(new Date).getTime(),[r,n,s]=this.qr(),o=this.Ur(),a=X(s)&&s>0&&Math.abs(i-s)>864e5,l=!1,c=!n,u=!e&&Math.abs(i-r)>this.sessionTimeoutMs;c||u||a?(n=this.Cr(),o=this.Or(),Eo.info("new session ID generated",{sessionId:n,windowId:o,changeReason:{noSessionId:c,activityTimeout:u,sessionPastMaximumLength:a}}),s=i,l=!0):o||(o=this.Or(),l=!0);var h=0===r||!e||a?i:r,d=0===s?(new Date).getTime():s;return this.zr(o),this.Lr(n,h,d),e||this.Fr(),l&&this.Mr.forEach((e=>e(n,o,l?{noSessionId:c,activityTimeout:u,sessionPastMaximumLength:a}:void 0))),{sessionId:n,windowId:o,sessionStartTimestamp:d,changeReason:l?{noSessionId:c,activityTimeout:u,sessionPastMaximumLength:a}:void 0,lastActivityTimestamp:r}}Fr(){clearTimeout(this.Br),this.Br=setTimeout((()=>{this.resetSessionId()}),1.1*this.sessionTimeoutMs)}}var xo=["$set_once","$set"],So=ie("[SiteApps]");class Io{constructor(e){this._instance=e,this.Hr=[],this.apps={}}get isEnabled(){return!!this._instance.config.opt_in_site_apps}Wr(e,t){if(t){var i=this.globalsForEvent(t);this.Hr.push(i),this.Hr.length>1e3&&(this.Hr=this.Hr.slice(10))}}get siteAppLoaders(){var e,t;return null==(e=$._POSTHOG_REMOTE_CONFIG)||null==(t=e[this._instance.config.token])?void 0:t.siteApps}init(){if(this.isEnabled){var e=this._instance.De(this.Wr.bind(this));this.Gr=()=>{e(),this.Hr=[],this.Gr=void 0}}}globalsForEvent(e){var t,i,r,n,s,o,a;if(!e)throw new Error("Event payload is required");var l={},c=this._instance.get_property("$groups")||[],u=this._instance.get_property("$stored_group_properties")||{};for(var[h,d]of Object.entries(u))l[h]={id:c[h],type:h,properties:d};var{$set_once:p,$set:g}=e;return{event:se({},oe(e,xo),{properties:se({},e.properties,g?{$set:se({},null!==(t=null==(i=e.properties)?void 0:i.$set)&&void 0!==t?t:{},g)}:{},p?{$set_once:se({},null!==(r=null==(n=e.properties)?void 0:n.$set_once)&&void 0!==r?r:{},p)}:{}),elements_chain:null!==(s=null==(o=e.properties)?void 0:o.$elements_chain)&&void 0!==s?s:"",distinct_id:null==(a=e.properties)?void 0:a.distinct_id}),person:{properties:this._instance.get_property("$stored_person_properties")},groups:l}}setupSiteApp(e){var t=this.apps[e.id],i=()=>{var i;!t.errored&&this.Hr.length&&(So.info("Processing "+this.Hr.length+" events for site app with id "+e.id),this.Hr.forEach((e=>null==t.processEvent?void 0:t.processEvent(e))),t.processedBuffer=!0),Object.values(this.apps).every((e=>e.processedBuffer||e.errored))&&(null==(i=this.Gr)||i.call(this))},r=!1,n=n=>{t.errored=!n,t.loaded=!0,So.info("Site app with id "+e.id+" "+(n?"loaded":"errored")),r&&i()};try{var{processEvent:s}=e.init({posthog:this._instance,callback:e=>{n(e)}});s&&(t.processEvent=s),r=!0}catch(t){So.error("Error while initializing PostHog app with config id "+e.id,t),n(!1)}if(r&&t.loaded)try{i()}catch(i){So.error("Error while processing buffered events PostHog app with config id "+e.id,i),t.errored=!0}}Jr(){var e=this.siteAppLoaders||[];for(var t of e)this.apps[t.id]={id:t.id,loaded:!1,errored:!1,processedBuffer:!1};for(var i of e)this.setupSiteApp(i)}Vr(e){if(0!==Object.keys(this.apps).length){var t=this.globalsForEvent(e);for(var i of Object.values(this.apps))try{null==i.processEvent||i.processEvent(t)}catch(t){So.error("Error while processing event "+e.event+" for site app "+i.id,t)}}}onRemoteConfig(e){var t,i,r,n=this;if(null!=(t=this.siteAppLoaders)&&t.length)return this.isEnabled?(this.Jr(),void this._instance.on("eventCaptured",(e=>this.Vr(e)))):void So.error('PostHog site apps are disabled. Enable the "opt_in_site_apps" config to proceed.');if(null==(i=this.Gr)||i.call(this),null!=(r=e.siteApps)&&r.length)if(this.isEnabled){var s=function(e,t){var i;$["__$$ph_site_app_"+e]=n._instance,null==(i=$.__PosthogExtensions__)||null==i.loadSiteApp||i.loadSiteApp(n._instance,t,(t=>{if(t)return So.error("Error while initializing PostHog app with config id "+e,t)}))};for(var{id:o,url:a}of e.siteApps)s(o,a)}else So.error('PostHog site apps are disabled. Enable the "opt_in_site_apps" config to proceed.')}}var Fo,Ro=["amazonbot","amazonproductbot","app.hypefactors.com","applebot","archive.org_bot","awariobot","backlinksextendedbot","baiduspider","bingbot","bingpreview","chrome-lighthouse","dataforseobot","deepscan","duckduckbot","facebookexternal","facebookcatalog","http://yandex.com/bots","hubspot","ia_archiver","linkedinbot","meta-externalagent","mj12bot","msnbot","nessus","petalbot","pinterest","prerender","rogerbot","screaming frog","sebot-wa","sitebulb","slackbot","slurp","trendictionbot","turnitin","twitterbot","vercelbot","yahoo! slurp","yandexbot","zoombot","bot.htm","bot.php","(bot;","bot/","crawler","ahrefsbot","ahrefssiteaudit","semrushbot","siteauditbot","splitsignalbot","gptbot","oai-searchbot","chatgpt-user","perplexitybot","better uptime bot","sentryuptimebot","uptimerobot","headlesschrome","cypress","google-hoteladsverifier","adsbot-google","apis-google","duplexweb-google","feedfetcher-google","google favicon","google web preview","google-read-aloud","googlebot","googleweblight","mediapartners-google","storebot-google","bytespider"],Oo=function(e,t){if(!e)return!1;var i=e.toLowerCase();return Ro.concat(t||[]).some((e=>{var t=e.toLowerCase();return-1!==i.indexOf(t)}))},$o=function(e,t){if(!e)return!1;var i=e.userAgent;if(i&&Oo(i,t))return!0;try{var r=null==e?void 0:e.userAgentData;if(null!=r&&r.brands&&r.brands.some((e=>Oo(null==e?void 0:e.brand,t))))return!0}catch(e){}return!!e.webdriver};function Co(e,t,i){return ho({distinct_id:e,userPropertiesToSet:t,userPropertiesToSetOnce:i})}!function(e){e.US="us",e.EU="eu",e.CUSTOM="custom"}(Fo||(Fo={}));var Po="i.posthog.com";class Mo{constructor(e){this.Kr={},this.instance=e}get apiHost(){var e=this.instance.config.api_host.trim().replace(/\/$/,"");return"https://app.posthog.com"===e?"https://us.i.posthog.com":e}get uiHost(){var e,t=null==(e=this.instance.config.ui_host)?void 0:e.replace(/\/$/,"");return t||(t=this.apiHost.replace("."+Po,".posthog.com")),"https://app.posthog.com"===t?"https://us.posthog.com":t}get region(){return this.Kr[this.apiHost]||(/https:\/\/(app|us|us-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this.Kr[this.apiHost]=Fo.US:/https:\/\/(eu|eu-assets)(\.i)?\.posthog\.com/i.test(this.apiHost)?this.Kr[this.apiHost]=Fo.EU:this.Kr[this.apiHost]=Fo.CUSTOM),this.Kr[this.apiHost]}endpointFor(e,t){if(void 0===t&&(t=""),t&&(t="/"===t[0]?t:"/"+t),"ui"===e)return this.uiHost+t;if(this.region===Fo.CUSTOM)return this.apiHost+t;var i=Po+t;switch(e){case"assets":return"https://"+this.region+"-assets."+i;case"api":return"https://"+this.region+"."+i}}}var Ao={icontains:(e,t)=>!!m&&t.href.toLowerCase().indexOf(e.toLowerCase())>-1,not_icontains:(e,t)=>!!m&&-1===t.href.toLowerCase().indexOf(e.toLowerCase()),regex:(e,t)=>!!m&&Qs(t.href,e),not_regex:(e,t)=>!!m&&!Qs(t.href,e),exact:(e,t)=>t.href===e,is_not:(e,t)=>t.href!==e};class Do{constructor(e){var t=this;this.getWebExperimentsAndEvaluateDisplayLogic=function(e){void 0===e&&(e=!1),t.getWebExperiments((e=>{Do.Yr("retrieved web experiments from the server"),t.Xr=new Map,e.forEach((e=>{if(e.feature_flag_key){var i;t.Xr&&(Do.Yr("setting flag key ",e.feature_flag_key," to web experiment ",e),null==(i=t.Xr)||i.set(e.feature_flag_key,e));var r=t._instance.getFeatureFlag(e.feature_flag_key);z(r)&&e.variants[r]&&t.Qr(e.name,r,e.variants[r].transforms)}else if(e.variants)for(var n in e.variants){var s=e.variants[n];Do.Zr(s)&&t.Qr(e.name,n,s.transforms)}}))}),e)},this._instance=e,this._instance.onFeatureFlags((e=>{this.onFeatureFlags(e)}))}onFeatureFlags(e){if(this._is_bot())Do.Yr("Refusing to render web experiment since the viewer is a likely bot");else if(!this._instance.config.disable_web_experiments){if(J(this.Xr))return this.Xr=new Map,this.loadIfEnabled(),void this.previewWebExperiment();Do.Yr("applying feature flags",e),e.forEach((e=>{var t;if(this.Xr&&null!=(t=this.Xr)&&t.has(e)){var i,r=this._instance.getFeatureFlag(e),n=null==(i=this.Xr)?void 0:i.get(e);r&&null!=n&&n.variants[r]&&this.Qr(n.name,r,n.variants[r].transforms)}}))}}previewWebExperiment(){var e=Do.getWindowLocation();if(null!=e&&e.search){var t=Dt(null==e?void 0:e.search,"__experiment_id"),i=Dt(null==e?void 0:e.search,"__experiment_variant");t&&i&&(Do.Yr("previewing web experiments "+t+" && "+i),this.getWebExperiments((e=>{this.ts(parseInt(t),i,e)}),!1,!0))}}loadIfEnabled(){this._instance.config.disable_web_experiments||this.getWebExperimentsAndEvaluateDisplayLogic()}getWebExperiments(e,t,i){if(this._instance.config.disable_web_experiments&&!i)return e([]);var r=this._instance.get_property("$web_experiments");if(r&&!t)return e(r);this._instance.ge({url:this._instance.requestRouter.endpointFor("api","/api/web_experiments/?token="+this._instance.config.token),method:"GET",callback:t=>{if(200!==t.statusCode||!t.json)return e([]);var i=t.json.experiments||[];return e(i)}})}ts(e,t,i){var r=i.filter((t=>t.id===e));r&&r.length>0&&(Do.Yr("Previewing web experiment ["+r[0].name+"] with variant ["+t+"]"),this.Qr(r[0].name,t,r[0].variants[t].transforms))}static Zr(e){return!J(e.conditions)&&Do.es(e)&&Do.rs(e)}static es(e){var t;if(J(e.conditions)||J(null==(t=e.conditions)?void 0:t.url))return!0;var i,r,n,s=Do.getWindowLocation();return!!s&&(null==(i=e.conditions)||!i.url||Ao[null!==(r=null==(n=e.conditions)?void 0:n.urlMatchType)&&void 0!==r?r:"icontains"](e.conditions.url,s))}static getWindowLocation(){return null==m?void 0:m.location}static rs(e){var t;if(J(e.conditions)||J(null==(t=e.conditions)?void 0:t.utm))return!0;var i=Cs();if(i.utm_source){var r,n,s,o,a,l,c,u,h,d,p,g,v,f,_,m,y=null==(r=e.conditions)||null==(n=r.utm)||!n.utm_campaign||(null==(s=e.conditions)||null==(o=s.utm)?void 0:o.utm_campaign)==i.utm_campaign,b=null==(a=e.conditions)||null==(l=a.utm)||!l.utm_source||(null==(c=e.conditions)||null==(u=c.utm)?void 0:u.utm_source)==i.utm_source,w=null==(h=e.conditions)||null==(d=h.utm)||!d.utm_medium||(null==(p=e.conditions)||null==(g=p.utm)?void 0:g.utm_medium)==i.utm_medium,E=null==(v=e.conditions)||null==(f=v.utm)||!f.utm_term||(null==(_=e.conditions)||null==(m=_.utm)?void 0:m.utm_term)==i.utm_term;return y&&w&&E&&b}return!1}static Yr(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];te.info("[WebExperiments] "+e,i)}Qr(e,t,i){this._is_bot()?Do.Yr("Refusing to render web experiment since the viewer is a likely bot"):"control"!==t?i.forEach((i=>{if(i.selector){var r;Do.Yr("applying transform of variant "+t+" for experiment "+e+" ",i);var n=null==(r=document)?void 0:r.querySelectorAll(i.selector);null==n||n.forEach((e=>{var t=e;i.html&&(t.innerHTML=i.html),i.css&&t.setAttribute("style",i.css)}))}})):Do.Yr("Control variants leave the page unmodified.")}_is_bot(){return k&&this._instance?$o(k,this._instance.config.custom_blocked_useragents):void 0}}var To,Lo,No,Bo,Uo,qo,jo={},Go=()=>{},Ho="posthog",Wo=!lo&&-1===(null==O?void 0:O.indexOf("MSIE"))&&-1===(null==O?void 0:O.indexOf("Mozilla")),Ko=()=>{var e;return{api_host:"https://us.i.posthog.com",ui_host:null,token:"",autocapture:!0,rageclick:!0,cross_subdomain_cookie:_e(null==x?void 0:x.location),persistence:"localStorage+cookie",persistence_name:"",loaded:Go,save_campaign_params:!0,custom_campaign_params:[],custom_blocked_useragents:[],save_referrer:!0,capture_pageview:!0,capture_pageleave:"if_capture_pageview",debug:S&&z(null==S?void 0:S.search)&&-1!==S.search.indexOf("__posthog_debug=true")||!1,cookie_expiration:365,upgrade:!1,disable_session_recording:!1,disable_persistence:!1,disable_web_experiments:!0,disable_surveys:!1,disable_external_dependency_loading:!1,enable_recording_console_log:void 0,secure_cookie:"https:"===(null==m||null==(e=m.location)?void 0:e.protocol),ip:!0,opt_out_capturing_by_default:!1,opt_out_persistence_by_default:!1,opt_out_useragent_filter:!1,opt_out_capturing_persistence_type:"localStorage",opt_out_capturing_cookie_prefix:null,opt_in_site_apps:!1,property_denylist:[],respect_dnt:!1,sanitize_properties:null,request_headers:{},request_batching:!0,properties_string_max_length:65535,session_recording:{},mask_all_element_attributes:!1,mask_all_text:!1,mask_personal_data_properties:!1,custom_personal_data_properties:[],advanced_disable_decide:!1,advanced_disable_feature_flags:!1,advanced_disable_feature_flags_on_first_load:!1,advanced_disable_toolbar_metrics:!1,feature_flag_request_timeout_ms:3e3,surveys_request_timeout_ms:1e4,on_request_error:e=>{var t="Bad HTTP status: "+e.statusCode+" "+e.text;te.error(t)},get_device_id:e=>e,capture_performance:void 0,name:"posthog",bootstrap:{},disable_compression:!1,session_idle_timeout_seconds:1800,person_profiles:"identified_only",before_send:void 0,request_queue_config:{flush_interval_ms:vo},_onCapture:Go}},zo=e=>{var t={};K(e.process_person)||(t.person_profiles=e.process_person),K(e.xhr_headers)||(t.request_headers=e.xhr_headers),K(e.cookie_name)||(t.persistence_name=e.cookie_name),K(e.disable_cookie)||(t.disable_persistence=e.disable_cookie),K(e.store_google)||(t.save_campaign_params=e.store_google),K(e.verbose)||(t.debug=e.verbose);var i=ue({},t,e);return j(e.property_blacklist)&&(K(e.property_denylist)?i.property_denylist=e.property_blacklist:j(e.property_denylist)?i.property_denylist=[...e.property_blacklist,...e.property_denylist]:te.error("Invalid value for property_denylist config: "+e.property_denylist)),i};class Vo{constructor(){this.__forceAllowLocalhost=!1}get ss(){return this.__forceAllowLocalhost}set ss(e){te.error("WebPerformanceObserver is deprecated and has no impact on network capture. Use `_forceAllowLocalhostNetworkCapture` on `posthog.sessionRecording`"),this.__forceAllowLocalhost=e}}class Yo{get decideEndpointWasHit(){var e,t;return null!==(e=null==(t=this.featureFlags)?void 0:t.hasLoadedFlags)&&void 0!==e&&e}constructor(){this.webPerformance=new Vo,this.ns=!1,this.version=C.LIB_VERSION,this.os=new Zs,this._calculate_event_properties=this.calculateEventProperties.bind(this),this.config=Ko(),this.SentryIntegration=fn,this.sentryIntegration=e=>function(e,t){var i=vn(e,t);return{name:gn,processEvent:e=>i(e)}}(this,e),this.__request_queue=[],this.__loaded=!1,this.analyticsDefaultEndpoint="/e/",this.ls=!1,this.hs=null,this.us=null,this.ds=null,this.featureFlags=new Ys(this),this.toolbar=new wn(this),this.scrollManager=new yo(this),this.pageViewManager=new $n(this),this.surveys=new ro(this),this.experiments=new Do(this),this.exceptions=new Cn(this),this.rateLimiter=new so(this),this.requestRouter=new Mo(this),this.consent=new ci(this),this.people={set:(e,t,i)=>{var r=z(e)?{[e]:t}:e;this.setPersonProperties(r),null==i||i({})},set_once:(e,t,i)=>{var r=z(e)?{[e]:t}:e;this.setPersonProperties(void 0,r),null==i||i({})}},this.on("eventCaptured",(e=>te.info('send "'+(null==e?void 0:e.event)+'"',e)))}init(e,t,i){if(i&&i!==Ho){var r,n=null!==(r=jo[i])&&void 0!==r?r:new Yo;return n._init(e,t,i),jo[i]=n,jo[Ho][i]=n,n}return this._init(e,t,i)}_init(e,t,i){var r,n;if(void 0===t&&(t={}),K(e)||V(e))return te.critical("PostHog was initialized without a token. This likely indicates a misconfiguration. Please check the first argument passed to posthog.init()"),this;if(this.__loaded)return te.warn("You have already initialized PostHog! Re-initializing is a no-op"),this;this.__loaded=!0,this.config={},this.vs=[],t.person_profiles&&(this.us=t.person_profiles),this.set_config(ue({},Ko(),zo(t),{name:i,token:e})),this.config.on_xhr_error&&te.error("on_xhr_error is deprecated. Use on_request_error instead"),this.compression=t.disable_compression?void 0:_.GZipJS,this.persistence=new Xs(this.config),this.sessionPersistence="sessionStorage"===this.config.persistence||"memory"===this.config.persistence?this.persistence:new Xs(se({},this.config,{persistence:"sessionStorage"}));var s=se({},this.persistence.props),o=se({},this.sessionPersistence.props);if(this.cs=new fo((e=>this.fs(e)),this.config.request_queue_config),this.ps=new mo(this),this.__request_queue=[],this.config.__preview_experimental_cookieless_mode||(this.sessionManager=new ko(this),this.sessionPropsManager=new wo(this,this.sessionManager,this.persistence)),new kn(this).startIfEnabledOrStop(),this.siteApps=new Io(this),null==(r=this.siteApps)||r.init(),this.config.__preview_experimental_cookieless_mode||(this.sessionRecording=new dn(this),this.sessionRecording.startIfEnabledOrStop()),this.config.disable_scroll_properties||this.scrollManager.startMeasuringScrollPosition(),this.autocapture=new jt(this),this.autocapture.startIfEnabled(),this.surveys.loadIfEnabled(),this.heatmaps=new On(this),this.heatmaps.startIfEnabled(),this.webVitalsAutocapture=new In(this),this.exceptionObserver=new vi(this),this.exceptionObserver.startIfEnabled(),this.deadClicksAutocapture=new pi(this,di),this.deadClicksAutocapture.startIfEnabled(),this.historyAutocapture=new Hi(this),this.historyAutocapture.startIfEnabled(),C.DEBUG=C.DEBUG||this.config.debug,C.DEBUG&&te.info("Starting in debug mode",{this:this,config:t,thisC:se({},this.config),p:s,s:o}),this.gs(),void 0!==(null==(n=t.bootstrap)?void 0:n.distinctID)){var a,l,c=this.config.get_device_id(Yt()),u=null!=(a=t.bootstrap)&&a.isIdentifiedID?c:t.bootstrap.distinctID;this.persistence.set_property(Ye,null!=(l=t.bootstrap)&&l.isIdentifiedID?"identified":"anonymous"),this.register({distinct_id:t.bootstrap.distinctID,$device_id:u})}if(this._s()){var h,d,p=Object.keys((null==(h=t.bootstrap)?void 0:h.featureFlags)||{}).filter((e=>{var i,r;return!(null==(i=t.bootstrap)||null==(r=i.featureFlags)||!r[e])})).reduce(((e,i)=>{var r,n;return e[i]=(null==(r=t.bootstrap)||null==(n=r.featureFlags)?void 0:n[i])||!1,e}),{}),g=Object.keys((null==(d=t.bootstrap)?void 0:d.featureFlagPayloads)||{}).filter((e=>p[e])).reduce(((e,i)=>{var r,n,s,o;return null!=(r=t.bootstrap)&&null!=(n=r.featureFlagPayloads)&&n[i]&&(e[i]=null==(s=t.bootstrap)||null==(o=s.featureFlagPayloads)?void 0:o[i]),e}),{});this.featureFlags.receivedFeatureFlags({featureFlags:p,featureFlagPayloads:g})}if(this.config.__preview_experimental_cookieless_mode)this.register_once({distinct_id:rt,$device_id:null},"");else if(!this.get_distinct_id()){var v=this.config.get_device_id(Yt());this.register_once({distinct_id:v,$device_id:v},""),this.persistence.set_property(Ye,"anonymous")}return ye(m,"onpagehide"in self?"pagehide":"unload",this._handle_unload.bind(this),{passive:!1}),this.toolbar.maybeLoadToolbar(),t.segment?function(e,t){var i=e.config.segment;if(!i)return t();!function(e,t){var i=e.config.segment;if(!i)return t();var r=i=>{var r=()=>i.anonymousId()||Yt();e.config.get_device_id=r,i.id()&&(e.register({distinct_id:i.id(),$device_id:r()}),e.persistence.set_property(Ye,"identified")),t()},n=i.user();"then"in n&&G(n.then)?n.then((e=>r(e))):r(n)}(e,(()=>{i.register((e=>{Promise&&Promise.resolve||pn.warn("This browser does not have Promise support, and can not use the segment integration");var t=(t,i)=>{if(!i)return t;t.event.userId||t.event.anonymousId===e.get_distinct_id()||(pn.info("No userId set, resetting PostHog"),e.reset()),t.event.userId&&t.event.userId!==e.get_distinct_id()&&(pn.info("UserId set, identifying with PostHog"),e.identify(t.event.userId));var r=e.calculateEventProperties(i,t.event.properties);return t.event.properties=Object.assign({},r,t.event.properties),t};return{name:"PostHog JS",type:"enrichment",version:"1.0.0",isLoaded:()=>!0,load:()=>Promise.resolve(),track:e=>t(e,e.event.event),page:e=>t(e,"$pageview"),identify:e=>t(e,"$identify"),screen:e=>t(e,"$screen")}})(e)).then((()=>{t()}))}))}(this,(()=>this.bs())):this.bs(),G(this.config._onCapture)&&this.config._onCapture!==Go&&(te.warn("onCapture is deprecated. Please use `before_send` instead"),this.on("eventCaptured",(e=>this.config._onCapture(e.event,e)))),this}_e(e){var t,i,r,n,s,o,a,l;if(!x||!x.body)return te.info("document not ready yet, trying again in 500 milliseconds..."),void setTimeout((()=>{this._e(e)}),500);this.compression=void 0,e.supportedCompression&&!this.config.disable_compression&&(this.compression=D(e.supportedCompression,_.GZipJS)?_.GZipJS:D(e.supportedCompression,_.Base64)?_.Base64:void 0),null!=(t=e.analytics)&&t.endpoint&&(this.analyticsDefaultEndpoint=e.analytics.endpoint),this.set_config({person_profiles:this.us?this.us:"identified_only"}),null==(i=this.siteApps)||i.onRemoteConfig(e),null==(r=this.sessionRecording)||r.onRemoteConfig(e),null==(n=this.autocapture)||n.onRemoteConfig(e),null==(s=this.heatmaps)||s.onRemoteConfig(e),this.surveys.onRemoteConfig(e),null==(o=this.webVitalsAutocapture)||o.onRemoteConfig(e),null==(a=this.exceptionObserver)||a.onRemoteConfig(e),null==(l=this.deadClicksAutocapture)||l.onRemoteConfig(e)}bs(){try{this.config.loaded(this)}catch(e){te.critical("`loaded` function failed",e)}this.ws(),this.config.capture_pageview&&setTimeout((()=>{this.consent.isOptedIn()&&this.ys()}),1),new ao(this).load(),this.featureFlags.decide()}ws(){var e;this.has_opted_out_capturing()||this.config.request_batching&&(null==(e=this.cs)||e.enable())}_dom_loaded(){this.has_opted_out_capturing()||le(this.__request_queue,(e=>this.fs(e))),this.__request_queue=[],this.ws()}_handle_unload(){var e,t;this.config.request_batching?(this.Ss()&&this.capture("$pageleave"),null==(e=this.cs)||e.unload(),null==(t=this.ps)||t.unload()):this.Ss()&&this.capture("$pageleave",null,{transport:"sendBeacon"})}ge(e){this.__loaded&&(Wo?this.__request_queue.push(e):this.rateLimiter.isServerRateLimited(e.batchKey)||(e.transport=e.transport||this.config.api_transport,e.url=uo(e.url,{ip:this.config.ip?1:0}),e.headers=se({},this.config.request_headers),e.compression="best-available"===e.compression?this.compression:e.compression,e.fetchOptions=e.fetchOptions||this.config.fetch_options,(e=>{var t,i,r,n=se({},e);n.timeout=n.timeout||6e4,n.url=uo(n.url,{_:(new Date).getTime().toString(),ver:C.LIB_VERSION,compression:n.compression});var s=null!==(t=n.transport)&&void 0!==t?t:"fetch",o=null!==(i=null==(r=me(go,(e=>e.transport===s)))?void 0:r.method)&&void 0!==i?i:go[0].method;if(!o)throw new Error("No available transport method");o(n)})(se({},e,{callback:t=>{var i,r;this.rateLimiter.checkForLimiting(t),t.statusCode>=400&&(null==(i=(r=this.config).on_request_error)||i.call(r,t)),null==e.callback||e.callback(t)}}))))}fs(e){this.ps?this.ps.retriableRequest(e):this.ge(e)}_execute_array(e){var t,i=[],r=[],n=[];le(e,(e=>{e&&(t=e[0],j(t)?n.push(e):G(e)?e.call(this):j(e)&&"alias"===t?i.push(e):j(e)&&-1!==t.indexOf("capture")&&G(this[t])?n.push(e):r.push(e))}));var s=function(e,t){le(e,(function(e){if(j(e[0])){var i=t;ce(e,(function(e){i=i[e[0]].apply(i,e.slice(1))}))}else this[e[0]].apply(this,e.slice(1))}),t)};s(i,this),s(r,this),s(n,this)}_s(){var e,t;return(null==(e=this.config.bootstrap)?void 0:e.featureFlags)&&Object.keys(null==(t=this.config.bootstrap)?void 0:t.featureFlags).length>0||!1}push(e){this._execute_array([e])}capture(e,t,i){var r;if(this.__loaded&&this.persistence&&this.sessionPersistence&&this.cs){if(!this.consent.isOptedOut())if(!K(e)&&z(e)){if(this.config.opt_out_useragent_filter||!this._is_bot()){var n=null!=i&&i.skip_client_rate_limiting?void 0:this.rateLimiter.clientRateLimitContext();if(null==n||!n.isRateLimited){null!=t&&t.$current_url&&!z(null==t?void 0:t.$current_url)&&(te.error("Invalid `$current_url` property provided to `posthog.capture`. Input must be a string. Ignoring provided value."),null==t||delete t.$current_url),this.sessionPersistence.update_search_keyword(),this.config.save_campaign_params&&this.sessionPersistence.update_campaign_params(),this.config.save_referrer&&this.sessionPersistence.update_referrer_info(),(this.config.save_campaign_params||this.config.save_referrer)&&this.persistence.set_initial_person_info();var s=new Date,o=(null==i?void 0:i.timestamp)||s,a=Yt(),l={uuid:a,event:e,properties:this.calculateEventProperties(e,t||{},o,a)};n&&(l.properties.$lib_rate_limit_remaining_tokens=n.remainingTokens),(null==i?void 0:i.$set)&&(l.$set=null==i?void 0:i.$set);var c=this.$s(null==i?void 0:i.$set_once);c&&(l.$set_once=c),(l=function(e,t){return i=e,r=e=>z(e)&&!Y(t)?e.slice(0,t):e,n=new Set,function e(t,i){return t!==Object(t)?r?r(t):t:n.has(t)?void 0:(n.add(t),j(t)?(s=[],le(t,(t=>{s.push(e(t))}))):(s={},ce(t,((t,i)=>{n.has(t)||(s[i]=e(t,i))}))),s);var s}(i);var i,r,n}(l,null!=i&&i._noTruncate?null:this.config.properties_string_max_length)).timestamp=o,K(null==i?void 0:i.timestamp)||(l.properties.$event_time_override_provided=!0,l.properties.$event_time_override_system_time=s);var u=se({},l.properties.$set,l.$set);if(W(u)||this.setPersonPropertiesForFlags(u),!J(this.config.before_send)){var h=this.ks(l);if(!h)return;l=h}this.os.emit("eventCaptured",l);var d={method:"POST",url:null!==(r=null==i?void 0:i._url)&&void 0!==r?r:this.requestRouter.endpointFor("api",this.analyticsDefaultEndpoint),data:l,compression:"best-available",batchKey:null==i?void 0:i._batchKey};return!this.config.request_batching||i&&(null==i||!i._batchKey)||null!=i&&i.send_instantly?this.fs(d):this.cs.enqueue(d),l}te.critical("This capture call is ignored due to client rate limiting.")}}else te.error("No event name provided to posthog.capture")}else te.uninitializedWarning("posthog.capture")}De(e){return this.on("eventCaptured",(t=>e(t.event,t)))}calculateEventProperties(e,t,i,r,n){if(i=i||new Date,!this.persistence||!this.sessionPersistence)return t;var s=n?void 0:this.persistence.remove_event_timer(e),o=se({},t);if(o.token=this.config.token,this.config.__preview_experimental_cookieless_mode&&(o.$cookieless_mode=!0),"$snapshot"===e){var a=se({},this.persistence.properties(),this.sessionPersistence.properties());return o.distinct_id=a.distinct_id,(!z(o.distinct_id)&&!X(o.distinct_id)||V(o.distinct_id))&&te.error("Invalid distinct_id for replay event. This indicates a bug in your implementation"),o}var l,c=Us(this.config.mask_personal_data_properties,this.config.custom_personal_data_properties);if(this.sessionManager){var{sessionId:u,windowId:h}=this.sessionManager.checkAndGetSessionAndWindowId(n,i.getTime());o.$session_id=u,o.$window_id=h}this.sessionPropsManager&&ue(o,this.sessionPropsManager.getSessionProps());try{var d;this.sessionRecording&&ue(o,this.sessionRecording.sdkDebugProperties),o.$sdk_debug_retry_queue_size=null==(d=this.ps)?void 0:d.length}catch(e){o.$sdk_debug_error_capturing_properties=String(e)}if(this.requestRouter.region===Fo.CUSTOM&&(o.$lib_custom_api_host=this.config.api_host),l="$pageview"!==e||n?"$pageleave"!==e||n?this.pageViewManager.doEvent():this.pageViewManager.doPageLeave(i):this.pageViewManager.doPageView(i,r),o=ue(o,l),"$pageview"===e&&x&&(o.title=x.title),!K(s)){var p=i.getTime()-s;o.$duration=parseFloat((p/1e3).toFixed(3))}O&&this.config.opt_out_useragent_filter&&(o.$browser_type=this._is_bot()?"bot":"browser"),(o=ue({},c,this.persistence.properties(),this.sessionPersistence.properties(),o)).$is_identified=this._isIdentified(),j(this.config.property_denylist)?ce(this.config.property_denylist,(function(e){delete o[e]})):te.error("Invalid value for property_denylist config: "+this.config.property_denylist+" or property_blacklist config: "+this.config.property_blacklist);var g=this.config.sanitize_properties;g&&(te.error("sanitize_properties is deprecated. Use before_send instead"),o=g(o,e));var v=this.xs();return o.$process_person_profile=v,v&&!n&&this.Es("_calculate_event_properties"),o}$s(e){var t;if(!this.persistence||!this.xs())return e;if(this.ns)return e;var i=this.persistence.get_initial_props(),r=null==(t=this.sessionPropsManager)?void 0:t.getSetOnceProps(),n=ue({},i,r||{},e||{}),s=this.config.sanitize_properties;return s&&(te.error("sanitize_properties is deprecated. Use before_send instead"),n=s(n,"$set_once")),this.ns=!0,W(n)?void 0:n}register(e,t){var i;null==(i=this.persistence)||i.register(e,t)}register_once(e,t,i){var r;null==(r=this.persistence)||r.register_once(e,t,i)}register_for_session(e){var t;null==(t=this.sessionPersistence)||t.register(e)}unregister(e){var t;null==(t=this.persistence)||t.unregister(e)}unregister_for_session(e){var t;null==(t=this.sessionPersistence)||t.unregister(e)}Is(e,t){this.register({[e]:t})}getFeatureFlag(e,t){return this.featureFlags.getFeatureFlag(e,t)}getFeatureFlagPayload(e){var t=this.featureFlags.getFeatureFlagPayload(e);try{return JSON.parse(t)}catch(e){return t}}isFeatureEnabled(e,t){return this.featureFlags.isFeatureEnabled(e,t)}reloadFeatureFlags(){this.featureFlags.reloadFeatureFlags()}updateEarlyAccessFeatureEnrollment(e,t){this.featureFlags.updateEarlyAccessFeatureEnrollment(e,t)}getEarlyAccessFeatures(e,t,i){return void 0===t&&(t=!1),this.featureFlags.getEarlyAccessFeatures(e,t,i)}on(e,t){return this.os.on(e,t)}onFeatureFlags(e){return this.featureFlags.onFeatureFlags(e)}onSurveysLoaded(e){return this.surveys.onSurveysLoaded(e)}onSessionId(e){var t,i;return null!==(t=null==(i=this.sessionManager)?void 0:i.onSessionId(e))&&void 0!==t?t:()=>{}}getSurveys(e,t){void 0===t&&(t=!1),this.surveys.getSurveys(e,t)}getActiveMatchingSurveys(e,t){void 0===t&&(t=!1),this.surveys.getActiveMatchingSurveys(e,t)}renderSurvey(e,t){this.surveys.renderSurvey(e,t)}canRenderSurvey(e){return this.surveys.canRenderSurvey(e)}canRenderSurveyAsync(e,t){return void 0===t&&(t=!1),this.surveys.canRenderSurveyAsync(e,t)}identify(e,t,i){if(!this.__loaded||!this.persistence)return te.uninitializedWarning("posthog.identify");if(X(e)&&(e=e.toString(),te.warn("The first argument to posthog.identify was a number, but it should be a string. It has been converted to a string.")),e){if(["distinct_id","distinctid"].includes(e.toLowerCase()))te.critical('The string "'+e+'" was set in posthog.identify which indicates an error. This ID should be unique to the user and not a hardcoded string.');else if(this.Es("posthog.identify")){var r=this.get_distinct_id();if(this.register({$user_id:e}),!this.get_property("$device_id")){var n=r;this.register_once({$had_persisted_distinct_id:!0,$device_id:n},"")}e!==r&&e!==this.get_property(we)&&(this.unregister(we),this.register({distinct_id:e}));var s="anonymous"===(this.persistence.get_property(Ye)||"anonymous");e!==r&&s?(this.persistence.set_property(Ye,"identified"),this.setPersonPropertiesForFlags(se({},i||{},t||{}),!1),this.capture("$identify",{distinct_id:e,$anon_distinct_id:r},{$set:t||{},$set_once:i||{}}),this.ds=Co(e,t,i),this.featureFlags.setAnonymousDistinctId(r)):(t||i)&&this.setPersonProperties(t,i),e!==r&&(this.reloadFeatureFlags(),this.unregister(Ve))}}else te.error("Unique user id has not been set in posthog.identify")}setPersonProperties(e,t){if((e||t)&&this.Es("posthog.setPersonProperties")){var i=Co(this.get_distinct_id(),e,t);this.ds!==i?(this.setPersonPropertiesForFlags(se({},t||{},e||{})),this.capture("$set",{$set:e||{},$set_once:t||{}}),this.ds=i):te.info("A duplicate setPersonProperties call was made with the same properties. It has been ignored.")}}group(e,t,i){if(e&&t){if(this.Es("posthog.group")){var r=this.getGroups();r[e]!==t&&this.resetGroupPropertiesForFlags(e),this.register({$groups:se({},r,{[e]:t})}),i&&(this.capture("$groupidentify",{$group_type:e,$group_key:t,$group_set:i}),this.setGroupPropertiesForFlags({[e]:i})),r[e]===t||i||this.reloadFeatureFlags()}}else te.error("posthog.group requires a group type and group key")}resetGroups(){this.register({$groups:{}}),this.resetGroupPropertiesForFlags(),this.reloadFeatureFlags()}setPersonPropertiesForFlags(e,t){void 0===t&&(t=!0),this.featureFlags.setPersonPropertiesForFlags(e,t)}resetPersonPropertiesForFlags(){this.featureFlags.resetPersonPropertiesForFlags()}setGroupPropertiesForFlags(e,t){void 0===t&&(t=!0),this.Es("posthog.setGroupPropertiesForFlags")&&this.featureFlags.setGroupPropertiesForFlags(e,t)}resetGroupPropertiesForFlags(e){this.featureFlags.resetGroupPropertiesForFlags(e)}reset(e){var t,i,r,n;if(te.info("reset"),!this.__loaded)return te.uninitializedWarning("posthog.reset");var s=this.get_property("$device_id");if(this.consent.reset(),null==(t=this.persistence)||t.clear(),null==(i=this.sessionPersistence)||i.clear(),this.surveys.reset(),null==(r=this.persistence)||r.set_property(Ye,"anonymous"),null==(n=this.sessionManager)||n.resetSessionId(),this.ds=null,this.config.__preview_experimental_cookieless_mode)this.register_once({distinct_id:rt,$device_id:null},"");else{var o=this.config.get_device_id(Yt());this.register_once({distinct_id:o,$device_id:e?o:s},"")}this.register({$last_posthog_reset:(new Date).toISOString()},1)}get_distinct_id(){return this.get_property("distinct_id")}getGroups(){return this.get_property("$groups")||{}}get_session_id(){var e,t;return null!==(e=null==(t=this.sessionManager)?void 0:t.checkAndGetSessionAndWindowId(!0).sessionId)&&void 0!==e?e:""}get_session_replay_url(e){if(!this.sessionManager)return"";var{sessionId:t,sessionStartTimestamp:i}=this.sessionManager.checkAndGetSessionAndWindowId(!0),r=this.requestRouter.endpointFor("ui","/project/"+this.config.token+"/replay/"+t);if(null!=e&&e.withTimestamp&&i){var n,s=null!==(n=e.timestampLookBack)&&void 0!==n?n:10;if(!i)return r;r+="?t="+Math.max(Math.floor(((new Date).getTime()-i)/1e3)-s,0)}return r}alias(e,t){return e===this.get_property(be)?(te.critical("Attempting to create alias for existing People user - aborting."),-2):this.Es("posthog.alias")?(K(t)&&(t=this.get_distinct_id()),e!==t?(this.Is(we,e),this.capture("$create_alias",{alias:e,distinct_id:t})):(te.warn("alias matches current distinct_id - skipping api call."),this.identify(e),-1)):void 0}set_config(e){var t,i,r,n,s=se({},this.config);H(e)&&(ue(this.config,zo(e)),null==(t=this.persistence)||t.update_config(this.config,s),this.sessionPersistence="sessionStorage"===this.config.persistence||"memory"===this.config.persistence?this.persistence:new Xs(se({},this.config,{persistence:"sessionStorage"})),ii.O()&&"true"===ii.A("ph_debug")&&(this.config.debug=!0),this.config.debug&&(C.DEBUG=!0,te.info("set_config",JSON.stringify({config:e,oldConfig:s,newConfig:se({},this.config)},null,2))),null==(i=this.sessionRecording)||i.startIfEnabledOrStop(),null==(r=this.autocapture)||r.startIfEnabled(),null==(n=this.heatmaps)||n.startIfEnabled(),this.surveys.loadIfEnabled(),this.gs())}startSessionRecording(e){var t,i,r,n,s,o=!0===e,a={sampling:o||!(null==e||!e.sampling),linked_flag:o||!(null==e||!e.linked_flag),url_trigger:o||!(null==e||!e.url_trigger),event_trigger:o||!(null==e||!e.event_trigger)};Object.values(a).some(Boolean)&&(null==(t=this.sessionManager)||t.checkAndGetSessionAndWindowId(),a.sampling&&(null==(i=this.sessionRecording)||i.overrideSampling()),a.linked_flag&&(null==(r=this.sessionRecording)||r.overrideLinkedFlag()),a.url_trigger&&(null==(n=this.sessionRecording)||n.overrideTrigger("url")),a.event_trigger&&(null==(s=this.sessionRecording)||s.overrideTrigger("event")));this.set_config({disable_session_recording:!1})}stopSessionRecording(){this.set_config({disable_session_recording:!0})}sessionRecordingStarted(){var e;return!(null==(e=this.sessionRecording)||!e.started)}captureException(e,t){var i=new Error("PostHog syntheticException");this.exceptions.sendExceptionEvent(se({},ji((e=>e instanceof Error)(e)?{error:e,event:e.message}:{event:e},{syntheticException:i}),t))}loadToolbar(e){return this.toolbar.loadToolbar(e)}get_property(e){var t;return null==(t=this.persistence)?void 0:t.props[e]}getSessionProperty(e){var t;return null==(t=this.sessionPersistence)?void 0:t.props[e]}toString(){var e,t=null!==(e=this.config.name)&&void 0!==e?e:Ho;return t!==Ho&&(t=Ho+"."+t),t}_isIdentified(){var e,t;return"identified"===(null==(e=this.persistence)?void 0:e.get_property(Ye))||"identified"===(null==(t=this.sessionPersistence)?void 0:t.get_property(Ye))}xs(){var e,t,i,r;return!("never"===this.config.person_profiles||"identified_only"===this.config.person_profiles&&!this._isIdentified()&&W(this.getGroups())&&(null==(e=this.persistence)||null==(t=e.props)||!t[we])&&(null==(i=this.persistence)||null==(r=i.props)||!r[tt]))}Ss(){return!0===this.config.capture_pageleave||"if_capture_pageview"===this.config.capture_pageleave&&(!0===this.config.capture_pageview||"history_change"===this.config.capture_pageview)}createPersonProfile(){this.xs()||this.Es("posthog.createPersonProfile")&&this.setPersonProperties({},{})}Es(e){return"never"===this.config.person_profiles?(te.error(e+' was called, but process_person is set to "never". This call will be ignored.'),!1):(this.Is(tt,!0),!0)}gs(){var e,t,i,r,n=this.consent.isOptedOut(),s=this.config.opt_out_persistence_by_default,o=this.config.disable_persistence||n&&!!s;(null==(e=this.persistence)?void 0:e.$e)!==o&&(null==(i=this.persistence)||i.set_disabled(o)),(null==(t=this.sessionPersistence)?void 0:t.$e)!==o&&(null==(r=this.sessionPersistence)||r.set_disabled(o))}opt_in_capturing(e){var t;this.consent.optInOut(!0),this.gs(),(K(null==e?void 0:e.captureEventName)||null!=e&&e.captureEventName)&&this.capture(null!==(t=null==e?void 0:e.captureEventName)&&void 0!==t?t:"$opt_in",null==e?void 0:e.captureProperties,{send_instantly:!0}),this.config.capture_pageview&&this.ys()}opt_out_capturing(){this.consent.optInOut(!1),this.gs()}has_opted_in_capturing(){return this.consent.isOptedIn()}has_opted_out_capturing(){return this.consent.isOptedOut()}clear_opt_in_out_capturing(){this.consent.reset(),this.gs()}_is_bot(){return k?$o(k,this.config.custom_blocked_useragents):void 0}ys(){x&&("visible"===x.visibilityState?this.ls||(this.ls=!0,this.capture("$pageview",{title:x.title},{send_instantly:!0}),this.hs&&(x.removeEventListener("visibilitychange",this.hs),this.hs=null)):this.hs||(this.hs=this.ys.bind(this),ye(x,"visibilitychange",this.hs)))}debug(e){!1===e?(null==m||m.console.log("You've disabled debug mode."),localStorage&&localStorage.removeItem("ph_debug"),this.set_config({debug:!1})):(null==m||m.console.log("You're now in debug mode. All calls to PostHog will be logged in your console.\nYou can disable this with `posthog.debug(false)`."),localStorage&&localStorage.setItem("ph_debug","true"),this.set_config({debug:!0}))}ks(e){if(J(this.config.before_send))return e;var t=j(this.config.before_send)?this.config.before_send:[this.config.before_send],i=e;for(var r of t){if(i=r(i),J(i)){var n="Event '"+e.event+"' was rejected in beforeSend function";return Q(e.event)?te.warn(n+". This can cause unexpected behavior."):te.info(n),null}i.properties&&!W(i.properties)||te.warn("Event '"+e.event+"' has no properties after beforeSend function, this is likely an error.")}return i}getPageViewId(){var e;return null==(e=this.pageViewManager.ne)?void 0:e.pageViewId}captureTraceFeedback(e,t){this.capture("$ai_feedback",{$ai_trace_id:String(e),$ai_feedback_text:t})}captureTraceMetric(e,t,i){this.capture("$ai_metric",{$ai_trace_id:String(e),$ai_metric_name:t,$ai_metric_value:String(i)})}}!function(e,t){for(var i=0;i<t.length;i++)e.prototype[t[i]]=ge(e.prototype[t[i]])}(Yo,["identify"]),function(e){e.Button="button",e.Tab="tab",e.Selector="selector"}(To||(To={})),function(e){e.Left="left",e.Center="center",e.Right="right",e.NextToTrigger="next_to_trigger"}(Lo||(Lo={})),function(e){e.Popover="popover",e.API="api",e.Widget="widget"}(No||(No={})),function(e){e.Open="open",e.MultipleChoice="multiple_choice",e.SingleChoice="single_choice",e.Rating="rating",e.Link="link"}(Bo||(Bo={})),function(e){e.NextQuestion="next_question",e.End="end",e.ResponseBased="response_based",e.SpecificQuestion="specific_question"}(Uo||(Uo={})),function(e){e.Once="once",e.Recurring="recurring",e.Always="always"}(qo||(qo={}));var Jo,Xo=(Jo=jo[Ho]=new Yo,function(){function e(){e.done||(e.done=!0,Wo=!1,ce(jo,(function(e){e._dom_loaded()})))}null!=x&&x.addEventListener?"complete"===x.readyState?e():ye(x,"DOMContentLoaded",e,{capture:!1}):m&&te.error("Browser doesn't support `document.addEventListener` so PostHog couldn't be initialized")}(),Jo);function Zo(e){return Zo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zo(e)}function Qo(){Qo=function(){return t};var e,t={},i=Object.prototype,r=i.hasOwnProperty,n=Object.defineProperty||function(e,t,i){e[t]=i.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function c(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,i){return e[t]=i}}function u(e,t,i,r){var s=t&&t.prototype instanceof _?t:_,o=Object.create(s.prototype),a=new $(r||[]);return n(o,"_invoke",{value:I(e,i,a)}),o}function h(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var d="suspendedStart",p="suspendedYield",g="executing",v="completed",f={};function _(){}function m(){}function y(){}var b={};c(b,o,(function(){return this}));var w=Object.getPrototypeOf,E=w&&w(w(C([])));E&&E!==i&&r.call(E,o)&&(b=E);var k=y.prototype=_.prototype=Object.create(b);function x(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function i(n,s,o,a){var l=h(e[n],e,s);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==Zo(u)&&r.call(u,"__await")?t.resolve(u.__await).then((function(e){i("next",e,o,a)}),(function(e){i("throw",e,o,a)})):t.resolve(u).then((function(e){c.value=e,o(c)}),(function(e){return i("throw",e,o,a)}))}a(l.arg)}var s;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){i(e,r,t,n)}))}return s=s?s.then(n,n):n()}})}function I(t,i,r){var n=d;return function(s,o){if(n===g)throw Error("Generator is already running");if(n===v){if("throw"===s)throw o;return{value:e,done:!0}}for(r.method=s,r.arg=o;;){var a=r.delegate;if(a){var l=F(a,r);if(l){if(l===f)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===d)throw n=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=g;var c=h(t,i,r);if("normal"===c.type){if(n=r.done?v:p,c.arg===f)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=v,r.method="throw",r.arg=c.arg)}}}function F(t,i){var r=i.method,n=t.iterator[r];if(n===e)return i.delegate=null,"throw"===r&&t.iterator.return&&(i.method="return",i.arg=e,F(t,i),"throw"===i.method)||"return"!==r&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var s=h(n,t.iterator,i.arg);if("throw"===s.type)return i.method="throw",i.arg=s.arg,i.delegate=null,f;var o=s.arg;return o?o.done?(i[t.resultName]=o.value,i.next=t.nextLoc,"return"!==i.method&&(i.method="next",i.arg=e),i.delegate=null,f):o:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,f)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function $(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function C(t){if(t||""===t){var i=t[o];if(i)return i.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,s=function i(){for(;++n<t.length;)if(r.call(t,n))return i.value=t[n],i.done=!1,i;return i.value=e,i.done=!0,i};return s.next=s}}throw new TypeError(Zo(t)+" is not iterable")}return m.prototype=y,n(k,"constructor",{value:y,configurable:!0}),n(y,"constructor",{value:m,configurable:!0}),m.displayName=c(y,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,c(e,l,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(S.prototype),c(S.prototype,a,(function(){return this})),t.AsyncIterator=S,t.async=function(e,i,r,n,s){void 0===s&&(s=Promise);var o=new S(u(e,i,r,n),s);return t.isGeneratorFunction(i)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},x(k),c(k,l,"Generator"),c(k,o,(function(){return this})),c(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),i=[];for(var r in t)i.push(r);return i.reverse(),function e(){for(;i.length;){var r=i.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=C,$.prototype={constructor:$,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(O),!t)for(var i in this)"t"===i.charAt(0)&&r.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var i=this;function n(r,n){return a.type="throw",a.arg=t,i.next=r,n&&(i.method="next",i.arg=e),!!n}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var l=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var s=n;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,f):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),O(i),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var r=i.completion;if("throw"===r.type){var n=r.arg;O(i)}return n}}throw Error("illegal catch attempt")},delegateYield:function(t,i,r){return this.delegate={iterator:C(t),resultName:i,nextLoc:r},"next"===this.method&&(this.arg=e),f}},t}function ea(e,t,i,r,n,s,o){try{var a=e[s](o),l=a.value}catch(e){return void i(e)}a.done?t(l):Promise.resolve(l).then(r,n)}function ta(e){return function(){var t=this,i=arguments;return new Promise((function(r,n){var s=e.apply(t,i);function o(e){ea(s,r,n,o,a,"next",e)}function a(e){ea(s,r,n,o,a,"throw",e)}o(void 0)}))}}function ia(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var i="nxtscape_chat:".concat(e);Xo.capture(i,t),f.info("BACKGROUND","Captured PostHog event: ".concat(e),t)}catch(e){f.error("BACKGROUND","Error capturing PostHog event:",e)}}Xo.init("phc_nWs0kBH4Kx4lYOQNFL4lzUncjnEHuDPsCwhewmEgOOJ",{api_host:"https://us.i.posthog.com",person_profiles:"identified_only"});var ra=null,na=!1,sa=new Map,oa=null;function aa(e){ra!==e&&(f.info("BACKGROUND","Updating lastActiveTabId from ".concat(ra," to ").concat(e)),ra=e)}function la(){return ca.apply(this,arguments)}function ca(){return(ca=ta(Qo().mark((function t(){var i,r,n;return Qo().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(oa){t.next=3;break}return f.debug("BACKGROUND","Cannot prefetch - no port connection"),t.abrupt("return");case 3:return t.prev=3,t.next=6,new Promise((function(e){chrome.tabs.query({active:!0,currentWindow:!0},(function(t){if(chrome.runtime.lastError)return f.error("BACKGROUND","Error querying active tab:",chrome.runtime.lastError),void e([]);e(t)}))}));case 6:if((i=t.sent)&&0!==i.length){t.next=10;break}return f.debug("BACKGROUND","No active tab found for prefetching"),t.abrupt("return");case 10:if("number"==typeof(r=i[0]).id){t.next=14;break}return f.debug("BACKGROUND","Active tab has no ID, cannot prefetch"),t.abrupt("return");case 14:if(n=r.id,r.url&&r.url.startsWith("http")){t.next=18;break}return f.debug("BACKGROUND","Skipping prefetch for non-HTTP URL: ".concat(r.url)),t.abrupt("return");case 18:if(aa(n),!sa.has(n)){t.next=23;break}return f.debug("BACKGROUND","Content for tab ".concat(n," already in cache")),oa&&oa.postMessage({type:o,data:sa.get(n)}),t.abrupt("return");case 23:return f.info("BACKGROUND","Prefetching content for active tab: ".concat(n)),t.next=26,da(n);case 26:chrome.tabs.sendMessage(n,{action:e},(function(e){chrome.runtime.lastError?f.error("BACKGROUND","Error prefetching page content:",chrome.runtime.lastError):e&&e.success&&(sa.set(n,e.data),f.info("BACKGROUND","Successfully prefetched and cached content for tab: ".concat(n)),oa&&oa.postMessage({type:o,data:e.data}))})),t.next=32;break;case 29:t.prev=29,t.t0=t.catch(3),f.error("BACKGROUND","Error in prefetch function:",t.t0);case 32:case"end":return t.stop()}}),t,null,[[3,29]])})))).apply(this,arguments)}function ua(e){return ha.apply(this,arguments)}function ha(){return(ha=ta(Qo().mark((function e(t){var i,r;return Qo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,new Promise((function(e){chrome.tabs.get(t,(function(t){chrome.runtime.lastError?e(void 0):e(t.url)}))}));case 3:if((i=e.sent)&&i.startsWith("http")){e.next=6;break}return e.abrupt("return",!1);case 6:return e.next=8,chrome.scripting.executeScript({target:{tabId:t},func:function(){return Object.prototype.hasOwnProperty.call(window,"__AI_SIDE_PANEL_LOADED")}});case 8:return r=e.sent,e.abrupt("return",!!(r&&r[0]&&r[0].result));case 12:return e.prev=12,e.t0=e.catch(0),f.error("BACKGROUND","Failed to check script injection status:",e.t0),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}function da(e){return pa.apply(this,arguments)}function pa(){return(pa=ta(Qo().mark((function e(t){var i;return Qo().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,new Promise((function(e){chrome.tabs.get(t,(function(t){chrome.runtime.lastError?e(void 0):e(t.url)}))}));case 3:if((i=e.sent)&&i.startsWith("http")){e.next=7;break}return f.debug("BACKGROUND","Skipping injection for non-http URL: ".concat(i)),e.abrupt("return");case 7:return e.next=9,ua(t);case 9:if(!e.sent){e.next=13;break}return f.debug("BACKGROUND","Content script already injected, skipping..."),e.abrupt("return");case 13:return e.next=15,chrome.scripting.executeScript({target:{tabId:t},files:["content.js"]});case 15:f.info("BACKGROUND","Content script successfully injected into tab",t),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),f.error("BACKGROUND","Failed to inject content script:",e.t0);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})))).apply(this,arguments)}chrome.runtime.onConnect.addListener((function(t){"side-panel-connection"===t.name&&(f.info("BACKGROUND","Side panel connected"),oa=t,na=!0,la().catch((function(e){f.error("BACKGROUND","Error prefetching active tab content:",e)})),t.onMessage.addListener(function(){var v=ta(Qo().mark((function v(_){var m,y,b,w;return Qo().wrap((function(v){for(;;)switch(v.prev=v.next){case 0:v.prev=0,v.t0=_.type,v.next=v.t0===r?4:v.t0===d?6:v.t0===s?9:v.t0===a?29:v.t0===l?39:v.t0===u?41:v.t0===p?45:51;break;case 4:return t.postMessage({type:n}),v.abrupt("break",52);case 6:return f.info("BACKGROUND","Received close panel request from side panel"),na=!1,v.abrupt("break",52);case 9:if(_.tabId){v.next=11;break}return v.abrupt("return",t.postMessage({type:g,error:"No tab ID provided"}));case 11:if(aa(_.tabId),f.info("BACKGROUND","Requesting page content for tab ".concat(_.tabId)),!sa.has(_.tabId)){v.next=18;break}return f.info("BACKGROUND","Using cached content for tab: ".concat(_.tabId)),m=sa.get(_.tabId),t.postMessage({type:o,data:m}),v.abrupt("return");case 18:return v.prev=18,v.next=21,da(_.tabId);case 21:chrome.tabs.sendMessage(_.tabId,{action:e},(function(e){if(chrome.runtime.lastError)return f.error("BACKGROUND","Error getting page content:",chrome.runtime.lastError),void t.postMessage({type:g,error:chrome.runtime.lastError.message||"Failed to get page content"});e&&e.success?(sa.set(_.tabId,e.data),t.postMessage({type:o,data:e.data})):t.postMessage({type:g,error:(null==e?void 0:e.error)||"Failed to get page content"})})),v.next=28;break;case 24:v.prev=24,v.t1=v.catch(18),f.error("BACKGROUND","Error processing page content request:",v.t1),t.postMessage({type:g,error:v.t1 instanceof Error?v.t1.message:"Failed to get page content"});case 28:return v.abrupt("break",52);case 29:if(!_.tabId){v.next=37;break}return f.info("BACKGROUND","Refreshing content for tab ".concat(_.tabId)),sa.delete(_.tabId),v.next=34,da(_.tabId);case 34:chrome.tabs.sendMessage(_.tabId,{action:e},(function(e){if(chrome.runtime.lastError)return f.error("BACKGROUND","Error refreshing page content:",chrome.runtime.lastError),void t.postMessage({type:g,error:chrome.runtime.lastError.message||"Failed to refresh page content"});e&&e.success?(sa.set(_.tabId,e.data),t.postMessage({type:o,data:e.data})):t.postMessage({type:g,error:(null==e?void 0:e.error)||"Failed to refresh page content"})})),v.next=38;break;case 37:la().catch((function(e){f.error("BACKGROUND","Error refreshing active tab content:",e),t.postMessage({type:g,error:e instanceof Error?e.message:"Unknown error refreshing tab content"})}));case 38:return v.abrupt("break",52);case 39:try{chrome.tabs.query({currentWindow:!0},(function(e){if(chrome.runtime.lastError){var i=chrome.runtime.lastError.message||"Failed to get tabs";return f.error("BACKGROUND","Error getting tabs:",i),void t.postMessage({type:g,error:i})}var r=e.filter((function(e){return e.url&&e.url.startsWith("http")})).map((function(e){return{id:e.id,title:e.title||"",url:e.url||"",favIconUrl:e.favIconUrl||""}}));f.debug("BACKGROUND","Sending ".concat(r.length," tabs to sidepanel")),t.postMessage({type:c,data:r})}))}catch(e){y=e instanceof Error?e.message:"Unknown error fetching tabs",f.error("BACKGROUND","Error in get_tabs handler:",y),t.postMessage({type:g,error:y})}return v.abrupt("break",52);case 41:if(_.tabId){v.next=43;break}return v.abrupt("return",t.postMessage({type:g,error:"No tab ID provided"}));case 43:try{chrome.tabs.sendMessage(_.tabId,{action:i},(function(e){if(chrome.runtime.lastError)return f.error("BACKGROUND","Error pinging content script:",chrome.runtime.lastError),void t.postMessage({type:g,error:"Content script not available"});t.postMessage({type:h,data:e})}))}catch(e){f.error("BACKGROUND","Error in ping_content_script handler:",e),t.postMessage({type:g,error:"Content script not available"})}return v.abrupt("break",52);case 45:if(b=_.event,w=_.properties,b&&"string"==typeof b){v.next=49;break}return t.postMessage({type:g,error:"No event name provided for PostHog"}),v.abrupt("break",52);case 49:return ia(b,w||{}),v.abrupt("break",52);case 51:return v.abrupt("return",t.postMessage({type:g,error:"Unknown message type"}));case 52:v.next=58;break;case 54:v.prev=54,v.t2=v.catch(0),f.error("BACKGROUND","Error handling port message:",v.t2),t.postMessage({type:g,error:v.t2 instanceof Error?v.t2.message:"Unknown error"});case 58:case"end":return v.stop()}}),v,null,[[0,54],[18,24]])})));return function(e){return v.apply(this,arguments)}}()),t.onDisconnect.addListener((function(){f.info("BACKGROUND","Side panel disconnected"),oa=null,na=!1})))})),chrome.commands.onCommand.addListener((function(e){"toggle-panel"===e&&(f.info("BACKGROUND","Toggle panel keyboard shortcut triggered"),f.info("BACKGROUND","Toggle visibility called"),f.info("BACKGROUND","Current panel state: ".concat(na?"open":"closed")),na?(f.info("BACKGROUND","Panel is open, attempting to close"),oa?oa.postMessage({type:d}):(chrome.runtime.sendMessage({action:t}).catch((function(e){f.info("BACKGROUND","Error sending close message: ".concat(e.message))})),na=!1)):(f.info("BACKGROUND","Panel is closed, attempting to open"),chrome.windows.getCurrent((function(e){var t=e.id;void 0!==t&&chrome.tabs.query({active:!0,currentWindow:!0},(function(e){if(e&&e.length>0&&void 0!==e[0].id)try{chrome.sidePanel.open({windowId:t,tabId:e[0].id}),na=!0,f.info("BACKGROUND","Side panel opened successfully")}catch(e){f.error("BACKGROUND","Error opening panel: ".concat(e.message))}else try{chrome.sidePanel.open({windowId:t}),na=!0,f.info("BACKGROUND","Side panel opened successfully with windowId only")}catch(e){f.error("BACKGROUND","Error opening panel: ".concat(e.message))}}))}))))})),chrome.action&&chrome.action.onClicked.addListener((function(e){e.id&&(ra=e.id)}));try{chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0})}catch(e){f.error("BACKGROUND","Error setting panel behavior:",e)}f.info("BACKGROUND","Background script initialized"),chrome.tabs&&chrome.tabs.onUpdated?chrome.tabs.onUpdated.addListener((function(e,t,i){var r;e&&"loading"===t.status&&t.url&&(f.info("BACKGROUND","Tab ".concat(e," navigating to new URL, clearing from cache")),sa.delete(e)),e&&"complete"===t.status&&null!==(r=i.url)&&void 0!==r&&r.startsWith("http")&&(f.info("BACKGROUND","Tab ".concat(e," finished loading: ").concat(i.url)),da(e).catch((function(e){f.error("BACKGROUND","Error injecting content script:",e)})),i.active&&(ra=e))})):f.error("BACKGROUND","chrome.tabs.onUpdated is not available"),chrome.tabs&&chrome.tabs.onActivated&&chrome.tabs.onActivated.addListener((function(e){e.tabId&&(f.info("BACKGROUND","Tab activated: ".concat(e.tabId)),ra=e.tabId)})),chrome.tabs&&chrome.tabs.onRemoved&&chrome.tabs.onRemoved.addListener((function(e){f.info("BACKGROUND","Tab ".concat(e," closed, clearing from cache")),sa.delete(e)}))})();